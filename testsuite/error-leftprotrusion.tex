\documentclass{article}
\ifx\pdfprotrudechars\undefined
  \usepackage{fontspec}
\fi
\usepackage[verbose]{microtype}
\usepackage{csquotes}
\usepackage{listings,verbatim,fancyvrb,hyperref}
\MakeAutoQuote{“}{”}
\MakeOuterQuote{"}
{\catcode`<=13
 \gdef<#1>{\textls{#1}}}
\makeatletter
\long\def\@makefntext#1{%
  \leftskip 0pt
  \parindent 0pt
  \everypar{\parindent 0pt}%
  \leavevmode\llap{\@thefnmark\hskip\marginparsep}#1}
\makeatother
\begin{document}
\catcode`<=13

\def\mytitle{% issue #3
\begin{center}{title\par}
\end{center}}
\mytitle

\begin{abstract} % issue #4
	Test
\end{abstract}

% the following cases will not be protruded
\leftprotrusion{\sffamily--abc\par def--}

\rightprotrusion{\sffamily--abc def--}

\def\xxx{--abc\par def--}
\leftprotrusion\xxx % issue #6
\rightprotrusion\xxx

\begin{itemize}
  \item --- some words (wrong output with xetex)\newline --- a new line
  \item — some words\newline — a new line
  \item \textls{a\par aa} \textemdash\ some words\newline \textemdash\ a new line \par last line
  \item \textemdash\ some words\newline \textemdash\ a new line \par last line
  \item {—} some words\newline {—} a new line
  \item {---} some words\newline {---} a new line
  \item {\textemdash} some words\newline {\textemdash} a new line
  \item “quote”
  \item "quote"
  \item <ABC> def
\microtypesetup{nopatch=item}
  \item --- some words (without patch)\newline --- a new line
\end{itemize}

\begin{flushleft}
    ()\\
    ()\\
    ()
\end{flushleft}

\begin{verse}
--A verse\\
--(very terse)\footnote{-- footnote\newline -- text\par -- end}
\end{verse}
\begin{equation}
\label{eq:abc} 
a+b=c
\end{equation}
Test. Test. Test. Test. Test. Test. Test. Test.\hfill (1)\linebreak
Test. Test. Test. Test. Test. Test. Test. Test.

\leftprotrusion{-- a\verb|b|i \par ic}

\leftprotrusion\verb|--|

\leftprotrusion{\begin{tabular}{ll}ab&bc\\de&x\end{tabular}}

\leftprotrusion {--
\begin{verbatim}
$ verbatim
$ 2nd line
\end{verbatim}
  }

\leftprotrusion {--
%[commentchar=!] % doesn't work (because of ^^M)
\begin{Verbatim}
$ Verbatim
! extra text
\end{Verbatim}
  }

\leftprotrusion{--\begin{lstlisting}
listing
end
\end{lstlisting}}

\end{document}
