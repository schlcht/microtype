%\iffalse meta-comment
% -*- TeX:DTX:UK -*-
% smartQuote: english
% $Id: microtype.dtx,v 1.20 2005-06-24 00:00:30+02 schlicht Exp schlicht $
% -----------------------------------------------------------------------
%                      The `microtype' package
%       An interface to the micro-typographic extensions of pdfTeX
%          Copyright (c) 2004, 2005 R Schlicht <w.m.l@gmx.net>
%
% This work  may be  distributed and/or modified  under the conditions of
% the LaTeX Project Public License, either version 1.3 of this license or
% (at your option) any later version.  The latest version of this license
% is in:  http://www.latex-project.org/lppl.txt, and version 1.3 or later
% is part of all distributions of LaTeX version 2003/12/01 or later.
%
% This work has the LPPL maintenance status `author-maintained'.
%
% This work consists of the files microtype.dtx and microtype.ins and the
% derived file microtype.sty.
%
% Modified versions of the configuration files (*.cfg) may be distributed
% provided that  (1) the original copyright statement is not removed, and
% (2) the identification string is changed.
% -----------------------------------------------------------------------
%
%<*driver>
\ProvidesFile{microtype.dtx}
%</driver>
%<package>\NeedsTeXFormat{LaTeX2e}
%<package>\ProvidesPackage{microtype}
%<*package>
   [2005/06/23 v1.8 Micro-typography with pdfTeX (RS)]
%</package>
%<*config|cfg-u>
%<config|cfg-u>\ProvidesFile
%<m-t>   {microtype.cfg}
%<bch>   {mt-bch.cfg}
%<cmr>   {mt-cmr.cfg}
%<euf>   {mt-euf.cfg}
%<eus>   {mt-eus.cfg}
%<msa>   {mt-msa.cfg}
%<msb>   {mt-msb.cfg}
%<pad>   {mt-pad.cfg}
%<pmn>   {mt-pmn.cfg}
%<ppl>   {mt-ppl.cfg}
%<ptm>   {mt-ptm.cfg}
%<m-t>   [2005/03/15 v1.5a microtype main configuration file (RS)]
%<bch>   [2005/03/15 v1.3 microtype config. file: Bitstream Charter (RS)]
%<cmr>   [2005/06/01 v1.7 microtype config. file: Computer Modern (RS)]
%<euf>   [2005/06/01 v1.0 microtype config. file: AMS Euler Fraktur (RS)]
%<eus>   [2005/06/01 v1.0 microtype config. file: AMS Euler script (RS)]
%<msa>   [2005/06/01 v1.0 microtype config. file: AMS (a) (RS)]
%<msb>   [2005/06/01 v1.0 microtype config. file: AMS (b) (RS)]
%<pad>   [2005/03/15 v1.4a microtype config. file: Adobe Garamond (RS)]
%<pmn>   [2004/03/15 v1.1b microtype config. file: Adobe Minion (HH)]
%<ppl>   [2005/03/15 v1.4a microtype config. file: Palatino (RS)]
%<ptm>   [2005/04/26 v1.4 microtype config. file: Times (RS)]
%</config|cfg-u>
%
%<*driver>
\documentclass[10pt,a4paper]{ltxdoc}
\usepackage[latin1]{inputenc}
\usepackage{textcomp}
\usepackage{array}
 \newcolumntype{L}[1]{p{#1}<{\raggedright}}
 \expandafter\newif\csname ifbooktabs\endcsname
\IfFileExists{booktabs.sty}{
 \usepackage{booktabs}\booktabstrue}{}
\IfFileExists{url.sty}{
 \usepackage{url}}{\def\url##1{\texttt{##1}}}
% Let's abolish CM! We use Charter and Letter Gothic
% (for the pre-built documentation on CTAN):
% \def\rmdefault{bch}
% \def\ttdefault{blg}
% \usepackage[T1]{fontenc}
\IfFileExists{microtype.sty}{
 \usepackage[expansion=false]{microtype} % it's a web document
 \DeclareMicrotypeSet*
       [ protrusion ]*
       { encoding = {*, TS1, OMS},
         family = {rm*, tt*, cmsy},
         size = {footnotesize,small,normalsize}
       }
 }{}
\usepackage{color}
 \definecolor{theblue}{rgb}{0.02,0.04,0.48}
 \definecolor{thered}{rgb}{0.65,0.04,0.07}
 \definecolor{thegreen}{rgb}{0.06,0.44,0.08}
 \definecolor{thegrey}{gray}{0.5}
 \definecolor{theshade}{gray}{0.92}
\makeatletter
% layout
\frenchspacing
\expandafter\newif\csname ifcharter\endcsname
\def\@tempa{bch}
\ifx\rmdefault\@tempa
   \chartertrue
   \def\bfdefault{b}
   \def\PackageFont{\ttfamily}
   \def\match{{\large\raisebox{-.15em}{\textbullet}}}
   \def\Module#1{{\color{theblue}$\langle$\textit{#1}$\rangle$}}
   \DeclareRobustCommand{\LaTeX}{L\kern-.26em{\sbox\z@ T\vbox to\ht\z@{%
       \hbox{\check@mathfonts\fontsize\sf@size\z@\math@fontsfalse\selectfont A}%
      \vss}}\kern-.1em\TeX}
   \linespread{1.07}
\else
   \def\PackageFont{\sffamily}
   \def\match{\textbullet}
   \linespread{1.03}
\fi
\normalfont
\setlength\textheight{\topskip}
\addtolength\textheight{44\baselineskip}
\def\paragraph{\@startsection
    {paragraph}{4}{0pt}%
    {3.25ex plus 1ex minus .2ex}{-1em}%
    {\normalsize\itshape}}
% macrocode
\MacroTopsep=0pt
\MacrocodeTopsep=3pt
\settowidth\MacroIndent{\scriptsize 000\ }
\def\theCodelineNo{\reset@font\color{thegrey}\scriptsize\arabic{CodelineNo}}
\def\MacroFont{\ttfamily\small}
\def\AltMacroFont{\ttfamily\footnotesize}
\def\ImplementationSettings{%
   \linespread{1}%
   \hfuzz=20pt
   \def\MacroFont{\ttfamily\footnotesize}%
   \def\macro@font{\ttfamily\footnotesize}%
}
% headers
\headheight=15pt
\def\ps@MTheadings{%
   \def\@oddhead{%
      \hbox to\textwidth{\vbox{\hbox to\textwidth{%
         \footnotesize{\itshape\leftmark\rightmark\strut}\hfill\thepage\strut}%
         \hrule height 0.4pt width\textwidth \vskip-0.4pt
      }}\hss}
   \let\@oddfoot\@empty
   \let\@mkboth\markboth
   \def\sectionmark##1{\markboth{\MakeUppercase{##1}}{}}
   \def\subsectionmark##1{\markright{: ##1}}}
\pagestyle{MTheadings}
% toc
\def\@pnumwidth{1.7em}
\def\l@section{\vspace{.5ex}\@dottedtocline{1}{0em}{1.5em}}
\let\l@subsection@\l@subsection
\def\l@subsection{\vspace{.25ex}\l@subsection@}
\def\l@subsubsection#1#2{%
   \leftskip 3.8em
   \rightskip 3.8em plus 1fil
   \parindent 0pt
   {\let\numberline\@gobble{\small[#1~--~#2]}}}
\def\l@table{\@dottedtocline{1}{0pt}{1.5em}}
% bibliography
\def\@cite#1#2{#1\if@tempswa, #2\fi}
\def\thebibliography#1{%
   \section{\refname}%
   \list{}{\leftmargin 0pt}%
   \sloppy
   \clubpenalty 4000
   \@clubpenalty \clubpenalty
   \widowpenalty 4000}
\def\@biblabel#1{}
% footnotes
\long\def\@makefntext#1{%
   \leftskip 15pt
   \parindent -15pt
   \everypar{\parindent 0pt}%
   \leavevmode\hbox to 15pt{\@thefnmark\hss}#1}
\skip\@mpfootins=0.5\baselineskip
% lists
\def\descriptionlabel#1{\hspace\labelsep\normalfont#1}
\def\@listi{\leftmargin\leftmargini
            \parsep 4.5pt plus 1pt minus 1pt
            \topsep 4.5pt plus 1pt minus 1pt
            \itemsep 0pt}
\let\@listI\@listi
\setlength\leftmargini{15pt}
\newenvironment{options}
               {\list{}{\leftmargin 0pt
                        \labelwidth 0pt
                        \labelsep 1em
                        \itemindent \labelsep}}
               {\endlist}
% tables
\setlength\tabcolsep{2pt}
%\def\arraystretch{1.2}
\long\def\@makecaption#1#2{%
   \sbox\@tempboxa{\footnotesize\itshape#1: #2}%
   \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
   \vskip 6pt}
% index and change log
\IndexPrologue{\section{Index}%
   Numbers written in italic refer to the page where the corresponding entry is
   described; numbers underlined refer to the code line of the definition;
   numbers in roman refer to the code lines where the entry is used.}
\IfFileExists{multicol.sty}{
   %\raggedcolumns
   \setcounter{finalcolumnbadness}{100}
   \setcounter{IndexColumns}{2}
   \def\IndexMin{12\baselineskip}
   \def\GlossaryParms{%
      \IndexParms
      \def\@idxitem ####1####2\efill{%
         \end{multicols}
         \begin{multicols}{2}
            [\subsection*{\if####1v\relax
                  Version ####2 (\csname MTversiondate####2\endcsname)%
               \else ####2\fi}]
            [6\baselineskip]
         \GlossaryParms
         \let\item\@idxitem
         \ignorespaces \makeatletter \scan@allowedfalse}%
      \def\subitem{\par\hangindent 25pt}%
      \def\subsubitem{\subitem\hspace*{15pt}}}
   \GlossaryPrologue{%
      \section{Change History}\label{sec:changes}%
      \vspace*{-2\multicolsep}}
}{%
   \GlossaryPrologue{%
      \section{Change History}\label{sec:changes}}
}
% additional bells ...
\def\Describe#1#2#3{\noindent
   \csname Describe#1\endcsname{#2}%
   \DescribeValues{#1}{#3}}
\def\DescribeOption{\leavevmode\@bsphack
   \begingroup\MakePrivateLetters\Describe@Option}
\def\Describe@Option#1{\endgroup
   \marginpar{\raggedleft\PrintDescribeOption{#1}}%
   \SpecialOptionIndex{#1}\@esphack\ignorespaces}
\def\DescribeValues#1#2{%
   \let\@tempa\@empty
   \let\Option@default\@empty
   \@for\@tempb:=#2\do{%
      \expandafter\csname Special#1Value\expandafter\endcsname\@tempb\@nil
      \expandafter\g@addto@macro\expandafter\@tempa
         \expandafter{\csname #1Sep\endcsname}%
      \expandafter\g@addto@macro\expandafter\@tempa
         \expandafter{\@tempb}}%
   \@ifnextchar[\PrintValues{\PrintValues[\Option@default]}}
\def\SpecialOptionValue#1#2\@nil{%
   \if#1:\def\@tempb{\Variable{#2}}\fi
   \if#1!\def\@tempb{#2}\def\Option@default{#2}\fi}
\def\SpecialMacroValue#1#2\@nil{%
   \if#1?\def\@tempb{\normalsize[\Variable{#2}]}%
    \else\def\@tempb{\normalsize\{\Variable{#1#2}\}}\fi}
\def\OptionSep{,\,}
\def\MacroSep{\space}
\def\PrintValues[#1]{%
   {\MacroFont\expandafter\@gobble\@tempa\hfill#1\\*[.25\baselineskip]}}
\def\SpecialOptionIndex#1{\@bsphack
   \index{#1\actualchar{\protect\ttfamily#1} (option)\encapchar hyperpage}%
   \index{\quotechar!Options % the `!' will be sorted first
      \actualchar{\protect\bfseries Options:}%
      \levelchar{\protect\ttfamily#1}\encapchar usage}%
   \@esphack}
\def\SpecialUsageIndex#1{\@bsphack
   {\index{\quotechar!User Commands
      \actualchar{\protect\indexspace\protect\bfseries User Commands:}%
      \levelchar\expandafter\@gobble\string#1\actualchar\string\verb
         \quotechar*\verbatimchar\string#1\verbatimchar\encapchar usage}%
    \let\special@index\index\SpecialIndex@{#1}{\encapchar usage}}%
    \@esphack}
\def\IndexNewif#1{\@bsphack
   \expandafter\SpecialMainIndex\expandafter{\csname #1true\endcsname}%
   \expandafter\SpecialMainIndex\expandafter{\csname #1false\endcsname}%
   \@esphack}
\def\PrintDescribeMacro#1{\strut\MacroFont\color{thegreen}\string #1}
\def\PrintDescribeOption#1{\strut\MacroFont\color{thered}#1}
\def\Key#1{{\color{thered}\ttfamily#1}}
\def\Variable#1{$\langle${\rmfamily\itshape\small#1}$\rangle$}
\DeclareRobustCommand\pkg[1]{{\PackageFont#1}\@bsphack
   \index{#1\actualchar{\protect\ttfamily#1} (package)\encapchar hyperpage}%
   \@esphack}
\DeclareRobustCommand\opt[1]{{\ttfamily#1}\@bsphack
   \index{#1\actualchar{\protect\ttfamily#1} (option)\encapchar hyperpage}%
   \@esphack}
\DeclareRobustCommand\file[1]{{\ttfamily#1}}
% ... and whistles
\expandafter\newif\csname iflistings\endcsname
\IfFileExists{listings.sty}{
 \usepackage{listings}
 \lstset{%
   gobble=1,
   columns=flexible,
   keepspaces=true,
   basicstyle=\MacroFont,
   keywords=[0]{\microtypesetup,\DeclareMicrotypeSet,\UseMicrotypeSet,
      \DeclareMicrotypeSetDefault,\SetProtrusion,\SetExpansion,
      \DeclareCharacterInheritance,\DeclareMicrotypeAlias,\LoadMicrotypeFile,
      \Microtype@Hook},
   keywordstyle=[0]\color{thegreen},
   keywords=[1]{protrusion,expansion,activate,DVIoutput,draft,final,
      verbose,config,factor,auto,stretch,shrink,step,selected,unit},
   keywordstyle=[1]\color{thered},
   comment=[l]\%,
   commentstyle=\color{thegrey},
   escapeinside=<>,
%   frame=single,
%   framerule=0pt,
%   xleftmargin=\fboxsep,
%   xrightmargin=\fboxsep,
%%   aboveskip=\smallskipamount,
%   belowskip=\smallskipamount,
%   backgroundcolor=\color{theshade}
 }
 \let\verbatim\relax
 \lstnewenvironment{verbatim}{}{}
 \listingstrue
}{
 \let\lstset\@gobble
}
\def\todo{\changes{zTo Do}{0000/00/00}}
\def\todo#1{}
\def\Indexing{\let\special@index\codeline@wrindex}
\def\NoIndexing{\let\special@index\@gobble}
% Heiko Oberdiek's workaround from latexbugs (latex/3540):
\begingroup
  \def\x\begingroup#1\@nil{%
    \endgroup
    \def\DoNotIndex{%
      \begingroup
      \@makeother\#%
      \@makeother\$%
      \@makeother\%%
      \@makeother\&%
      \@makeother\^%
      \@makeother\_%
      \@makeother\|%
      \@makeother\~%
      \@makeother\ %
      % \@makeother\{\@makeother\} cannot be used here
      #1}}%
\expandafter\x\DoNotIndex\@nil
% fancy PDF document
\expandafter\newif\csname ifpdf\endcsname
\ifx\pdfoutput\undefined\else\ifx\pdfoutput\relax\else
   \ifcase\pdfoutput\else\pdftrue\fi\fi\fi
\ifpdf
%   \ifx\eTeXversion\undefined \else
%      \usepackage{pdfcolmk}% errors when not using etex (conflict with multicol)
%   \fi
   \usepackage{graphicx}
   \usepackage[
      bookmarks=true,
      colorlinks=true,
      linkcolor=theblue,
      urlcolor=theblue,
      citecolor=theblue,
      hyperindex=false,
      hyperfootnotes=false,
      pdftitle={The microtype package},
      pdfauthor={R Schlicht <w.m.l@gmx.net>},
      pdfsubject={An interface to the micro-typographic extension of pdfTeX},
      pdfkeywords={TeX, LaTeX, pdftex, typography, micro-typography,
                   character protrusion, margin kerning, font expansion}
     ]{hyperref}
   \def\usage#1{\textbf{\textit{\hyperpage{#1}}}}% for indexing of \DescribeMacro ...
   \def\changes@#1#2#3{% ... the changes ...
      \protected@edef\@tempa{\noexpand\glossary{#1\levelchar
         \ifx\saved@macroname\@empty \space\actualchar\generalname
         \else\expandafter\@gobble\saved@macroname\actualchar
            \string\verb\quotechar*\verbatimchar\saved@macroname\verbatimchar\fi
         :\levelchar #3\encapchar hyperpage}}%
      \@tempa\endgroup\@esphack}
%   \def\theCodelineNo{% % ... and everything else (would double the pdf file size)
%      \reset@font\color{thegrey}\scriptsize
%      \@tempcnta\arabic{CodelineNo}\advance\@tempcnta by\@ne
%      \hypertarget{L:\number\@tempcnta}{\arabic{CodelineNo}}}
%   \def\main#1{\underline{\hyperlink{L:#1}{#1}}}
%   \def\codeline#1{\link@sanitize#1-\@nil{#1}}
%   \def\link@sanitize#1-#2\@nil{\link@@sanitize#1,\@nil}
%   \def\link@@sanitize#1,#2\@nil{\hyperlink{L:#1}}
%   \def\SpecialIndex#1{\@bsphack\special@index{\expandafter\@gobble
%         \string#1\actualchar
%         \string\verb\quotechar*\verbatimchar\string#1\verbatimchar
%         \encapchar codeline}%
%      \@esphack}
   \def\ctanurl#1{\href{http://www.tex.ac.uk/tex-archive#1}{\texttt{#1}}}
   \def\mailto#1{\href{mailto:#1}{\texttt{#1}}}
   \def\mailtoRS{\href{mailto:<w.m.l@gmx.net> R Schlicht?subject=microtype \fileversion}
                      {\texttt{w.m.l@gmx.net}}}
\else
   \let\hyperpage\relax
   \def\texorpdfstring#1#2{#1}
   \def\ctanurl#1{\url{#1}}
   \def\mailto#1{\texttt{#1}}
   \def\mailtoRS{\mailto{w.m.l@gmx.net}}
\fi
\hyphenation{Ha-rald Har-ders Ber-nard}
% abbreviations
\def\microtype{{\PackageFont microtype}}
\def\pdftex{\texorpdfstring{pdf\kern.05em\TeX}{pdfTeX}}
\def\etex{\mbox{e-\TeX}}
\DeclareRobustCommand\thanh{H\`an Th\^e\llap{\raisebox{0.5ex}{\'{}}} Th\`anh}
\def\ten{10}
\DeclareRobustCommand\acro[1]{\texorpdfstring
   {{\ifx\f@size\ten\small\fi\ifcharter\spacing#1\relax\else#1\fi}}{#1}}
\def\spacing#1{\ifx#1\relax\else#1\kern.06em\expandafter\spacing\fi}
\def\ams{\acro{AMS}}
\def\ctan{\acro{CTAN}}
\def\dvi{\acro{DVI}}
\def\nfss{\acro{NFSS}}
\def\pdf{\acro{PDF}}
\def\tI{\acro{T1}}
\def\otI{\acro{OT1}}
\def\lyI{\acro{LY1}}
\def\tsI{\acro{TS1}}
\def\oml{\acro{OML}}
\def\oms{\acro{OMS}}
\def\ascii{\acro{ASCII}}
\def\eg{e.\,g.}
\def\ie{i.\,e.}
\CodelineIndex
\EnableCrossrefs
\RecordChanges
%\OnlyDescription
\begin{document}
   \DocInput{microtype.dtx}
\end{document}
%</driver>
% \fi
%
% ^^A -------------------------------------------------------------------------
%\changes{v1.0}{2004/09/11}{Initial version}
%
% \GetFileInfo{microtype.dtx}
% \title{\IfFileExists{mt-logo.pdf}{\vspace*{-4\baselineskip}%
%           \includegraphics{mt-logo.pdf}\\[2\baselineskip]}{}%
%        The \microtype\ package\\[.3\baselineskip]\large
%        An interface to the micro-typographic extensions of \pdftex}
% \author{R Schlicht\quad\mailtoRS}
% \date{\fileversion\ --- \filedate}
%
% \maketitle
% \thispagestyle{empty}
%
%\begin{abstract}
% \noindent The \microtype\ package provides an interface to the
% micro-typographic extensions of \pdftex: character protrusion and font
% expansion. It allows to restrict font expansion and/or character protrusion
% to a customizable set of fonts, and to configure all micro-typographic
% aspects of the fonts in a straight-forward and flexible way. Settings for
% various fonts are provided.\footnote{
%     Currently, this package provides settings for Computer Modern Roman,
%     Palatino, Times, Adobe Garamond and Minion, Bitstream Charter, and the
%     \ams\ math fonts, as well as some generic settings for unknown fonts.}
%
% Note that font expansion and character protrusion will only work with \pdftex,
% at least version 0.14f. Automatic font expansion requires version 1.20a or
% newer. The package will by default enable the features that can safely be
% assumed to work.
%\end{abstract}
%
% \tableofcontents
% \listoftables
% \markboth{}{\MakeUppercase\listtablename}
% ^^A\thispagestyle{empty}
%
%\newpage
%\section{Micro-Typography with \pdftex}\label{sec:micro-type}
%
% \pdftex, the \TeX\ extension written by \thanh, introduces two features that
% make it the tool of choice not only for the creation of electronic documents
% but also of works of outstanding time-honoured typography: \textit{character
% protrusion} (also known as margin kerning) and \textit{font expansion}.
% Quoting \thanh's thesis:
%
%\begin{quote}\small
%\ifpdf
%   \dimen0=\lpcode\font`\`em
%   \divide\dimen0 by 500
%   \hskip-\dimen0 ^^A Double cheat!
%\fi
%  `Margin kerning is the adjustments of the characters at the margins of a
%   typeset text. A simplified employment of margin kerning is hanging
%   punctuation. Margin kerning is needed for optical alignment of the margins
%   of a typeset text, because mechanical justification of the margins makes
%   them look rather ragged. Some characters can make a line appear shorter to
%   the human eye than others. Shifting such characters by an appropriate
%   amount into the margins would greatly improve the appearance of a typeset
%   text.
%
%   Composing with font expansion is the method to use a wider or narrower
%   variant of a font to make interword spacing more even. A font in a loose
%   line can be substituted by a wider variant so the interword spaces are
%   stretched by a smaller amount. Similarly, a font in a tight line can be
%   replaced by a narrower variant to reduce the amount that the interword
%   spaces are shrunk by. There is certainly a potential danger of font
%   distortion when using such manipulations, thus they must be used with
%   extreme care. The potentiality to adjust a line width by font expansion can
%   be taken into consideration while a paragraph is being broken into lines,
%   in order to choose better breakpoints.' [\cite[p.~323]{ThanhThesis}]
%\end{quote}
%
% Both these features have been lacking a simple \LaTeX\ user interface for
% quite some time. Then, the \pkg{pdfcprot} package was released [\cite{pdfcprot}],
% which allowed \LaTeX\ users to employ character protrusion without having to
% mess much with the internals.
%
% Font expansion, however, was still most difficult to utilize, since it
% required that the font metrics be available in all levels of expansion.
% Therefore, anybody who wanted to use this feature had to create multiple
% instances of the fonts in advance. Shell scripts to partly relieve the user
% from this burden were available~-- however, it remained a cumbersome task.
% Furthermore, all fonts were still being physically created, thus wasting
% compilation time and disk space.
%
% In the summer of 2004, \thanh\ implemented a feature that can be expected to
% prove as a major facilitation for \TeX\ and \LaTeX\ users: Font expansion
% can now take place automatically. That is, \pdftex\ no longer needs the
% expanded font metrics but will calculate them at run-time, and completely
% in memory.
%
% This package provides a simple interface to both font expansion and character
% protrusion.\footnote{
%     Therefore, it is an alternative, not a supplement, to the \pkg{pdfcprot}
%     package.}
% All micro-typographic aspects may be customized to your taste and needs in a
% straightforward manner. The next chapters will present a survey of all
% options and customization possibilities.
%
%
%\section{Invoking the Package}
%
% There is nothing surprising in loading this package:
%\begin{verbatim}
%\usepackage{microtype}
%\end{verbatim}
% This will be sufficient in most cases, and if you are not interested in
% fine-tuning the micro-typographic appearance of your document (which would
% seem unlikely, since using this package is proof of your interest in
% typographic issues), you may actually skip the rest of this document.
%
%\subsection{General Options}\label{sub:options-general}
%
% Like many other \LaTeX\ packages, the \microtype\ package accepts options in
% the well known |key=value| syntax. In the following, you'll find a
% description of all \Key{keys} and their possible |values|
% (`|true|' may be omitted; multiple values, where allowed, must be enclosed in
% braces; the default value is shown on the right, preceded by an asterisk
% if it is contingent on the \pdftex\ version).
%
%\bigskip
%\Describe{Option}{protrusion}
%                 {true,false,compatibility,nocompatibility,:font set name}[*\,true]
%\DescribeOption{expansion}
% These are the main options to control the level of micro-typographic refinement
% that the fonts in your document should gain. By default, the package is
% moderately greedy: Character protrusion will be enabled, font expansion will
% only be disabled in circumstances where \pdftex\ cannot expand the fonts
% automatically, that is, if it is either too old (versions before 1.20) or if
% the output mode is \dvi\ (see next option).
%
% Protrusion and expansion may be enabled or disabled independently from each
% other by setting the respective key to |true| resp. |false|.
% The \opt{activate} option
%\DescribeOption{activate}
% is a shortcut for setting both \opt{expansion} and \opt{protrusion} at the
% same time. So, the following lines all have the same effect (when creating
% \pdf\ files with a new \pdftex):
%\begin{verbatim}
%\usepackage[protrusion=true,expansion=true]{microtype}
%\end{verbatim}
%\begin{verbatim}
%\usepackage[protrusion,expansion]{microtype}
%\end{verbatim}
%\begin{verbatim}
%\usepackage[activate={true,nocompatibility}]{microtype}
%\end{verbatim}
%\begin{verbatim}
%\usepackage{microtype}
%\end{verbatim}
%\smallskip
% When \pdftex\ employs font expansion and character protrusion, line breaks
% (and consequently, page breaks) may turn out differently. If that is not
% desired, you may pass the value |compatibility| to the \opt{protrusion}
% and/or \opt{expansion} options. Typographically, however, the results may be
% suboptimal.
%
% Finally, you may also specify the name of a font set to which character
% protrusion and/or font expansion should be restricted. See
% section~\ref{sub:font-sets} for a detailed discussion.
%
%\pagebreak ^^A layout
%\bigskip
%\Describe{Option}{DVIoutput}{true,!false}
% \pdftex\ is not only able to generate \pdf\ output but can also spit out \dvi\
% files.\footnote{
%     \TeX\ systems are beginning to switch to pdf(e)\TeX\ as the default engine
%     even for \dvi\ output.}
% The latter can be ordered with the option \opt{DVIoutput}, which will set
% \cmd{\pdfoutput} to zero.
%
% Note that this will confuse packages that depend on the value of
% \cmd{\pdfoutput} if they were loaded earlier, as they had been made believe
% that they were called to generate \pdf\ output where they actually weren't.
% These packages are, among others: \pkg{graphics}, \pkg{color},
% \pkg{hyperref}, \pkg{pstricks} and, obviously, \pkg{ifpdf}. Either load these
% packages after \microtype\ or else issue the command |\pdfoutput=0| earlier
% -- in the latter case, the \opt{DVIoutput} option is redundant.
%
% When generating \dvi\ files, font expansion has to be enabled explicitly.
% \emph{Automatic} font expansion will not work because dvips (resp. the \dvi\
% viewer) is not able to generate the expanded fonts on the fly.
%
%\bigskip
%\Describe{Option}{draft}{true,!false}
%\DescribeOption{final}
% If the \opt{draft} option is passed to the package, \emph{font expansion and
% character protrusion will be disabled}. The \opt{draft} and \opt{final}
% options may also be inherited from the class options; of course, you can
% override them in the package options.
%
%\bigskip
%\Describe{Option}{verbose}{true,!false,errors}
% Information on the settings used for each font will be written into the log
% file if you enable the \opt{verbose} option, which is disabled by default.
%
% When \microtype\ encounters a problem that is not fatal (\eg, an unknown
% character in the settings, or non-existent settings), it will by default only
% issue a warning and try to continue. Loading the package with |verbose=errors|
% will turn all warnings into errors, so that you can be sure that no problem
% will go unnoticed.
%
%\bigskip
%\Describe{Option}{config}{:file name}[microtype]
% Various settings for this package will be loaded from a configuration file, by
% default \file{microtype.cfg} (see section~\ref{sub:config-file}). You can
% have a different configuration file loaded instead by specifying its name
% \emph{without the extension}, \eg, |config=mycrotype|.
%
%
%\subsection{Options for Character Protrusion}\label{sub:options-protrusion}
%
%\Describe{Option}{factor}{:integer}[1000]
% Using this option, you can globally increase or decrease the amount by which
% the characters will be protruded. While a value of 1000 means that the full
% protrusion as specified in the configuration (see section~\ref{sub:protrusion})
% will be used, a value of 500 would result in halving all protrusion factors of
% the configuration. This might be useful if you are generally satisfied with
% the settings but prefer the margin kerning to be less or more visible
% (\eg, if you are so proud of being able to use this feature that you want
% everybody to see it, or -- to mention a motivation more in compliance with
% typographical correctness -- if you are using a large font that calls for
% more modest protrusion).
%
%\bigskip
%\Describe{Option}{unit}{!relative,:dimension}
% This option is described in section~\ref{sub:protrusion}, apropos the command
% \cs{SetProtrusion}. Use with care.
%
%\subsection{Options for Font Expansion}\label{sub:options-expansion}
%
%\Describe{Option}{auto}{true,false}[*\,true]
% As noted in chapter~\ref{sec:micro-type}, the expanded versions of the fonts
% may be calculated automatically. This option is true by default provided that
% \pdftex's version is found to be 1.20 or higher and the output mode is \pdf;
% otherwise, it will be disabled.
% If \opt{auto} is set to false, the fonts for all expansion steps must exist
% (with files called \meta{font~name}\texttt{\textpm}\meta{expansion value},
% \eg\ \file{cmr12+10}, as described in the \cite[p.~20]{pdftexman}). If expanded
% instances of the fonts are available, they will be used regardless whether
% \opt{auto} is true or not.
%
%\bigskip
%\Describe{Option}{stretch}{:integer}[20]
%\DescribeOption{shrink}
% You may specify the stretchability and shrinkability of a font, \ie, the
% maximum amount that a font may be stretched or shrunk. The numbers will be
% divided by 1000, so that a stretch limit of 10 means that the font may be
% expanded by up to 1\%.
% The default stretch limit is 20. The shrink limit will by default be the
% same as the stretch limit.
%
%\bigskip
%\Describe{Option}{step}{:integer}[\textrm{min(\opt{stretch},\opt{shrink})/5}]
% Font expansion will be applied in discrete steps. For example, if \opt{step}
% is set to~4 (which it is by default), \pdftex\ will try up to eleven different
% expansion levels of a font (from \textminus20 to +20). If you set
% \opt{stretch} or \opt{shrink} to something other than their default values
% but do not specify \opt{step}, it will be set to 1/5th of the smaller value
% of the two.
% Therefore, the following lines are all equivalent:
%\begin{verbatim}
%\usepackage[stretch=20,shrink=20]{microtype}
%\end{verbatim}
%\begin{verbatim}
%\usepackage[stretch=20,step=4]{microtype}
%\end{verbatim}
%\begin{verbatim}
%\usepackage{microtype}
%\end{verbatim}
%
%\medskip
%\Describe{Option}{selected}{true,!false}
% When applying font expansion, it is possible to restrict the expansion of some
% characters that are more sensitive to deformation than others (\eg, the `O',
% in contrast to the `I'). This is called \emph{selected expansion}, and its
% usage allows to increase the stretch and shrink limits (to, say, 30 instead
% of 20); however, the gain is limited since at the same time the average
% stretch variance will be decreased.
%
% Beginning with version 1.5, where this option was introduced, it is by default
% set to |false|, so that all characters will be expanded by the same amount.
% See section~\ref{sub:expansion} for a more detailed discussion.
%
%
%\section{User Command}\label{sec:user-command}
%
%\Describe{Macro}{\microtypesetup}{key\,=\,value list}
% This command may be used anywhere in the document to change the general
% settings of the micro-typographic extensions. It accepts the keys:
% \Key{expansion}, \Key{protrusion} and \Key{activate}, which in turn may
% receive the values |true|, |false|, |compatibility| or |nocompatibility| (but
% not the name of a font set). Thus, you could temporarily disable font
% expansion by saying:
%\begin{verbatim}
%\microtypesetup{expansion=false}
%\end{verbatim}
%
%
%\section{Configuration}
%
%\subsection{Declaring Font Sets}\label{sub:font-sets}
%
% By default, character protrusion will be applied to all text fonts that are
% being used in the document, and a basic set of fonts will be expanded. You
% may want to customize the set of fonts that should get the benefit of
% micro-typographic treatment. This can be achieved by specifying attributes of
% the font that have to be matched for them to be taken into account.
%
%\bigskip
%\Describe{Macro}{\DeclareMicrotypeSet}
%                {?|protrusion|\textbar|expansion|,set name,set of fonts}
%\DescribeMacro{\DeclareMicrotypeSet*}
% This command declares a new set of fonts to which font expansion or character
% protrusion (or, if no optional argument is given, both) should be applied.
% This set can subsequently be activated by calling:
%\iflistings
%\begin{verbatim}
%\UseMicrotypeSet[<\Variable{|protrusion|\textbar|expansion|}>]{<\Variable{set name}>}
%\end{verbatim}
%\else
%\begin{flushleft}\small
%|\UseMicrotypeSet[|\Variable{|protrusion|\textbar|expansion|}|]{|\Variable{set name}|}|
%\end{flushleft}
%\fi
%
%\noindent
% The starred version of the command declares \emph{and} activates the font
% set at the same time.
%
% \paragraph{The set of fonts} is specified by assigning values to the \nfss\
% font attributes: encoding, family, series, shape, and size (cf.~\cite{fntguide}).
% Let's start with an example. This package defines a font set called
% `|basictext|' in the main configuration file as follows:
%\begin{verbatim}
%\DeclareMicrotypeSet{basictext}
%   { encoding = {T1,OT1,LY1},
%     family   = {rm*,sf*},
%     series   = {m},
%     size     = {normalsize,footnotesize,small,large}
%   }
%\end{verbatim}
% If you now call
%{\lstset{deletekeywords=[1]{expansion}}^^A
%\begin{verbatim}
%\UseMicrotypeSet[expansion]{basictext}
%\end{verbatim}}
%\noindent
% in the document's preamble, only fonts in the text encodings \tI, \otI\ or
% \lyI, roman or sans serif families, normal (or `medium') series, and in
% sizes called by \cmd{\normalsize}, \cmd{\footnotesize}, \cmd{\small} or
% \cmd{\large}, will be expanded. Math fonts, on the other hand, will not,
% since they are in another encoding. Neither will fonts in bold face, or huge
% fonts. Etc.
%
% If an attribute list is empty or missing -- like the `shape' attribute
% in the above example --, it does not constitute a restriction. In other
% words, this is equivalent to specifying \emph{all} possible values for that
% attribute.
% Therefore, the predefined set `|alltext|', declared as follows:
%\begin{verbatim}
%\DeclareMicrotypeSet{alltext}
%   { encoding = {T1,OT1,LY1,TS1} }
%\end{verbatim}
% is far less restrictive. The only condition is that the encoding must match.
%
% If a value is followed by an asterisk (like `|rm*|' and `|sf*|' in the example
% above), it does not designate an \nfss\ code, but will expand to the current
% |\|\meta{value}|default|, \eg\ \cmd{\rmdefault}.\footnote{
%     Note that this expansion will take place immediately, so you should make
%     all relevant changes \emph{before} loading the \microtype\ package.}
% For example, if you want to include the bold font, too, you should say `|bf*|'
% instead of `|b|' (\cmd{\bfdefault} for Computer Modern is `|bx|', while for
% other fonts, it might be `|b|' or even `|sb|'). A single asterisk means
% |\|\meta{characteristic}|default|, \eg\ \cmd{\encodingdefault}, respectively
% \cmd{\normalsize} for the size axis.
%
% Sizes may be either specified as a dimension (`|10|' or `|10pt|'), or as a
% size selection command \emph{without} the backslash. You may also specify
% ranges (\eg, `|small-Large|'); while the lower boundary is included in the
% range, the upper boundary is not. Thus, `|12-16|' would match 12pt, 13.5pt,
% and 15.999pt, \eg, but not 16pt. You are allowed to omit the lower or
% upper bound (`|-10|', `|large-|').
%
%\begin{table}\small
%\caption{Predefined font sets}\label{tab:predefined-font-sets}
%\begin{tabular}{@{}L{65pt}L{74pt}*3{L{44pt}}L{64pt}@{}}
%\ifbooktabs\toprule\else\hline\fi
%        \footnotesize Set name
%      & \multicolumn{5}{l}{\footnotesize  Font attributes}\\
%\ifbooktabs\cmidrule{2-6}\fi
%      & \footnotesize Encoding
%      & \footnotesize Family
%      & \footnotesize Series
%      & \footnotesize Shape
%      & \footnotesize Size\\
%\ifbooktabs\cmidrule(r){1-1}\cmidrule(r){2-2}\cmidrule(r){3-3}
%     \cmidrule(r){4-4}\cmidrule(r){5-5}\cmidrule{6-6}\else\hline\fi
% |all|
%      & --
%      & --
%      & --
%      & --
%      & -- \\
%\ifbooktabs\cmidrule(r){1-1}\fi
% |alltext|\linebreak(|allmath|)
%      & \fontsize{8}{11}\selectfont \otI, \tI, \lyI, \tsI \linebreak (\oml, \oms, U)
%      & --
%      & --
%      & --
%      & --
%      \\
%\ifbooktabs\cmidrule(r){1-1}\fi
% |basictext|\linebreak(|basicmath|)
%      & \fontsize{8}{11}\selectfont \otI, \tI, \lyI \linebreak (\oml, \oms)
%      & |\rm*|,\linebreak |\sf*|
%      & m
%      & --
%      & \cmd{\normalsize}, \cmd{\footnotesize}, \cmd{\small}, \cmd{\large}
%      \\
%\ifbooktabs\cmidrule(r){1-1}\fi
% |normalfont|
%      &  |\encoding*|
%      &  |\family*|
%      &  |\series*|
%      &  |\shape*|
%      &  |\normalsize| \\
%\ifbooktabs\bottomrule\else\hline\fi
%\end{tabular}
%\vskip8pt
%`|*|' = `|default|'
%\end{table}
%
%\enlargethispage{\baselineskip} ^^A layout
% Table~\ref{tab:predefined-font-sets} lists the six predefined font sets. They
% may also be activated by passing their name to the \opt{expansion} resp.
% \opt{protrusion} option when loading the package, for example:
%\begin{verbatim}
%\usepackage[protrusion=allmath,expansion=basicmath]{microtype}
%\end{verbatim}
%
%\bigskip
%\Describe{Macro}{\UseMicrotypeSet}{?|protrusion|\textbar|expansion|,set name}
% This command activates a font set previously declared by \cs{DeclareMicrotypeSet}.
% Using the optional argument, you can limit the application of the set to
% protrusion or expansion only.
%
%\bigskip
%\Describe{Macro}{\DeclareMicrotypeSetDefault}{?|protrusion|\textbar|expansion|,set name}
% If the package has been loaded without activating font sets, the sets declared
% by this command will be activated (provisionally). By default, the
% `|basictext|' font set will be used for font expansion, the `|alltext|' set
% for character protrusion.
%
%\medskip\noindent
% This command will only have an effect inside the main configuration file (cf.
% section~\ref{sub:config-file}). The commands \cs{DeclareMicrotypeSet} and
% \cs{UseMicrotypeSet} may only be used in the preamble or in the main
% configuration file. Their scope is global to the document.
%
%
%\subsection{Micro Fine Tuning}\label{sub:fine-tuning}
%
% Every character asks for a particular amount of protrusion. It may also be
% desirable to restrict the maximum expansion of certain characters.
% Furthermore, since every font looks different, settings have to be specific
% to a font or set of fonts. This package offers flexible and straight-forward
% methods of customizing these finer aspects of micro-typography.
%
%\subsubsection{Character Protrusion}\label{sub:protrusion}
%
%\Describe{Macro}{\SetProtrusion}{?options,set of fonts,protrusion settings}
% Using this command, you can set the protrusion factors for each character of a
% font or a set of fonts. A very incomplete example would be the following:
%\begin{verbatim}
%\SetProtrusion
%   { encoding = T1,
%     family   = cmr }
%   {  A             = { 50, 50},
%     \textquoteleft = {700,   }  }
%\end{verbatim}
% which would result in the character `A' being protruded by 5\% of its width on
% both sides, and the left quote character by 70\% of its width into the left
% margin. This would apply to all font shapes, series and sizes of the Computer
% Modern Roman family in encoding~\tI.
%
%\paragraph{The protrusion settings}
% consist of \meta{character}\,|=|\,\meta{protrusion factors} pairs.
%
% The \meta{characters} may be specified either as a single character (`|A|'),
% as a text symbol command (`\cmd{\textquoteleft}'), or as a slot number: three
% digits for decimal notation, prefixed with~|"| for hexadecimal, with~|'| for
% octal (\eg, the `fl' ligature in \tI\ encoding:~|029|, |"1D|, |'35|).
% \mbox{8-bit} characters may be entered directly or in the \LaTeX\
% \mbox{7-bit} way of defining them: both |Ä| and |\"A| are valid, provided the
% character is actually included in the encoding(s). You also have the
% possibility to declare lists of characters that should inherit protrusion or
% expansion factors (see section~\ref{sub:inherit}).
%
% The \meta{protrusion factors} designate the amount that a character should be
% protruded into the left margin (first value) respectively into the right
% margin (second value). By default, the values are relative to the character
% widths, so that a value of 1000 means that the character should be shifted
% fully into the margin, while, for example, with a value of 50 it would
% be protruded by 5\% of its width. Negative values are admitted, as well as
% numbers larger than 1000 (but effectively not more than 1em of the font). You
% can omit either number if the character should not be protruded on that side,
% but must not drop the separating comma.
%
%\paragraph{The set of fonts}
% to which the settings should apply is declared using the same syntax of
% \meta{font axis}\,|=|\,\meta{value list} pairs as for the command
% \cs{DeclareMicrotypeSet}.
%
% To find the matching settings for a given font the package will try all
% combinations of font encoding, family, series, shape and size, with
% decreasing significance in this order. For instance, if both settings for the
% current family (say, |T1/cmr///|) and settings for italic fonts in the normal
% weight (|T1//m/it/|) exist, those for the Computer Modern Roman font would
% apply.\footnote{
%     For the interested, table~\ref{tab:match-order} on
%     page~\pageref{tab:match-order} presents the exact order.}
% The encoding must always match.
%
%\paragraph{Options:}
%\begin{options}
%   \item[\Key{name}] You may assign a name to the protrusion settings, so that you
%        are able to load it by another list.
%   \item[\Key{load}] You can load another list (provided, you previously assigned
%        a name to it) before the current list will be loaded, so that the
%        fonts will inherit the values from the loaded list.\par
%        Thus, the configuration may be simplified considerably. You can for
%        instance create a default list for a font; settings for other shapes
%        or series can then load these settings, and extend or overwrite them
%        (since the value that comes last will take precedence). Font settings
%        will be loaded recursively.
%   \item[\Key{factor}] This option can be used to influence all protrusion
%        factors of the font or font set, overriding any global \opt{factor}
%        setting (see section~\ref{sub:options-protrusion}). For instance, if
%        you want fonts in larger sizes to be protruded less, you could load
%        the normal lists with a different factor applied to them:
%\begin{verbatim}
%\SetProtrusion
%   [ load     = cmr-T1,
%     factor   = 700    ]
%   { encoding = T1,
%     family   = cmr,
%     size     = large- }
%   { }
%\end{verbatim}
%   \item[\Key{unit}] By default, the protrusion factors are relative to the
%        respective character's width. The |unit| option may be used to override
%        this and make \microtype\ regard all values in the list as thousandths
%        of the specified width. Issuing, for instance, |unit=1em| would have
%        the effect that a value of, say, 50 now results in the character being
%        protruded by 5\% of an |em| of the font (thus simulating the internal
%        measuring of \pdftex's \cmd{\lpcode} and \cmd{\rpcode} primitives).
%        The default behaviour can be restored with |unit=relative|.\footnote{
%           The |unit| option can even be passed globally to the package.
%           However, all provided settings are created under the assumption
%           that the values are relative to the character width. Therefore, you
%           should only ask for a different \opt{unit} if you are certain that
%           none of the default settings will be used in your document.}
%\end{options}
%
%
%\subsubsection{Font Expansion}\label{sub:expansion}
%
%\Describe{Macro}{\SetExpansion}{?options,set of fonts,expansion settings}
% By default, all characters of a font are allowed to be stretched or shrunk by
% the same amount. However, it is also possible to limit the expansion of
% certain characters if they are more sensitive to deformation. This is the
% purpose of the \cs{SetExpansion} command. Note that it will only have an effect
% if the package has been loaded with the \opt{selected} option. Otherwise,
% the expansion settings will be ignored.
%
%\paragraph{The expansion settings}
% consist of \meta{character}\,=\,\meta{expansion factor} pairs.
%
% You may specify one number for each character, which determines the amount
% that a character may be expanded. The numbers denominate thousandths of the
% full expansion.
% For example, if you set the expansion factor for the character `O' to 500,
% it will only be expanded or shrunk by one half of the amount that the rest
% of the characters will be expanded or shrunk.
% While the default value for character protrusion is~0~-- that is, if you
% didn't specify any characters, none would be protruded~--, the default value
% for expansion is 1000, which means that all characters would be expanded by
% the same amount.
%
%\paragraph{The set of fonts}
% is declared in the same way as for \cs{SetProtrusion}.
%
%\paragraph{Options:}
%\begin{options}
%   \item[\Key{name}, \Key{load}]
%        Like in \cs{SetProtrusion}, the first argument can be used to assign a
%        name to the list, and to load another list.
%   \item[\Key{auto}, \Key{stretch}, \Key{shrink}, \Key{step}]
%        These keys can be used to override the global settings from the package
%        options. If you don't specify either one of |stretch|, |shrink| and
%        |step|, their respective global value will be used (that is, no
%        calculation will take place).\par
%        As a practical example, suppose you have a paragraph containing a widow
%        that could easily be avoided by shrinking the font a little bit more.
%        You could take advantage of the |stretch| and |shrink| options to
%        allow for more expansion in this particular paragraph. There is one
%        problem that has to be worked around, however: \pdftex\ prohibits the
%        use of the same font with different expansion parameters. If you do
%        not want to create a clone of the font setup (this would require
%        duplicating the \file{vf}/\file{tfm} files under a new name, and
%        writing new \file{fd} files and \file{map} entries), you could exploit
%        a dirty trick and load a minimally larger font for the paragraph in
%        question. E.\,g., for a document printed in 10pt:\footnote{
%            Note that the \cmd{\expandpar} command can only be applied to
%            complete paragraphs. If you are using Computer Modern Roman, you
%            have to load the \pkg{fix-cm} package to be able to select fonts
%            in arbitrary sizes. Finally, the reason I suggest to use a larger
%            font, and not a smaller one, is to prevent a different design size
%            being selected.}
%{\lstset{gobble=2}
%\begin{verbatim}
% \SetExpansion
%    [ stretch = 60,
%      shrink  = 60 ]
%    { encoding = *,
%      size = 10.001 }
%    { }
% \newcommand{\expandpar}[1]
%    {{\fontsize{10.001}{\baselineskip}\selectfont #1}}
% % ...
% \expandpar{This paragraph contains an `unnecessary' widow.}
%\end{verbatim}}
%   \item[\Key{factor}]
%        This option provides a different method to alter expansion settings for
%        certain fonts, working around another restriction of \pdftex: It does
%        not allow different expansion limits or steps within one paragraph.
%        The |factor| option influences the expansion factors of all characters
%        (in contrast to the overall stretchability) of the font. For instance,
%        if you want the italic shape to be expanded less, you could declare:
%\begin{verbatim}
%\SetExpansion
%   [ factor   = 500 ]
%   { encoding = *,
%     shape    = it }
%   { }
%\end{verbatim}
%\vspace{-\medskipamount}
%        The |factor| option can only be used to \emph{decrease} the
%        stretchability of the characters, that is, it may only receive values
%        smaller than 1000. Also, it can only be used for single fonts or font
%        sets; setting it globally in the package options wouldn't make much
%        sense -- to this end, you use the package's \opt{stretch} and
%        \opt{shrink} options.
%\end{options}
%
%\medskip\noindent
% These options in the optional first argument will even be taken into account
% if the package has not been loaded with the \opt{selected} option.
%
% If the \opt{selected} option has been passed to the package (cf.
% section~\ref{sub:options-expansion}), and settings for a font don't exist,
% font expansion will not be applied to this font at all. Should the
% extraordinary situation arise that you want to employ selected expansion in
% general but that all characters of a particular font (set) should be expanded
% or shrunk by the same amount, you would have to declare an empty list for
% these fonts.
%
%\subsection{Character Inheritance}\label{sub:inherit}
%
% \Describe{Macro}{\DeclareCharacterInheritance}
%                 {?|protrusion|\textbar|expansion|,font set,inheritance list}
% In most cases, accented characters should inherit the protrusion resp.
% expansion factors from the respective base character. For example, all of the
% characters \`A, \'A, \^A, \~A, \"A, \r{A} and \u{A} should probably be
% protruded by the same (absolute) amount as the character A. Using the command
% \cs{DeclareCharacterInheritance}, you may declare such lists of characters,
% so that you then only have to set up the base characters. With the optional
% argument you may confine the scope of the list to protrusion resp. expansion.
% The font set can be declared in the usual way, with the only exception that
% you must specify exactly one encoding. The inheritance lists are to be
% declared as pairs of \meta{base character}\,|=|\,\meta{list of inheriting
% characters}. Unless you are using a different encoding or a very peculiarly
% shaped font, there should be no need to change the default character
% inheritance settings.
%
%\bigskip\noindent
% In the main configuration file \file{microtype.cfg} and the other
% font-specific configuration files, you can find examples of all these
% commands.
%
%\subsection{Configuration Files}\label{sub:config-file}
%
% The default configuration, consisting of inheritance settings for \otI,
% \lyI\ and \tI\ encoding, declarations of font sets and alias fonts, and
% generic protrusion and expansion settings, will be loaded from the file
% \file{microtype.cfg}. You may extend this file with custom settings (or load
% a different configuration file with the `\opt{config}' option, see
% section~\ref{sub:options-general}).
%
% If you are embarking on creating new expansion and protrusion settings for a
% font family, you should put them into a separate file, whose name must be:
% `|mt-|\meta{font family}|.cfg|' (\eg\ `\file{mt-pad.cfg}'), and may contain
% the commands \cs{SetProtrusion}, \cs{SetExpansion} and
% \cs{DeclareCharacterInheritance}. These files will be loaded automatically if
% you are actually using the respective fonts. If the font name consists of
% four characters, the package will also try to find the file for the base font
% family by removing the suffix denoting the sub-family, so that you may put
% settings for the fonts |padx| (expert set), |padj| (oldstyle numerals) and
% |pad| (plain) into one and the same file.
%
%\begin{table}\small
%\begin{minipage}{\textwidth}
%\def\arraystretch{1.2}
%\let\footnoterule\relax
%\def\fnref#1{\textsuperscript{\itshape#1}}
%\settowidth{\dimen0}{(}
%\def\p{\hskip\dimen0}
%\caption{Fonts with tailored protrusion settings}\label{tab:fonts}
%\begin{tabular}{@{}L{170pt}L{31pt}L{75pt}*2{L{31pt}}@{}}
%\ifbooktabs\toprule\else\hline\fi
%          \footnotesize Font family (\nfss\ code)
%        & \multicolumn{4}{l}{\footnotesize Features} \\
%\ifbooktabs\cmidrule{2-5}\fi
%        & \footnotesize Series
%        & \footnotesize Shapes
%        & \footnotesize \tsI
%        & \footnotesize Math \\
%\ifbooktabs\cmidrule(r){1-1}\cmidrule(r){2-2}
%     \cmidrule(r){3-3}\cmidrule(r){4-4}\cmidrule{5-5}\else\hline\fi
% Generic
%        & m
%        & n, (it, sl, sc)\footnote{Incomplete}
%        & (\match)\fnref{a}\\
% Computer Modern Roman (|cmr|)\footnote{Also used for:
%           Latin Modern (|lmr|), \pkg{ae} (|aer|), \pkg{zefonts} (|zer|),
%           \pkg{eco} (|cmor|), \pkg{hfoldsty} (|hfor|)}
%        & m
%        & n, it, sl, sc
%        & \p\match
%        & \p\match \\
% Bitstream Charter (|bch|)
%        & m
%        & n, it, (sl)\footnote{Settings inherited from italic shape}, sc
%        & \p\match \\
% Adobe Garamond (|pad|, |padx|, |padj|)
%        & m
%        & n, it, (sl)\fnref{c}, sc
%        & \p\match \\
% Adobe Minion (|pmnx|, |pmnj|)
%        & m
%        & n, it, (sl)\fnref{c}, sc, si
%        & \p\match \\
% Palatino (|ppl|, |pplx|, |pplj|, |pxr|)
%        & m
%        & n, it, (sl)\fnref{c}, sc
%        & (\match)\fnref{a}  \\
% Times (|ptm|, |ptmx|, |ptmj|, |txr|)
%        & m
%        & n, it, (sl)\fnref{c}, sc
%        & (\match)\fnref{a}  \\
% \ams\ math fonts (|msa|, |msb|, |euf|, |eus|)
%        & m
%        & n
%        &
%        & \p\match \\
%\ifbooktabs\bottomrule\else\hline\fi
%\end{tabular}
%\end{minipage}
%\end{table}
%
% This package ships with configuration files for the font families Computer
% Modern Roman, Palatino, the inescapable Times, Adobe Garamond and
% Minion\footnote{
%     By courtesy of Harald Harders (\mailto{h.harders@tu-bs.de}).},
% for Bitstream Charter and the \ams\ math fonts.
% Table~\ref{tab:fonts} lists them all.
%
% If you have created a file for another font and you are willing to share,
% don't hesitate to send it to me so that it can be included in future releases
% of this package.
%
%\pagebreak ^^A layout
%\bigskip
%\Describe{Macro}{\DeclareMicrotypeAlias}{font name,alias font}
% You may use this command for fonts that are very similar, or actually the same
% (for instance if you did not stick to the Berry naming scheme when installing
% the font). An example would be the Latin Modern fonts which are clones of the
% Computer Modern fonts, so that it is not necessary to create new settings for
% them -- you could say:
%\begin{verbatim}
%\DeclareMicrotypeAlias{lmr}{cmr}
%\end{verbatim}
% which would make the package, whenever it encounters the font |lmr| and does
% not find settings for it, also try the font |cmr|. In fact, you will find
% this very line in the default configuration file, along with others for the
% virtual fonts provided by the packages \pkg{ae}, \pkg{zefonts}, \pkg{eco} and
% \pkg{hfoldsty}.
%
%\bigskip
%\Describe{Macro}{\LoadMicrotypeFile}{font name}
% In rare cases, it might be necessary to load a font configuration file
% manually, for instance, from within another configuration file, or to be able
% to extend settings defined in a file that would otherwise not be loaded
% automatically, or would be loaded too late.\footnote{
%     Font package authors might also want to have a look at the hook
%     \cs{Microtype@Hook}, described in the implementation part,
%     section~\ref{sub:hook}.}
% This command will load the file |mt-|\meta{font name}|.cfg|.
%
%
%\section{Hints and Caveats}\label{sec:caveats}
%
%\paragraph{Use settings that match your font.}
% Although the default settings should give reasonable results for most fonts,
% the particular font you happen to be using may have different character
% shapes that necessitate more or less protrusion or expansion. In particular,
% italic letter shapes may differ wildly in different fonts, hence I have
% decided against providing default protrusion settings for them.
%
% The file \file{test-microtype.tex} might be of some help when adjusting the
% protrusion settings for a font.
%
%\paragraph{Don't use too large a value for expansion.}
% Font expansion is a feature that is supposed to enhance the typographic
% quality of your document by producing a more uniform greyness of the text
% block (and potentially reducing the number of necessary hyphenations). When
% expanding or shrinking a font too much, the effect will be turned into the
% opposite. Expanding the fonts by more than 2\%, \ie, setting a \opt{stretch}
% limit of more than 20, should be justified by a typographically trained eye.
% If you are so lucky as to be in the possession of multiple instances of a
% Multiple Master font, you may set expansion limits to up to 4\%.
%
%\paragraph{Don't use font expansion for web documents.}
% Because each expanded instance of the font will be embedded in the \pdf\ file,
% the file size may increase by quite a large factor (depending on expansion
% limits and step). Therefore, courtesy and thriftiness of bandwidth command it
% not to enable font expansion when creating files to be distributed
% electronically.
%
%\paragraph{Compatibility.}
% The package should work happily together with all other \LaTeX\ packages
% (except \pkg{pdfcprot}). However, life isn't perfect, so problems are to be
% expected. Currently, you should be aware of the following issues concerning
% the loading order of packages:
%\begin{itemize}
%  \item All packages that change the default fonts and encodings (\eg\
%        \pkg{mathpazo}, \pkg{fontenc}) should be loaded before \microtype, so
%        that variables used in the configuration file (\eg\ `|rm*|' for
%        \cmd{\rmdefault}) don't expand to a different value than in the body of
%        the document (as explained in section~\ref{sub:font-sets}).
%  \item When using 8-bit characters in the configuration, \pkg{inputenc} must
%        be loaded first. Unicode input in the configuration is currently not
%        supported.
%  \item The \pkg{CJK} package must be loaded before \microtype.\footnote{
%           And it might still not work. I simply don't know, since I know
%           nothing about \pkg{CJK}. Feedback on the interaction of both
%           packages -- positive or negative -- would be appreciated.}
%\end{itemize}
%
%\paragraph{Possible error messages and how to get rid of them:}
%\begin{itemize}
%\lstset{belowskip=-\smallskipamount,frame=none,xleftmargin=0pt,backgroundcolor=}
%  \item
%\begin{verbatim}
%font ____ cannot be expanded (not an included Type1 font)
%\end{verbatim}
% Font expansion can only be applied if the font is actually embedded in the
% \pdf\ file. If you receive the above message, your \TeX\ system is not set up
% to embed (or `download') the base PostScript fonts (\eg\ Times, Helvetica,
% Courier). In most \TeX\ distributions, this can be changed in the file
% \file{updmap.cfg} by setting |pdftexDownloadBase14| to |true|. Otherwise,
% consult the local guide of your \TeX\ system.
%  \item
%\begin{verbatim}
%! TeX capacity exceeded, sorry [PDF memory size (pdf_mem_size)=65536].
%\end{verbatim}
% When applying micro-typographic enhancement to a large number of fonts, you
% may be running out of \pdftex\ memory. You can increase it by setting
% |pdf_mem_size| to a larger value (currently, the maximum is 524\,288). For
% te\TeX-based systems, change the settings in \file{texmf.cnf}, for
% MiK\TeX, in the file \file{miktex.ini}.
%\end{itemize}
%
%
%\section{Contributions}\label{sec:contrib}
%
% I would be glad to include configuration files for more fonts. Preparing such
% configurations is quite a time-consuming task and requires a lot of patience.
% To alleviate this process, this package also includes a test file that can be
% used to check at least the protrusion settings (\file{test-microtype.tex}).
%
% If you have created a configuration file for another font, or if you have any
% suggestions for enhancements in the default configuration files, I~would
% gratefully accept them: \mailtoRS.\footnote{
%     Should you have lots of \pkg{pdfcprot} configuration files lying around,
%     I can also provide you with a \TeX\ conversion script. Just ask me.}
%
%
%\section{Acknowledgments}
%
%\def\contributor#1 <#2\at#3>{#1 (\mailto{#2@#3})}
%\def\contributor#1 <#2\at#3>{\textit{#1}}
%
% This package would be pointless if \contributor\thanh{} <thanh\at pdftex.org>
% hadn't created the \pdftex\ programme in the first place, which introduced the
% micro-typographic extensions and made them available to the \TeX\ world.
% Furthermore, I thank him for helping me to improve this package, and not
% least for promoting it in [\cite{ThanhPracTeX}].
%
% \contributor Harald Harders <h.harders\at tu-bs.de> has contributed protrusion
% settings for Adobe Minion. I~would also like to thank him for a number of bug
% reports and suggestions he had to make.
% \contributor Andreas B\"uhmann <andreas.buehmann\at web.de> has suggested the
% possibility to specify ranges of font sizes, and resourcefully assisted in
% implementing this. He also came up with some good ideas for the management of
% complex configurations.
%
% I thank \contributor Philipp Lehman <plehman\at gmx.net> for adding to his
% \pkg{csquotes} package the possibility to restore the original meanings of
% all activated characters, thus allowing for these characters to be used in the
% configuration files.
% \contributor Peter Wilson <herries.press\at earthlink.net> kindly provided a
% hook in his \pkg{ledmac}/\pkg{ledpar} packages, so that critical editions can
% finally also benefit from character protrusion.
%
% Additionally, the following people have reported bugs or helped otherwise
% (in chronological order):
%  \contributor Ulrich Dirr       <ud\at art-satz.de>,
%  \contributor Tom Kink          <kink\at hia.rwth-aachen.de>,
%  \contributor Herb Schulz       <herbs\at wideopenwest.com>,
%  \contributor Michael Hoppe     <mh\at michael-hoppe.de>,
%  \contributor Gary~L. Gray      <gray\at engr.psu.edu>,
%  \contributor Georg Verweyen    <Georg.Verweyen\at web.de>,
%  \contributor Christoph Bier    <christoph.bier\at web.de>,
%  \contributor Peter Muthesius   <Pemu\at gmx.de>,
%  \contributor Bernard Gaulle    <gaulle\at idris.fr>,
%  \contributor Adam Kucharczyk   <adamk\at ijp-pan.krakow.pl>,
%  \contributor Mark Rossi        <mark.rossi\at de.bosch.com>,
%  \contributor Stephan Hennig    <stephanhennig\at arcor.de>,
% and
%  \contributor Michael Zedler    <Michael.Zedler\at tum.de>.
%
%
%\begin{thebibliography}{}
% \bibitem[Th\`anh 2000]{ThanhThesis}
%   \thanh, \emph{Micro-typographic extensions to the \TeX\ typesetting system},
%   \newblock Diss. Masaryk University Brno 2000,
%   \newblock in: \textit{TUGBoat}, vol.~21(2000), no.~4, pp.~317--434.
%   \newblock (Online at \url{http://www.tug.org/TUGboat/Articles/tb21-4/tb69thanh.pdf})
%
%\iffalse
% \bibitem[Th\`anh 2001]{ThanhTUG}
%   \thanh, \emph{Margin Kerning and Font Expansion with \pdftex},
%   \newblock in: \textit{TUGBoat}, vol.~22(2001), no.~3 -- Proceedings of the
%            2001 Annual Meeting, pp.~146--148.
%   \newblock (Online at \url{http://www.tug.org/TUGboat/Articles/tb22-3/tb72thanh.pdf})
%\fi
%
%\bibitem[Th\`anh 2004]{ThanhPracTeX}
%   \thanh, \emph{Micro-typographic Extensions of \pdftex\ in Practice},
%   \newblock in: \textit{TUGBoat}, vol.~25(2004), no.~1 -- Proceedings of the
%            Practical \TeX\ 2004 Conference, pp.~35--38.
%   \newblock (Online at \url{http://www.tug.org/TUGboat/Articles/tb25-1/thanh.pdf})
%
%\iffalse
% \bibitem[Th\`anh 2005]{ThanhEuroTeX}
%   \thanh, \emph{Experiences with micro-typographic extensions of \pdftex\ in practice},
%   \newblock in: Proceedings of Euro\TeX\ 2005, 15\textsuperscript{th}~Annual
%           Meeting of the European \TeX\ Users, March~7 -- March~11, 2005,
%           Abbaye des Pr\'emontr\'es, Pont-\`a-Mousson, pp.~81--88.
%   \newblock (Online at \url{http://www.dante.de/dante/events/eurotex/papers/TUT07.pdf})
%\fi
%
% \bibitem[\pdftex\ manual]{pdftexman}
%   \thanh, Sebastian Rahtz, Hans Hagen, Hartmut Henkel, \emph{The \pdftex\ user manual},
%   \newblock April 28, 2005.
%   \newblock (Available from \ctan\ at \ctanurl{/systems/pdftex/manual},
%              latest version at \url{http://sarovar.org/projects/pdftex/})
%
% \bibitem[\LaTeXe\ font selection]{fntguide}
%   \LaTeX3 Project Team, \emph{\LaTeXe\ font selection},
%   \newblock February 10, 2004.
%   \newblock (Available from \ctan\ at \ctanurl{/macros/latex/doc/fntguide.pdf})
%
% \bibitem[\texttt{pdfcprot}]{pdfcprot}
%   Carsten Schurig, \emph{The |pdfcprot.sty| package},
%   \newblock August 14, 2002.
%   \newblock (Available from \ctan\ at \ctanurl{/macros/latex/contrib/pdfcprot/})
%\end{thebibliography}
%
%
%\section{Short History}\label{sec:short-history}
%\changes{v1.5}{2004/12/11}{new: Short History (section~\ref{sec:short-history})}
%
% The comprehensive list of changes can be
% \expandafter\ifx\csname r@sec:changes\endcsname\relax
%     obtained by running `\texttt{makeindex \mbox{-s gglo.ist}
%                                  \mbox{-o microtype.gls} microtype.glo}'^^A
% \else
%     found in appendix~\ref{sec:changes}^^A
% \fi.
% The following is a list of all changes relevant in the user land; bug fixes
% are swept under the rug.
%
%\newenvironment{History}
%  {\list{}{
%     \leftmargin 15pt
%     \itemindent-15pt
%     \labelwidth 22pt
%     \labelsep 0pt
%     \parsep 0pt
%     \itemsep 0pt plus 2pt
%     \def\makelabel##1{##1\hss}
%     }}
%  {\endlist}
%\def\Version #1 (#2.#3.#4){
%  \vskip 1ex plus 1pt
%  \pagebreak[2]
%  \VersionDate{#1}{#4/#3/#2}
%  \item[#1](\number#2.\,\number#3.\,#4)^^A \number removes leading zeroes
%  \nopagebreak[4]
%}
%\def\VersionDate#1#2{^^A needed in the Change History
%  \global\expandafter\def\csname MTversiondate#1\endcsname{#2}}
%
%\begin{History}
%\Version 1.8 (23.06.2005)
%  \item If font substitution has occurred, the settings for the substitute will
%        be used instead of those for the selected font
%  \item New command \cs{DeclareMicrotypeSetDefault} to declare the default font
%        sets (see section~\ref{sub:font-sets})
%  \item New option `\opt{config}' to load a different configuration file
%        (see section~\ref{sub:options-general})
%  \item New option `\opt{unit}' to measure protrusion factors relative to a
%        dimension instead of the character width
%        (see section~\ref{sub:protrusion})
%  \item Renamed commands from \cs{..MicroType..} to \cs{..Microtype..}
%  \item Protrusion settings for \ams\ math fonts
%  \item Protrusion settings for Times in \lyI\ encoding completed
%  \item The `|allmath|' font set also includes |U| encoding
%  \item 8-bit characters in the configuration files finally work as advertised,
%        even if made active by the \pkg{csquotes} package
%  \item When using the \pkg{ledmac} package, character protrusion will work
%        for the first time ever (requires \pdftex\ version 1.30 or later)
%\Version 1.7 (23.03.2005)
%  \item Possibility to specify ranges of font sizes in the set declarations
%        and protrusion and expansion settings
%        (see sections~\ref{sub:font-sets} and~\ref{sub:fine-tuning})
%  \item Always take font size into account when trying to find protrusion resp.
%        expansion settings for a given font
%        (see section~\ref{sub:fine-tuning})
%  \item New command \cs{LoadMicrotypeFile} to load a font configuration file
%        manually (see section~\ref{sub:config-file})
%  \item Hook \cs{Microtype@Hook} for font package authors (see section~\ref{sub:hook})
%  \item New option `\opt{verbose}|=errors|' to turn all warnings into errors
%^^A  \item Compatibility with the \pkg{chemsym} and \pkg{statex} packages
%  \item Disable expansion inside \cmd{\showhyphens}
%  \item Warning when running in draft mode
%\Version 1.6a (02.02.2005)
%  \item Compatibility with the \pkg{frenchpro} package
%\Version 1.6 (24.01.2005)
%  \item New option `\opt{factor}' to influence protrusion resp. expansion of
%        all characters of a font or font set
%        (see sections~\ref{sub:options-protrusion} and~\ref{sub:fine-tuning})
%  \item When \pdftex\ is too old to expand fonts automatically, expansion
%        has to be enabled explicitly, automatic expansion will be disabled
%        (see section~\ref{sub:options-general})
%  \item Protrusion settings of digits improved
%  \item Use \etex\ extensions, if available
%\Version 1.5 (15.12.2004)
%  \item When output mode is \dvi, font expansion has to be enabled
%        explicitly, automatic expansion will be disabled
%        (see section~\ref{sub:options-general})
%  \item New option `\opt{selected}' to enable selected expansion
%        (see sections~\ref{sub:options-expansion} and \ref{sub:expansion});
%        default is: |false|
%  \item New default for expansion option `\opt{step}': 4 (min(\opt{stretch},\opt{shrink})/5)
%        (see section~\ref{sub:options-expansion})
%  \item Protrusion settings for Bitstream Charter
%  \item Compatibility with Turkish \pkg{babel}
%\Version 1.4b (26.11.2004)
%  \item \cs{UseMicrotypeSet} requires the set to be declared
%        (see section~\ref{sub:font-sets})
%  \item Internal optimization
%^^A\Version 1.4a (17.11.2004)
%^^A  \item Bug fix update (font setup inside |tabular|s)
%\VersionDate{1.4a}{2004/11/17}
%\Version 1.4 (12.11.2004)
%  \item Set up fonts independently from \LaTeX\ font loading
%        (therefore, no risk of overlooking fonts anymore, and the package may
%        be loaded at any time)
%  \item \cs{microtypesetup} now sets the correct level of protrusion
%        (see chapter~\ref{sec:user-command})
%  \item New option: `\opt{final}'
%\Version 1.3 (27.10.2004)
%  \item Compatibility with the \pkg{german} and \pkg{ngerman} packages
%\Version 1.2 (03.10.2004)
%  \item New font sets: `|allmath|' and `|basicmath|'
%        (see section~\ref{sub:font-sets} and table~\ref{tab:predefined-font-sets})
%  \item Protrusion settings for Computer Modern Roman math symbols
%  \item Protrusion settings for \tsI\ encoding completed for Computer Modern
%        Roman and Adobe Garamond
%  \item If an alias font name is specified, it will be used as an alternative,
%        not as a replacement (see section~\ref{sub:config-file})
%  \pagebreak[2]
%  \item More tests for sanity of settings and whether all fonts will be set up
%  \item More robust parsing of sizes in font sets
%\Version 1.1 (21.09.2004)
%  \item Protrusion settings for Adobe Minion, contributed by Harald Harders
%  \item New command: \cs{DeclareCharacterInheritance}
%        (see section~\ref{sub:inherit})
%  \item Characters may also be specified as octal or hexadecimal numbers
%        (see section~\ref{sub:fine-tuning})
%  \item Configuration file names in lowercase (see section~\ref{sub:config-file})
%\Version 1.0 (11.09.2004)
%  \item First \ctan\ release
%\end{History}
%
%
% \StopEventually{
%   \typeout{:?1000} ^^A tell WinEdt not to bother about overfull boxes
%   \appendix
%   \PrintChanges
%   \PrintIndex
%   \typeout{:?1111}
% }
%
%
% ^^A =========================================================================
%
%\DoNotIndex{\!,\",\',\(,\),\*,\+,\,,\-,\.,\/,\:,\;,\<,\=,\>,\?,\[,\\,\],\`,
%  \#,\$,\%,\&,\^,\_,\|,\~,\ } ^^A doesn't work: \{,\}
%\DoNotIndex{\advance,\begingroup,\catcode,\char,\chardef,\csname,\def, ^^A TeX
%  \divide,\edef,\else,\endcsname,\endgroup,\endinput,\escapechar,\expandafter,
%  \fi,\gdef,\global,\hbox,\if,\ifcase,\ifdim,\ifhbox,\ifnum,\ifx,\input,\kern,
%  \let,\meaning,\multiply,\newcount,\newdimen,\newif,\newtoks,\noexpand,\number,
%  \or,\relax,\romannumeral,\setbox,\space,\string,\the,\uppercase,\wd,\xdef}
%^^A\DoNotIndex{\font,\fontdimen,\nullfont}
%\DoNotIndex{\@backslashchar,\@cclv,\@cclvi,\@classoptionslist,\@currext, ^^A LaTeX
%  \@currname,\@defaultunits,\@empty,\@expandtwoargs,\@firstoftwo,\@gobble,
%  \@ifnextchar,\@ifpackagelater,\@ifpackageloaded,\@ifpackagewith,\@ifstar,\@m,
%  \@makeother,\@nameuse,\@ne,\@nil,\@nnil,\@nodocument,\@onelevel@sanitize,
%  \@onlypreamble,\@ptionlist,\@removeelement,\@secondoftwo,\@spaces,\@tempa,
%  \@tempb,\@tempc,\@tempcnta,\@tempcntb,\@tempdima,\@tempswafalse,\@tempswatrue,
%  \@undefined,\@unprocessedoptions,\@unusedoptionlist,\g@addto@macro,\if@tempswa,
%  \m@ne,\p@,\thr@@,\toks@,\tw@,\z@}
%\DoNotIndex{\active,\c,\H,\makeatletter,\newcommand,\renewcommand,\AtBeginDocument,
%  \AtEndOfPackage,\CheckCommand,\CurrentOption,\IfFileExists,\InputIfFileExists,
%  \MessageBreak,\PackageError,\PackageInfo,\PackageWarning,\RequirePackage}
%^^A\DoNotIndex{\@@enc@update,\cf@encoding,\do@subst@correction,\f@encoding,
%^^A  \font@name,\normalfont,\normalsize,\pickup@font,\set@fontsize,\strip@pt}
%\DoNotIndex{\detokenize,\dimexpr,\eTeXversion,\ifcsname,\ifdefined,\numexpr} ^^A e-TeX
%^^A\DoNotIndex{\fontcharwd}
%^^A\DoNotIndex{\efcode,\lpcode,\rpcode,\leftmarginkern,\rightmarginkern,\pdf*} ^^A pdfTeX
%^^A\DoNotIndex{\define@key,\KV@@sp@def,\setkeys} ^^A keyval
%\DoNotIndex{\@inpenc@undefined@,\@tabacckludge,\IeC} ^^A inputenc
%\DoNotIndex{\@disablequotes} ^^A csquotes
%\DoNotIndex{\percentsign}    ^^A Spanish babel
%\DoNotIndex{\l@dunhbox@line} ^^A ledmac
%\DoNotIndex{\vbox,\color@begingroup,\everypar,\parfillskip,\z@skip,\hsize,  ^^A \showhyphens
%  \maxdimen,\pretolerance,\tolerance,\hbadness,\showboxdepth,\color@endgroup}
%\DoNotIndex{\CHAR,\KVo@tempa,\MT@dinfo,\MT@dinfo@nl,\tracingmicrotype,\x,\y} ^^A microtype
%
% ^^A -------------------------------------------------------------------------
%
%\newpage
%\ImplementationSettings
%
%\section{Implementation}
%
% The \pkg{docstrip} modules in this file are:
%\begin{description}
%  \item[|driver|:]  The documentation driver, only visible in the \file{dtx} file.
%  \item[|package|:] The code for the \microtype\ package (\file{microtype.sty}).
%  \begin{description}
%  \item[|debug|:]   Code for additional output in the log file.\\
%                    Used for -- surprise! -- debugging purposes.
%  \end{description}
%  \item[|config|:]  Surrounds all configuration modules.
%  \begin{description}
%  \item[|m-t|:]     The main configuration file (\file{microtype.cfg}).
%  \item[|bch|:]     Settings for Bitstream Charter (\file{mt-bch.cfg}).
%  \item[|cmr|:]     Settings for Computer Modern Roman (\file{mt-cmr.cfg}).
%  \item[|pad|:]     Settings for Adobe Garamond (\file{mt-pad.cfg}).
%  \item[|ppl|:]     Settings for Palatino (\file{mt-ppl.cfg}).
%  \item[|ptm|:]     Settings for Times (\file{mt-ptm.cfg}).
%  \item[|pmn|:]     Settings for Adobe Minion (\file{mt-pmn.cfg}). \\
%                    Contributed by Harald Harders.
%  \item[|cfg-u|:]   Surrounds non-text (|U|) configurations.
%  \begin{description}
%  \item[|msa|:]     Settings for \ams\ `a' symbol font (\file{mt-msa.cfg}).
%  \item[|msb|:]     Settings for \ams\ `b' symbol font (\file{mt-msb.cfg}).
%  \item[|euf|:]     Settings for \ams\ Euler Fraktur font (\file{mt-euf.cfg}).
%  \item[|eus|:]     Settings for \ams\ Euler script font (\file{mt-eus.cfg}).
%  \end{description}
%  \end{description}
%  \item[|test|:]    A helper file that may be used to create and test
%                    protrusion settings (\file{test-microtype.tex}).
%\end{description}
% And now for something completely different.
%
%    \begin{macrocode}
%<*package>
\RequirePackage{keyval}[1997/11/10]
%    \end{macrocode}
%\begin{macro}{\MT@error}
%\begin{macro}{\MT@warning}
%\begin{macro}{\MT@warning@nl}
%\begin{macro}{\MT@warn@err}
%\changes{v1.7}{2005/03/16}{new macro: for \opt{verbose}\quotechar=\texttt{errors}}
%\begin{macro}{\MT@info}
%\begin{macro}{\MT@info@nl}
%\begin{macro}{\MT@vinfo}
%\changes{v1.6}{2005/01/06}{new macro: used instead of \cs{ifMT@verbose}}
% Communicate.
%    \begin{macrocode}
\def\MT@error{\PackageError{microtype}}
\def\MT@warning{\PackageWarning{microtype}}
\def\MT@warning@nl#1{\MT@warning{#1\@gobble}}
\def\MT@warn@err#1{\MT@error{#1}{%
   This error message appears because you loaded the `microtype'\MessageBreak
   package with the option `verbose=errors'. Consult the documentation\MessageBreak
   in microtype.(pdf,dvi) to find out what went wrong.}}
\def\MT@info{\PackageInfo{microtype}}
\def\MT@info@nl#1{\MT@info{#1\@gobble}}
%<!debug>\let\MT@vinfo\@gobble
%<debug>\let\MT@vinfo\MT@info@nl
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
% These are all commands for the outside world. We define them here as dummy
% commands, so that they won't generate an error if we are not running \pdftex.
%    \begin{macrocode}
\newcommand*\DeclareMicrotypeSet[3][]{}
\newcommand*\UseMicrotypeSet[2][]{}
\newcommand*\DeclareMicrotypeSetDefault[2][]{}
\newcommand*\DeclareMicrotypeAlias[2]{}
\newcommand*\SetProtrusion[3][]{}
\newcommand*\SetExpansion[3][]{}
\newcommand*\DeclareCharacterInheritance[3][]{}
\newcommand*\LoadMicrotypeFile[1]{}
\newcommand*\microtypesetup[1]{}
%    \end{macrocode}
% This command also has a starred version.
%    \begin{macrocode}
\def\DeclareMicrotypeSet{%
   \@ifstar
      {\@ifnextchar[\MT@DeclareSet{\MT@DeclareSet[]}}%
      {\@ifnextchar[\MT@DeclareSet{\MT@DeclareSet[]}}%
}
\def\MT@DeclareSet[#1]#2#3{}
%    \end{macrocode}
% Set declarations are only allowed in the preamble (resp. the main
% configuration file). \cs{SetExpansion} and \cs{SetProtrusion}, on the other
% hand, must be allowed in the document, too, since they may be loaded from
% font configuration files.
%    \begin{macrocode}
\@onlypreamble{\DeclareMicrotypeSet}
\@onlypreamble{\UseMicrotypeSet}
\@onlypreamble{\DeclareMicrotypeSetDefault}
%    \end{macrocode}
%\begin{macro}{\MT@old@cmd}
% The old command names had one more hunch.
%\changes{v1.8}{2005/04/28}{renamed commands from \cs{..MicroType..} to
%                           \cs{..Microtype..}}
%    \begin{macrocode}
\def\MT@old@cmd#1#2{%
   \MT@warning{\string#1 is deprecated. Please use\MessageBreak
               \string#2 instead}%
   \let#1#2#2}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\newcommand*\DeclareMicroTypeSet{%
 \MT@old@cmd\DeclareMicroTypeSet
            \DeclareMicrotypeSet}
\newcommand*\UseMicroTypeSet{%
 \MT@old@cmd\UseMicroTypeSet
            \UseMicrotypeSet}
\newcommand*\DeclareMicroTypeAlias{%
 \MT@old@cmd\DeclareMicroTypeAlias
            \DeclareMicrotypeAlias}
\newcommand*\LoadMicroTypeFile{%
 \MT@old@cmd\LoadMicroTypeFile
            \LoadMicrotypeFile}
%<*debug>
%    \end{macrocode}
% Debug. Cases for \cs{tracingmicrotype}:
%\begin{itemize}
%  \item[|0|:] almost none
%  \item[|1|:] + sets \& lists
%  \item[|2|:] + heirs
%  \item[|3|:] + slots
%  \item[|4|:] + factors
%\end{itemize}
%    \begin{macrocode}
\newcount\tracingmicrotype
\tracingmicrotype=\tw@
\def\MT@dinfo#1#2{\ifnum\tracingmicrotype<#1\relax\else\MT@info{#2}\fi}
\def\MT@dinfo@nl#1#2{\ifnum\tracingmicrotype<#1\relax\else\MT@info@nl{#2}\fi}
%</debug>
%    \end{macrocode}
%
%\subsection{Requirements}
%
%\begin{macro}{\MT@pdftex@no}
%\changes{v1.6a}{2005/02/02}{new macro}
% \pdftex's features for which we provide an interface here haven't always been
% available, and some specifics have changed over time. Therefore, we have to
% test which \pdftex\ we're using, if any. \cs{MT@pdftex@no} will be used
% throughout the package to respectively do the right thing.
%
% Currently, there are six cases:
%\begin{itemize}
%\ifcharter ^^A being picky...
%  \newcommand*\textgeq{\raisebox{.2ex}{\kern1pt\underline
%                       {\kern-1pt\textgreater\kern-1pt}\kern1pt}}
%\else
%  \newcommand*\textgeq{$\geq$}
%\fi
%  \item[|0|:] not running \pdftex
%  \item[|1|:] \pdftex\ (\textless\ 0.14f)
%  \item[|2|:] + micro-typographic extensions (0.14f, 0.14g)
%  \item[|3|:] + protrusion relative to 1em (\textgeq\ 0.14h)
%  \item[|4|:] + automatic font expansion; default \cmd{\efcode}\,=\,1000 (\textgeq\ 1.20)
%\changes{v1.8}{2005/04/15}{case 5: \pdftex\ 1.30}
%  \item[|5|:] + \cmd{\(left\textbar right)marginkern} (\textgeq\ 1.30)
%\end{itemize}
%\changes{v1.1}{2004/09/13}{bug fix concerning version check
%                           (reported by Harald Harders)}
%    \begin{macrocode}
\let\MT@pdftex@no\z@
%    \end{macrocode}
%\end{macro}
% Old packages might have defined \cmd{\pdftexversion} to \cmd{\relax}.
%    \begin{macrocode}
\ifx\pdftexversion\@undefined \else
   \ifx\pdftexversion\relax \else
%<debug>\MT@dinfo@nl{0}{running pdftex \the\pdftexversion(\pdftexrevision)}
      \def\MT@pdftex@no{5}
      \ifnum\pdftexversion < 130
         \def\MT@pdftex@no{4}
         \ifnum\pdftexversion < 120
            \let\MT@pdftex@no\thr@@
            \ifnum\pdftexversion = 14
               \ifnum \expandafter`\pdftexrevision < `h
                  \let\MT@pdftex@no\tw@
                  \ifnum \expandafter`\pdftexrevision < `f
                     \let\MT@pdftex@no\@ne
                  \fi
               \fi
            \else
               \ifnum\pdftexversion < 14
                  \let\MT@pdftex@no\@ne
               \fi
            \fi
         \fi
      \fi
   \fi
\fi
%<debug>\MT@dinfo@nl{0}{pdftex no: \number\MT@pdftex@no}
%    \end{macrocode}
% If we are not using \pdftex\ or in case it is too old, we disable everything
% and exit here.
%    \begin{macrocode}
\ifnum\MT@pdftex@no<\tw@
   \AtEndOfPackage{\let\@unprocessedoptions\relax}%
   \let\CurrentOption\@empty
   \MT@warning@nl{%
      \ifcase\MT@pdftex@no
         You don't seem to be using pdftex.\MessageBreak
      \or
         You are using a pdftex version older than 0.14f.\MessageBreak
         microtype won't work with such antiquated versions.\MessageBreak
         Please install a newer version of pdftex.\MessageBreak
      \fi
      All micro-typographic features will be disabled}
   \expandafter
   \endinput
\fi
%    \end{macrocode}
% Still there? Then we can begin:
%\begin{macro}{\MT@catcodes}
%\changes{v1.3}{2004/10/27}{check some category codes (compatibility with \pkg{german})}
%\changes{v1.5}{2004/12/03}{reset catcode of `\texttt{\^}' (compatibility with \pkg{chemsym})}
% We have to make sure that the category codes of some characters are correct
% (the \pkg{german} package, for instance, makes |"| active). Probably overly
% cautious. Ceterum censeo: It should be forbidden for packages to change
% catcodes within the preamble.
%    \begin{macrocode}
\def\MT@catcodes{%
   \catcode`\^7 %
   \@makeother\-%
   \@makeother\=%
   \@makeother\*%
   \@makeother\,%
   \@makeother\/%
   \@makeother\`%
   \@makeother\'%
   \@makeother\"%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@restore@catcodes}
% Polite as we are, we'll restore them afterwards.
%    \begin{macrocode}
\def\MT@restore@catcodes#1{%
   \ifx\relax#1\else
      \noexpand\catcode`\noexpand#1\the\catcode`#1\relax
      \expandafter\MT@restore@catcodes
   \fi
}
\edef\MT@restore@catcodes{%
   \MT@restore@catcodes\^\-\=\*\,\/\`\'\"\relax
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@catcodes
\AtEndOfPackage{\MT@restore@catcodes}
%    \end{macrocode}
%\begin{macro}{\ifMT@DVIoutput}  \IndexNewif{MT@DVIoutput}
%\begin{macro}{\ifMT@draft}      \IndexNewif{MT@draft}
%\begin{macro}{\ifMT@protrusion} \IndexNewif{MT@protrusion}
%\begin{macro}{\ifMT@expansion}  \IndexNewif{MT@expansion}
%\begin{macro}{\ifMT@auto}       \IndexNewif{MT@auto}
%\begin{macro}{\ifMT@selected}   \IndexNewif{MT@selected}
% These are the global switches~\dots
%    \begin{macrocode}
\newif\ifMT@DVIoutput
\newif\ifMT@draft
\newif\ifMT@protrusion
\newif\ifMT@expansion
\newif\ifMT@auto
\newif\ifMT@selected
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@ex@level}
%\begin{macro}{\MT@pr@level}
%\begin{macro}{\MT@factor}
%\begin{macro}{\MT@pr@unit}
%\begin{macro}{\MT@ex@factor}
%\begin{macro}{\MT@stretch}
%\begin{macro}{\MT@shrink}
%\begin{macro}{\MT@step}
% \dots~and numbers.
%    \begin{macrocode}
\let\MT@ex@level\tw@
\let\MT@pr@level\tw@
\let\MT@factor\@m
\let\MT@pr@unit\@empty
\let\MT@ex@factor\@m
\let\MT@stretch\m@ne
\let\MT@shrink\m@ne
\let\MT@step\m@ne
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@factor@default}
%\begin{macro}{\MT@stretch@default}
%\begin{macro}{\MT@shrink@default}
%\begin{macro}{\MT@step@default}
% Default values.
%    \begin{macrocode}
\def\MT@factor@default{1000 }
\def\MT@stretch@default{20 }
\def\MT@shrink@default{20 }
\def\MT@step@default{4 }
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%
% \subsection{Compatibility}
%
% For the record, the following \LaTeX\ commands will be modified by \microtype:
%\begin{itemize}
%  \item \cmd{\pickup@font}
%  \item \cmd{\do@subst@correction}
%  \item \cmd{\add@accent}
%  \item \cmd{\showhyphens}
%\end{itemize}
%
%\begin{macro}{\MT@pdfcprot@error}
%\changes{v1.4}{2004/11/04}{check for \pkg{pdfcprot}}
% Our competitor, the \pkg{pdfcprot} package, must not be tolerated!
%    \begin{macrocode}
\def\MT@pdfcprot@error{%
   \MT@error{Detected the `pdfcprot' package!\MessageBreak
             `microtype' and `pdfcprot' may not be used together}{%
The `pdfcprot' package provides an interface to character protrusion.\MessageBreak
So does the `microtype' package. Using both packages at the same\MessageBreak
time will almost certainly lead to undesired results. Have your choice!}%
   \let\MT@pdfcprot@error\relax
}
\@ifpackageloaded{pdfcprot}\MT@pdfcprot@error\relax
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@ledmac@setup}
% The \pkg{ledmac} package first saves each paragraph in a box, from which it
% then splits off the lines one by one. This will destroy character protrusion.
% (There aren't any problems with the \pkg{lineno} package, since it takes a
% different approach.)
%\iffalse
% We issue a warning, so that nobody can say they didn't know.
%^^A\changes{v1.6}{2004/12/29}{warning when using the \pkg{ledmac} package}
% --- This is fixed in \pdftex\ 1.21a, so we no longer warn.
%^^A\changes{v1.6a}{2004/02/02}{no warning when using the \pkg{ledmac} package}
% --- Actually, it was completely broken in 1.21a, but 1.21b provides a work-around.
%\fi
% ---
%\changes{v1.8}{2005/04/15}{character protrusion with \pkg{ledmac}}
% After much to and fro, the situation has finally settled and there is a fix.
% Beginning with \pdftex\ version 1.21b together with \file{ledpatch.sty} as of
% 2005/06/02 (v0.4), character protrusion will work at last.
%
% Peter Wilson was so kind to provide the \cmd{\l@dunhbox@line} hook in
% \pkg{ledmac} to allow for protrusion. \cmd{\leftmarginkern} and
% \cmd{\rightmarginkern} are new primitives of \pdftex\ 1.21b (aka 1.30).
%    \begin{macrocode}
\def\MT@ledmac@setup{%
   \ifMT@protrusion
      \ifnum\MT@pdftex@no > 4
         \MT@ifdefined@c\l@dunhbox@line{%
            \MT@info@nl{Patching ledmac to enable character protrusion}%
            \newdimen\MT@led@kern
            \let\MT@led@unhbox@line\l@dunhbox@line
            \renewcommand*{\l@dunhbox@line}[1]{%
               \ifhbox##1%
                  \MT@led@kern=\rightmarginkern##1%
                  \kern\leftmarginkern##1%
                  \MT@led@unhbox@line##1%
                  \kern\MT@led@kern
               \fi
            }%
         }{\MT@warning@nl{%
            Character protrusion in paragraphs with line\MessageBreak
            numbering will only work if you update ledmac}%
         }%
      \else\MT@warning@nl{%
            The pdftex version you are using does not allow\MessageBreak
            character protrusion in paragraphs with line\MessageBreak
            numbering by the `ledmac' package.\MessageBreak
            Upgrade pdftex to version 1.30 or later}%
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@setupfont@hook}
% This hook will be executed every time a font is set up (inside a group).
%
% In the preamble, we check for the packages each time a font is set up.
% Thus, it will work regardless when the packages are loaded.
%
% Even for packages that don't activate any characters in the preamble (like
% \pkg{babel} and \pkg{csquotes}), we have to check here, too, in case they were
% loaded before \microtype, and a font is loaded \cmd{\AtBeginDocument}, before
% \microtype.
%    \begin{macrocode}
\def\MT@setupfont@hook{%
%    \end{macrocode}
%^^A\changes{v1.7}{2005/02/06}{compatibility with the \pkg{chemsym} package}
% The \pkg{chemsym} package redefines, among other commands, the Hungarian
% umlaut \cmd{\H} in a way that cannot be parsed by \microtype. As a work-around,
% we restore the usual definition of \cmd{\H} before setting up the font (which
% will be done inside a group).
%^^A\changes{v1.8}{2005/03/24}{remove superfluous \pkg{chemsym} hook}
% --- Since version 1.7, this is no longer needed, since our character parsing
% is robust enough now.
%
%^^A\changes{v1.7}{2005/03/10}{compatibility with the \pkg{statex} package}
% Same for \pkg{statex}.
%^^A\changes{v1.8}{2005/03/24}{remove superfluous \pkg{statex} hook}
% --- No longer needed, either.
%
% Spanish \pkg{babel} modifies the percent character, storing the original
% meaning in \cmd{\percentsign}.
%\changes{v1.8}{2005/03/30}{restore percent character if Spanish \pkg{babel} is loaded}
%    \begin{macrocode}
   \@ifpackagewith{babel}{spanish}{%
      \MT@ifdefined@c\percentsign
         {\let\%\percentsign}\relax
   }\relax
%    \end{macrocode}
%\changes{v1.8}{2005/04/22}{restore \pkg{csquotes}'s active characters}
% Using \cmd{\@disablequotes}, we can restore the original meaning of all
% characters made active by \pkg{csquotes}.
% (It would be doable for older versions, too, but we won't bother.)
%    \begin{macrocode}
   \@ifpackageloaded{csquotes}{%
      \@ifpackagelater{csquotes}{2005/05/11}\@disablequotes\relax
   }\relax
%    \end{macrocode}
% \pkg{hyperref} redefines \cmd{\%} and \cmd{\#} inside a \cmd{\url}. We restore
% the original meanings (which we can only hope are correct).
%\changes{v1.8}{2005/05/20}{restore \cmd{\%} and \cmd{\#} when \pkg{hyperref} is loaded}
%    \begin{macrocode}
   \@ifpackageloaded{hyperref}{%
      \chardef\%`\%
      \chardef\#`\#
   }\relax
}
%    \end{macrocode}
%\end{macro}
% Check again at the end of the preamble.
%    \begin{macrocode}
\AtBeginDocument{%
   \@ifpackageloaded{pdfcprot}\MT@pdfcprot@error\relax
   \@ifpackageloaded{ledmac}\MT@ledmac@setup\relax
%    \end{macrocode}
% We can clean up \cs{MT@setupfont@hook} now.
%    \begin{macrocode}
   \let\MT@setupfont@hook\@empty
   \@ifpackagewith{babel}{spanish}{%
      \g@addto@macro\MT@setupfont@hook{%
         \MT@ifdefined@c\percentsign
            {\let\%\percentsign}\relax}%
   }\relax
   \@ifpackageloaded{csquotes}{%
      \@ifpackagelater{csquotes}{2005/05/11}{%
         \g@addto@macro\MT@setupfont@hook\@disablequotes
      }{%
         \MT@warning@nl{%
            Should you receive warnings about unknown slot\MessageBreak
            numbers, try upgrading the `csquotes' package}%
      }%
   }\relax
   \@ifpackageloaded{hyperref}{%
      \g@addto@macro\MT@setupfont@hook{%
         \chardef\%`\%
         \chardef\#`\#
      }%
   }\relax
}
%    \end{macrocode}
%\changes{v1.6}{2005/01/19}{load a font, if none is active}
% We need a font (the \pkg{minimal} class doesn't load one).
%    \begin{macrocode}
\expandafter\ifx\the\font\nullfont\normalfont\fi
%    \end{macrocode}
%
%\subsection{Auxiliary macros}
%
%\begin{macro}{\MT@etex@no}
% Test whether we are using \etex. Cases:
%\begin{itemize}
%  \item[|0|:] not running \etex
%  \item[|1|:] running \etex
%\end{itemize}
%    \begin{macrocode}
\let\MT@etex@no\z@
\ifx\eTeXversion\@undefined \else
   \ifx\eTeXversion\relax \else
      \ifnum\eTeXversion>\z@
         \let\MT@etex@no\@ne
      \fi
   \fi
\fi
%    \end{macrocode}
%\end{macro}
%\changes{v1.4b}{2004/11/21}{optimization: use less \cmd{\csname}s and \cmd{\expandafter}s}
%\begin{macro}{\MT@def@n}
% This is \cmd{\@namedef}.
%    \begin{macrocode}
\def\MT@def@n#1{\expandafter\def\csname #1\endcsname}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@edef@n}
% Its expanding version.
%    \begin{macrocode}
\def\MT@edef@n#1{\expandafter\edef\csname #1\endcsname}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@let@nc}
% \cmd{\let} a \cmd{\csname} sequence to a command.
%    \begin{macrocode}
\def\MT@let@nc#1{\expandafter\let\csname #1\endcsname}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@let@cn}
% \cmd{\let} a command to a \cmd{\csname} sequence.
%    \begin{macrocode}
\def\MT@let@cn#1#2{\expandafter\let\expandafter#1\csname #2\endcsname}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@hop@else@fi}
% We need this a couple of lines down to mask \cs{ifcsname}~\dots\ \cs{fi} and
% \cs{ifdefined}~\dots\ \cs{fi}, if \cs{ifcsname} and \cs{ifdefined} aren't
% defined.
%    \begin{macrocode}
\def\MT@hop@else@fi#1\else#2\fi{\fi#1}
%    \end{macrocode}
%\end{macro}
%\changes{v1.6}{2005/01/19}{use \etex's \cs{ifcsname} and \cs{ifdefined} if defined}
%\begin{macro}{\MT@ifdefined@c}
%\begin{macro}{\MT@ifdefined@n}
% Wrapper for testing whether command resp. \cmd{\csname} sequence is defined.
%    \begin{macrocode}
\ifcase\MT@etex@no \MT@hop@else@fi
%<debug>\MT@dinfo@nl{0}{not running etex}%
   \def\MT@ifdefined@c#1{%
      \ifx#1\@undefined
         \expandafter\@secondoftwo
      \else
         \expandafter\@firstoftwo
      \fi
   }
   \def\MT@ifdefined@n#1{%
      \begingroup\expandafter\expandafter\expandafter\endgroup
      \expandafter\ifx\csname #1\endcsname\relax
         \expandafter\@secondoftwo
      \else
         \expandafter\@firstoftwo
      \fi
   }
\else
%    \end{macrocode}
% If we are running \etex, we will use its primitives \cs{ifdefined} and
% \cs{ifcsname}, which decreases memory use substantially.
%    \begin{macrocode}
%<debug>\MT@dinfo@nl{0}{running etex}%
   \def\MT@ifdefined@c#1{%
      \ifdefined#1%
         \expandafter\@firstoftwo
      \else
         \expandafter\@secondoftwo
      \fi
   }
   \def\MT@ifdefined@n#1{%
      \ifcsname#1\endcsname
         \expandafter\@firstoftwo
      \else
         \expandafter\@secondoftwo
      \fi
   }
\fi
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@ifempty}
% Test whether argument is empty.
%\changes{v1.1}{2004/09/15}{bug fix: use category code 12 for the percent character
%                           (reported by Tom Kink)} ^^A <kink\at hia.rwth-aachen.de>
%                                         ^^A in <MID:2qrkp9F134l6lU1@uni-berlin.de>
%    \begin{macrocode}
\begingroup
\catcode`\%=12
\catcode`\&=14
\gdef\MT@ifempty#1{&
  \if %#1%&
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
}
\endgroup
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@ifnumber}
% Test whether argument is a number [0-9] (using an old trick by Mr. Arseneau).
%    \begin{macrocode}
\def\MT@ifnumber#1{%
   \if!\ifnum9<1#1!\else?\fi
      \expandafter\@firstoftwo
   \else
      \expandafter\@secondoftwo
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@ifgt}
%\begin{macro}{\MT@iflt}
%\begin{macro}{\MT@ifeq}
% Test whether dimensions are smaller, larger resp. equal.
%    \begin{macrocode}
\def\MT@ifgt#1#2{%
   \ifdim #1\p@ > #2\p@
      \expandafter\@firstoftwo
   \else
      \expandafter\@secondoftwo
   \fi
}
\def\MT@iflt#1#2{%
   \ifdim #1\p@ < #2\p@
      \expandafter\@firstoftwo
   \else
      \expandafter\@secondoftwo
   \fi
}
\def\MT@ifeq#1#2{%
   \ifdim #1\p@ = #2\p@
      \expandafter\@firstoftwo
   \else
      \expandafter\@secondoftwo
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@xadd}
%\changes{v1.8}{2005/04/17}{simplified}
% Add item to a list.
%    \begin{macrocode}
\def\MT@xadd#1#2{%
   \ifx#1\relax
      \xdef#1{#2}%
   \else
      \xdef#1{#1#2}%
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@xaddb}
% Add item to the beginning.
%    \begin{macrocode}
\def\MT@xaddb#1#2{%
   \ifx#1\relax
      \xdef#1{#2}%
   \else
      \xdef#1{#2#1}%
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@map@clist@n}
%\changes{v1.8}{2005/04/17}{new macro: used instead of \cmd{\@for}}
%\begin{macro}{\MT@map@clist@c}
%\begin{macro}{\MT@map@clist@}
%\begin{macro}{\MT@clist@function}
%\begin{macro}{\MT@clist@break}
% Run \meta{\#2} on all elements of the comma list \meta{\#1}. This and the
% following is modelled after \LaTeX3 commands.
%    \begin{macrocode}
\def\MT@map@clist@n#1#2{%
   \ifx\@empty#1\else
      \def\MT@clist@function##1{#2}%
      \expandafter\MT@map@clist@
      \expandafter#1,\@nil,\@nnil,%
   \fi
}
\def\MT@map@clist@c#1{\expandafter\MT@map@clist@n\expandafter{#1}}
\def\MT@map@clist@#1,{%
   \ifx\@nil#1%
      \MT@clist@break
   \else
      \MT@clist@function{#1}%
      \expandafter\MT@map@clist@
   \fi
}
\def\MT@clist@break#1\@nnil,{\fi}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@map@tlist@n}
%\changes{v1.8}{2005/04/16}{new macro: used instead of \cmd{\@tfor}}
%\begin{macro}{\MT@map@tlist@c}
%\begin{macro}{\MT@map@tlist@}
%\begin{macro}{\MT@tlist@break}
% Execute \meta{\#2} on all elements of the token list \meta{\#1}.
% \cs{MT@tlist@break} can be used to jump out of the loop.
%    \begin{macrocode}
\def\MT@map@tlist@n#1#2{%
   \MT@map@tlist@#2#1\@nnil
}
\def\MT@map@tlist@c#1#2{%
   \expandafter\MT@map@tlist@
   \expandafter#2#1\@nnil
}
\def\MT@map@tlist@#1#2{%
   \ifx\@nnil#2\else
      #1{#2}%
      \expandafter\MT@map@tlist@
      \expandafter#1%
   \fi
}
\def\MT@tlist@break#1\@nnil{\fi}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\ifMT@inlist@}\IndexNewif{MT@inlist@}
%\begin{macro}{\MT@in@clist}
% Test whether item is in comma list.
%\changes{v1.4b}{2004/11/22}{bug fix: compare with \cmd{\\} instead of \cmd{\relax}
%                          (discovered by Herb Schulz)}  ^^A <herbs\at wideopenwest.com>
%                                      ^^A in <MID:BDBFA967.C01F%herbs@wideopenwest.com>
%    \begin{macrocode}
\newif\ifMT@inlist@
\def\MT@in@clist#1#2{%
   \MT@inlist@false
   \def\x##1#1,##2\@nnil{%
      \ifx\\##2\\\else
         \MT@inlist@true
      \fi
   }%
   \expandafter\x#2,#1,\@nnil
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@in@rlist}
%\changes{v1.8}{2005/04/20}{made recursive}
%\begin{macro}{\MT@in@rlist@}
%\begin{macro}{\MT@in@rlist@@}
%\begin{macro}{\MT@size@name}
% Test whether size \cs{MT@size} is in a list of ranges. Store the name of the
% list in \cs{MT@size@name}
%    \begin{macrocode}
\def\MT@in@rlist#1{%
   \MT@inlist@false
   \MT@map@tlist@c#1\MT@in@rlist@
}
\def\MT@in@rlist@#1{%
   \expandafter\MT@in@rlist@@#1%
}
\def\MT@in@rlist@@#1#2#3{%
   \MT@ifeq{#2}\m@ne{%
      \MT@ifeq{#1}\MT@size
         \MT@inlist@true
         \relax
      }{%
      \MT@iflt\MT@size{#1}\relax{%
         \MT@iflt\MT@size{#2}%
            \MT@inlist@true
            \relax
      }%
   }%
   \ifMT@inlist@
      \def\MT@size@name{#3}%
      \expandafter\MT@tlist@break
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@loop}
%\changes{v1.2}{2004/09/23}{bug fix: new macro, used instead of \cmd{\loop}}
%\begin{macro}{\MT@iterate}
%\begin{macro}{\MT@repeat}
% This is the same as \LaTeX's \cmd{\loop}, which we mustn't use, since this could
% confuse an outer \cmd{\loop} in the document.
%    \begin{macrocode}
\def\MT@loop#1\MT@repeat{%
   \def\MT@iterate{#1\relax\expandafter\MT@iterate\fi}%
   \MT@iterate
   \let\MT@iterate\relax
}
\let\MT@repeat\fi
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\changes{v1.4}{2004/11/12}{use one instead of five counters}
%\begin{macro}{\MT@count}
%\begin{macro}{\MT@increment}
% Increment macro \meta{\#1} by one. Saves using up too many counters.
%\changes{v1.7}{2005/03/07}{use \etex's \cmd{\numexpr} if available}
%    \begin{macrocode}
\newcount\MT@count
\ifcase\MT@etex@no
   \def\MT@increment#1{%
      \MT@count=#1\relax
      \advance\MT@count \@ne
      \edef#1{\number\MT@count}%
   }
\else
%    \end{macrocode}
% The \etex\ way is slightly faster.
%    \begin{macrocode}
   \def\MT@increment#1{%
      \edef#1{\number\numexpr #1 + 1\relax}%
   }
\fi
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@scale}
%\changes{v1.7}{2005/02/12}{new macro: use \etex's \cs{numexpr} if available}
%\changes{v1.8}{2005/03/30}{bug fix: remove spaces in non-\etex\ variant
%                           (reported by Mark Rossi)} ^^A <mark.rossi\at de.bosch.com>
%                                      ^^A in <d6uhag$qoi$1@ns2.fe.internet.bosch.com>
% Multiply and divide a counter. If we are using \etex, we will use its
% \cmd{\numexpr} primitive. This has the advantage that it is less likely to
% run into arithmetic overflow. The result of the division will be rounded
% instead of truncated. Therefore, we'll get a different (more accurate)
% result in about half of the cases.
%    \begin{macrocode}
\ifcase\MT@etex@no
   \def\MT@scale#1#2#3{%
      \multiply #1 #2\relax
      \ifnum #3 = \z@ \else
         \divide #1 #3\relax
      \fi
   }
\else
   \def\MT@scale#1#2#3{%
      \ifnum #3 = \z@
         #1=\numexpr #1 * #2\relax
      \else
         #1=\numexpr #1 * #2 / #3\relax
      \fi
   }
\fi
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@remove@spaces}
% Remove spaces around \meta{\#1} (\cmd{\KV@@sp@def} is from \pkg{keyval}).
% It will be neutralized in \cs{MT@begin@catcodes}.
%    \begin{macrocode}
\def\MT@remove@spaces#1{\expandafter\KV@@sp@def\expandafter#1\expandafter{#1}}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@make@string}
%\changes{v1.8}{2005/05/07}{use \cmd{\@onelevel@sanitize}}
% Set the category code of all characters to 12.
%    \begin{macrocode}
\let\MT@make@string\@onelevel@sanitize
%    \end{macrocode}
%\end{macro}
%\changes{v1.7}{2005/03/07}{shorter command names}
%\begin{macro}{\MT@abbr@pr}
%\begin{macro}{\MT@abbr@ex}
%\begin{macro}{\MT@abbr@pr@c}
%\begin{macro}{\MT@abbr@ex@c}
%\begin{macro}{\MT@abbr@pr@inh}
%\begin{macro}{\MT@abbr@ex@inh}
% Some abbreviations. Thus, we can have short command names but full-length
% log output.
%    \begin{macrocode}
\def\MT@abbr@pr{protrusion}
\def\MT@abbr@ex{expansion}
\def\MT@abbr@pr@c{protrusion codes}
\def\MT@abbr@ex@c{expansion codes}
\def\MT@abbr@pr@inh{protrusion inheritance}
\def\MT@abbr@ex@inh{expansion inheritance}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@rbba@protrusion}
%\begin{macro}{\MT@rbba@expansion}
% These we also need the other way round.
%    \begin{macrocode}
\def\MT@rbba@protrusion{pr}
\def\MT@rbba@expansion{ex}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%
%\subsection{Setting up a font}
%
%\begin{macro}{\MT@setupfont}
% Setting up a font entails checking whether protrusion/expansion is desired for
% the current font (\cs{MT@font@name}), and if so, adjusting \cmd{\lpcode} and
% \cmd{\rpcode} (protrusion) and \cmd{\efcode} (expansion) for each character.
%    \begin{macrocode}
\def\MT@setupfont{%
   \ifx\MT@vinfo\MT@info@nl
      \MT@info{Setting up font `\expandafter\string\MT@font@name'}\fi
%    \end{macrocode}
% We might have to disable stuff when used together with adventurous packages.
%    \begin{macrocode}
   \MT@setupfont@hook
%    \end{macrocode}
% The font properties must be extracted from \cs{MT@font@name}, since the current
% value of \cmd{\f@encoding} and friends may be wrong!
%    \begin{macrocode}
   \expandafter\expandafter\expandafter
      \MT@split@name\expandafter\string\MT@font@name\@nil
%    \end{macrocode}
% Try to find a configuration file for the current font family.
%\changes{v1.2}{2004/09/29}{also search for alias font file}
%    \begin{macrocode}
   \expandafter\MT@find@file\expandafter{\MT@family}%
   \ifx\MT@familyalias\@empty\else
      \expandafter\MT@find@file\expandafter{\MT@familyalias}\fi
%    \end{macrocode}
%\changes{v1.2}{2004/09/26}{bug fix: call \cmd{\@@enc@update} if necessary}
% We have to make sure that \cmd{\cf@encoding} expands to the correct value, which
% isn't the case when \cmd{\selectfont} chooses a new encoding (this would be
% done a second later in \cmd{\selectfont}, anyway -- three lines, to be exact).
%    \begin{macrocode}
   \ifx\f@encoding\cf@encoding\else\@@enc@update\fi
%    \end{macrocode}
% Protrusion has to be set up first, says Thành!
%    \begin{macrocode}
   \MT@checkfor{pr}%
   \ifMT@font@pr
      \MT@set@pr@codes
   \else
      \MT@vinfo{... No protrusion}%
   \fi
   \MT@checkfor{ex}%
   \ifMT@font@ex
      \MT@set@ex@codes
   \else
      \MT@vinfo{... No expansion}%
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\ifMT@font@pr}\IndexNewif{MT@font@pr}
%\begin{macro}{\ifMT@font@ex}\IndexNewif{MT@font@ex}
%\begin{macro}{\MT@checkfor}
% We check all features of the current font against the lists of the currently
% active font set, and set \cs{MT@font@ex} resp. \cs{MT@font@pr} accordingly.
%\changes{v1.2}{2004/09/29}{also check for alias font name}
%    \begin{macrocode}
\newif\ifMT@font@pr
\newif\ifMT@font@ex
\def\MT@checkfor#1{%
%    \end{macrocode}
% (but only if protrusion/expansion isn't globally set to false)
%    \begin{macrocode}
   \expandafter\csname ifMT@\csname MT@abbr@#1\endcsname\endcsname
%    \end{macrocode}
% Begin with setting micro-typography to true for this font. The \cs{MT@checklist}
% test will set it to false if the property is not in the list.
%    \begin{macrocode}
      \csname MT@font@#1true\endcsname
      \MT@checklist{#1}{encoding}%
%    \end{macrocode}
% |family| is special, since there may also be an alias name.
%    \begin{macrocode}
      \MT@checklist@family{#1}%
      \MT@checklist{#1}{series}%
      \MT@checklist{#1}{shape}%
%    \end{macrocode}
% |size| is special, since it may contain ranges.
%    \begin{macrocode}
      \MT@checklist@size{#1}%
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@checklist}
% If we've already found that a property is not in the list, we don't have to
% bother any more.
%    \begin{macrocode}
\def\MT@checklist#1#2{%
   \csname ifMT@font@#1\endcsname\MT@checklist@{#1}{#2}\fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@checklist@}
%    \begin{macrocode}
\def\MT@checklist@#1#2{%
   \edef\@tempa{\csname MT@#1@setname\endcsname}%
   \MT@ifdefined@n{MT@#1list@#2@\@tempa}{%
%    \end{macrocode}
% Begin a \cmd{\expandafter} orgy to test whether the font characteristic is in
% the list.
%    \begin{macrocode}
      \expandafter\expandafter\expandafter
         \MT@in@clist\expandafter\expandafter\expandafter
              {\csname MT@#2\expandafter\endcsname\expandafter}%
               \csname MT@#1list@#2@\@tempa\endcsname
      \ifMT@inlist@
%<debug> \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: #2 `\@nameuse{MT@#2}' in list}%
      \else
         \csname MT@font@#1false\endcsname
%<debug> \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: #2 `\@nameuse{MT@#2}' not in list}%
      \fi
   }{%
%    \end{macrocode}
% If no limitations have been specified, i.e. the list for a font characteristic
% has not been defined at all, the font should be expanded resp. protruded.
%    \begin{macrocode}
%<debug> \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: #2 list empty}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@checklist@family}
% Also test for the alias font.
%    \begin{macrocode}
\def\MT@checklist@family#1{%
   \csname ifMT@font@#1\endcsname\MT@checklist@family@{#1}\fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@checklist@family@}
%\changes{v1.4b}{2004/11/22}{bug fix: don't try alias family name if encoding failed}
%    \begin{macrocode}
\def\MT@checklist@family@#1{%
   \MT@checklist@{#1}{family}%
%    \end{macrocode}
% Only try if the original font is not in the list.
%    \begin{macrocode}
   \csname ifMT@font@#1\endcsname\else
      \ifx\MT@familyalias\@empty\else
         \edef\@tempa{\csname MT@#1@setname\endcsname}%
         \expandafter\expandafter\expandafter
         \MT@in@clist\expandafter
              {\expandafter\MT@familyalias\expandafter}%
               \csname MT@#1list@family@\@tempa\endcsname
         \ifMT@inlist@
            \csname MT@font@#1true\endcsname
%<debug>    \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: alias `\MT@familyalias' in list}%
%<debug> \else\MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: alias `\MT@familyalias' not in list}%
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@checklist@size}
% Test whether font size is in list of size ranges.
%    \begin{macrocode}
\def\MT@checklist@size#1{%
   \csname ifMT@font@#1\endcsname\MT@checklist@size@{#1}\fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@checklist@size@}
%    \begin{macrocode}
\def\MT@checklist@size@#1{%
   \edef\@tempa{\csname MT@#1@setname\endcsname}%
   \MT@ifdefined@n{MT@#1list@size@\@tempa}{%
      \expandafter\MT@in@rlist
            \csname MT@#1list@size@\@tempa\endcsname
      \ifMT@inlist@
%<debug> \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: size `\MT@size' in list}%
      \else
         \csname MT@font@#1false\endcsname
%<debug> \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: size `\MT@size' not in list}%
      \fi
   }{%
%<debug> \MT@dinfo@nl{1}{\@nameuse{MT@abbr@#1}: size list empty}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@split@name}
%\changes{v1.7}{2005/02/27}{don't define \cs{MT@encoding} \&c. \cmd{\global}ly}
%\begin{macro}{\MT@encoding}
%\begin{macro}{\MT@family}
%\begin{macro}{\MT@series}
%\begin{macro}{\MT@shape}
%\begin{macro}{\MT@size}
% Split up the font name.
%    \begin{macrocode}
\def\MT@split@name#1/#2/#3/#4/#5\@nil{%
   \def\MT@encoding{#1}%
   \def\MT@family{#2}%
   \def\MT@series{#3}%
   \def\MT@shape{#4}%
   \def\MT@size{#5}%
%    \end{macrocode}
%\begin{macro}{\MT@familyalias}
% Alias family?
%\changes{v1.2}{2004/09/29}{define alias font name as an alternative, not
%                          as a replacement}
%    \begin{macrocode}
   \let\MT@familyalias\@empty
   \MT@ifdefined@n{MT@\MT@family @alias}{%
      \MT@let@cn\MT@familyalias{MT@\MT@family @alias}%
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%
%\subsubsection{Protrusion}
%
%\begin{macro}{\MT@set@pr@codes}
% This macro is called by \cs{MT@setupfont}, and does all the work for setting
% up a font for protrusion.
%\changes{v1.5}{2004/12/10}{adjust protrusion factors before setting the inheriting
%                           characters}
%\changes{v1.6}{2004/12/18}{introduce \texttt{factor} option}
%    \begin{macrocode}
\def\MT@set@pr@codes{%
%    \end{macrocode}
% Check which list should be applied to the current font.
%    \begin{macrocode}
   \MT@get@codes@list{pr}%
%    \end{macrocode}
% We might not have found a list.
%    \begin{macrocode}
   \MT@ifdefined@n{MT@pr@c@\MT@pr@c@name}{%
      \MT@get@dimen@six
      \MT@get@pr@opt
%    \end{macrocode}
% Get the name of the inheritance list and parse it.
%    \begin{macrocode}
      \MT@get@inh@list{pr}%
      \MT@ifdefined@c\MT@pr@inh@name{%
         \MT@let@cn\@tempc{MT@pr@inh@\MT@pr@inh@name}%
         \ifx\@tempc\@empty\else
%<debug>    \MT@dinfo@nl{1}{parsing inheritance list ...}%
            \let\MT@inh@name\MT@pr@inh@name
            \def\MT@curr@list@name{inheritance list}%
            \expandafter\MT@inh@do\@tempc,\relax,%
%    \end{macrocode}
% Set to \cmd{\@empty}, so that we only parse the list once.
%\changes{v1.2}{2004/09/26}{bug fix: set inheritance list \cmd{\global}ly to \cmd{\@empty}}
%    \begin{macrocode}
            \global\MT@let@nc{MT@pr@inh@\MT@pr@inh@name}\@empty
         \fi
      }\relax
%    \end{macrocode}
% The protrusion factors are either relative to character widths, or to a fixed
% width. Only the setting from the top list will be taken into account.
%    \begin{macrocode}
      \ifx\MT@pr@unit@\@empty
         \let\MT@get@unit\MT@get@charwd
      \else
         \let\MT@get@unit\MT@get@unit@
      \fi
%    \end{macrocode}
% Load additional lists?
%    \begin{macrocode}
      \MT@load@list{pr}{\MT@pr@c@name}%
%    \end{macrocode}
% Load the main list.
%    \begin{macrocode}
      \edef\MT@curr@list@name{protrusion list `\MT@pr@c@name'}%
      \MT@let@cn\@tempc{MT@pr@c@\MT@pr@c@name}%
      \expandafter\MT@pr@do\@tempc,\relax,%
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@gobble@settings}
%\begin{macro}{\MT@dimen@six}
%\begin{macro}{\MT@get@dimen@six}
%\changes{v1.8}{2005/05/03}{new macro: test whether \cmd{\fontdimen}6 is defined}
% If \cmd{\fontdimen} 6 is zero, character protrusion won't work, and we can
% skip the settings (\eg, the \pkg{dsfont} fonts don't specify this dimension;
% this is probably a bug).
%    \begin{macrocode}
\def\MT@get@dimen@six{%
   \ifnum\fontdimen6\MT@font@name=\z@
      \MT@warning@nl{%
         Font `\expandafter\string\MT@font@name' does not specify its\MessageBreak
         \@backslashchar fontdimen 6 (width of an `em')! Therefore,\MessageBreak
         character protrusion will not work with\MessageBreak
         this font}%
      \expandafter\MT@gobble@settings
   \else
      \edef\MT@dimen@six{\number\fontdimen6\MT@font@name}%
   \fi
}
\def\MT@gobble@settings#1\expandafter\MT@pr@do\@tempc,\relax,{}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@pr@do}
% Split up the values and set \cmd{\lpcode} and \cmd{\rpcode}.
%    \begin{macrocode}
\def\MT@pr@do#1,{%
   \ifx\relax#1\@empty\else
      \MT@pr@split #1==\relax
      \expandafter\MT@pr@do
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@pr@split}
%\changes{v1.1}{2004/09/13}{bug fix: allow zero and negative values}
%\changes{v1.8}{2005/05/25}{get character width once only}
% The \pkg{keyval} package would remove spaces here, which we needn't do since
% \cs{SetProtrusion} ignores spaces in the protrusion list anyway.
%    \begin{macrocode}
\def\MT@pr@split#1=#2=#3\relax{%
   \def\@tempa{#1}%
   \ifx\@tempa\@empty\else
      \MT@get@slot
      \ifnum\MT@char > \m@ne
         \MT@get@unit
         \MT@pr@split@val#2\relax
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@pr@split@val}
%    \begin{macrocode}
\def\MT@pr@split@val#1,#2\relax{%
   \def\@tempb{#1}%
   \MT@ifempty\@tempb\relax{%
      \MT@adjustprotcode
      \lpcode\MT@font@name\MT@char=\@tempcntb
%<debug>\MT@dinfo@nl{4}{;;; lp (\MT@char): \number\lpcode\MT@font@name\MT@char}%
   }%
   \def\@tempb{#2}%
   \MT@ifempty\@tempb\relax{%
      \MT@adjustprotcode
      \rpcode\MT@font@name\MT@char=\@tempcntb
%<debug>\MT@dinfo@nl{4}{;;; rp (\MT@char): \number\rpcode\MT@font@name\MT@char}%
   }%
%    \end{macrocode}
% Now we can set the values for the inheriting characters. Their slot numbers
% are saved in the macro |\MT@inh@|\meta{list name}|@|\meta{slot number}|@|.
%    \begin{macrocode}
   \MT@ifdefined@c\MT@pr@inh@name{%
      \MT@ifdefined@n{MT@inh@\MT@pr@inh@name @\MT@char @}{%
         \expandafter\MT@map@tlist@c
            \csname MT@inh@\MT@pr@inh@name @\MT@char @\endcsname
            \MT@set@pr@heirs
      }\relax
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@adjustprotcode}
% Since \pdftex\ version 0.14h, we have to adjust the protrusion factors
% (\ie, convert numbers from thousandths of character width to thousandths of
% an \emph{em} of the font). We have to do this before setting the inheriting
% characters, so that the latter inherit the absolute value, not the relative
% one if they have a differing width (\eg\ the `ff' ligature).
%\changes{v1.5}{2004/12/10}{don't use \cmd{\lpcode} and \cmd{\rpcode} for the
%                           calculation}
% We do not calculate with \cs{lpcode} resp. \cs{rpcode}, since this would
% disallow protrusion factors larger than the character width (since
% \cs{[lr]pcode}'s limit is 1000). Now, the maximum protrusion is 1em of the
% font.
%\changes{v1.5}{2004/12/10}{warning for protrusion factors greater than 1000}
%    \begin{macrocode}
\ifnum\MT@pdftex@no > \tw@
   \def\MT@adjustprotcode{%
      \@tempcntb=\MT@count\relax
%    \end{macrocode}
% For really huge fonts (100pt or so), an arithmetic overflow could occur with
% vanilla \TeX. Using \etex, this can't happen, since the intermediate value
% is 64 bit, which could only be reached with a character width larger than
% \cs{maxdimen}.
%    \begin{macrocode}
      \MT@scale\@tempcntb \@tempb \MT@dimen@six
      \ifnum\@tempcntb=\z@ \else
         \MT@adjustprotcode@
      \fi
   }
%    \end{macrocode}
%\begin{macro}{\MT@get@unit}
% Protrusion factors are either relative to character widths or to a (possibly
% font specific) fixed width. \cs{MT@get@unit} will be \cmd{\let} to one of
% the following commands.
%\begin{macro}{\MT@get@charwd}
% When using \etex, we can employ \cmd{\fontcharwd} instead of building scratch
% boxes.
%\changes{v1.6}{2005/01/19}{use \etex's \cmd{\fontcharwd}, if available}
%\changes{v1.8}{2005/05/25}{warning for missing (resp. zero-width) characters}
%\begin{macro}{\MT@get@unit@}
% Converting a dimension into a number can also be done more efficiently with
% \etex.
%    \begin{macrocode}
   \ifcase\MT@etex@no
      \def\MT@get@charwd{%
         \setbox\z@=\hbox{\MT@font@name \char\MT@char}%
         \MT@count=\wd\z@\relax
         \ifnum\MT@count=\z@ \MT@warn@missing@char \fi
      }
      \def\MT@get@unit@{%
         \@tempdima=\MT@pr@unit@\p@
         \MT@count=\number\@tempdima\relax
      }
   \else
      \def\MT@get@charwd{%
         \MT@count=\number\fontcharwd\MT@font@name\MT@char\relax
         \ifnum\MT@count=\z@ \MT@warn@missing@char \fi
      }
      \def\MT@get@unit@{%
         \MT@count=\number\dimexpr\MT@pr@unit@\p@
      }
   \fi
\else
%    \end{macrocode}
% No adjustment with versions 0.14f and 0.14g.
%    \begin{macrocode}
   \def\MT@adjustprotcode{%
      \MT@count=\@tempb\relax
      \ifnum\MT@count=\z@ \else
         \MT@adjustprotcode@
      \fi
   }
%    \end{macrocode}
% We need this in \cs{MT@warn@pr@too@large} (neutralized).
%    \begin{macrocode}
   \def\MT@get@charwd{\MT@count=\MT@dimen@six}
   \def\MT@get@unit@{%
      \@tempdima=\MT@pr@unit@\p@
      \MT@count=\number\@tempdima\relax
   }
\fi
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@warn@missing@char}
% Warning for missing characters, or characters with zero width.
%    \begin{macrocode}
\ifcase\MT@etex@no \MT@hop@else@fi
   \def\MT@warn@missing@char{%
      \MT@warning@nl{%
         Character `\expandafter\string\the\toks@' has a width of 0pt\MessageBreak
         (it's probably missing) in font `\expandafter\string\MT@font@name'.\MessageBreak
         It cannot be protruded}%
   }
\else
   \def\MT@warn@missing@char{%
      \MT@warning@nl{%
         Character `\expandafter\string\the\toks@'
         \iffontchar\MT@font@name\MT@char has a width of 0pt \else is missing \fi
         in font\MessageBreak `\expandafter\string\MT@font@name'.
         It cannot be protruded}%
   }
\fi
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@adjustprotcode@}
% Furthermore, we might have to multiply with a factor.
%    \begin{macrocode}
\def\MT@adjustprotcode@{%
   \ifnum\MT@pr@factor@=\@m \else
      \MT@scale\@tempcntb \MT@pr@factor@ \@m
   \fi
   \ifnum\@tempcntb > \@m
      \@tempcnta=\@m
      \MT@warn@pr@too@large
   \else
      \ifnum\@tempcntb < -\@m
         \@tempcnta=-\@m
         \MT@warn@pr@too@large
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@warn@pr@too@large}
% Type out a warning if a chosen protrusion factor is too large after the
% conversion. As a special service, we also type out the maximum amount that
% may be specified in the configuration file.
%\changes{v1.7}{2005/02/17}{new macro: type out maximum protrusion factor}
%    \begin{macrocode}
\def\MT@warn@pr@too@large{%
   \ifnum\MT@pr@factor@=\@m \else
      \MT@scale\@tempcnta \@m \MT@pr@factor@
   \fi
   \MT@scale\@tempcnta \MT@dimen@six \MT@count
   \MT@warning@nl{%
      Protrusion factor \@tempb\space too large for character\MessageBreak
      `\expandafter\string\the\toks@' in \MT@curr@list@name.\MessageBreak
      Setting it to the maximum of \number\@tempcnta}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@pr@opt}
%\begin{macro}{\MT@pr@factor@}
%\begin{macro}{\MT@pr@unit@}
% The first optional argument to \cs{SetProtrusion}.
%    \begin{macrocode}
\def\MT@get@pr@opt{%
   \MT@ifdefined@n{MT@pr@c@\MT@pr@c@name @factor}{%
      \MT@let@cn\MT@pr@factor@{MT@pr@c@\MT@pr@c@name @factor}%
      \MT@vinfo{... : Multiplying protrusion factors by
                     \number\MT@pr@factor@/1000}%
   }{%
      \let\MT@pr@factor@\MT@factor
   }%
%    \end{macrocode}
% The |unit| can only be evaluated here, since it might be font-specific.
%    \begin{macrocode}
   \MT@ifdefined@n{MT@pr@c@\MT@pr@c@name @unit}{%
      \MT@let@cn\MT@pr@unit@{MT@pr@c@\MT@pr@c@name @unit}%
      \ifx\MT@pr@unit@\@empty
         \MT@vinfo{... : Setting protrusion factors relative to character widths}%
      \fi
   }{%
      \let\MT@pr@unit@\MT@pr@unit
   }%
   \ifx\MT@pr@unit@\@empty \else
      \MT@get@pr@unit
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@get@pr@unit}
%\changes{v1.8}{2005/04/14}{new macro: get unit for protrusion factors}
%\begin{macro}{\MT@get@pr@unit@}
% If |unit| contains an |em| or |ex|, we use the corresponding \cmd{\fontdimen}
% to obtain the real size. Simply converting the |em| into points might give a
% wrong result, since the font probably isn't set up yet, so that these
% dimensions haven't been updated, either.
%    \begin{macrocode}
\def\MT@get@pr@unit{%
   \expandafter\MT@get@pr@unit@\MT@pr@unit@ e!\@nil
   \@defaultunits\@tempdima\MT@pr@unit@ pt\relax\@nnil
   \edef\MT@pr@unit@{\strip@pt\@tempdima}%
   \ifdim\MT@pr@unit@\p@=\z@
      \MT@warning@nl{Cannot set protrusion factors relative to zero\MessageBreak
         width. Setting factors of list `\MT@pr@c@name'\MessageBreak
         relative to character widths instead}%
      \let\MT@pr@unit@\@empty
   \else
      \MT@vinfo{... : Setting protrusion factors relative to \number\MT@pr@unit@ pt}%
   \fi
}
\def\MT@get@pr@unit@#1e#2#3\@nil{%
   \ifx\\#3\\\else
      \if m#2%
         \edef\MT@pr@unit@{#1\fontdimen6\MT@font@name}%
      \else
         \if x#2%
            \edef\MT@pr@unit@{#1\fontdimen5\MT@font@name}%
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@set@pr@heirs}
% Set the inheriting characters.
%    \begin{macrocode}
\def\MT@set@pr@heirs#1{%
   \lpcode\MT@font@name#1=\lpcode\MT@font@name\MT@char
   \rpcode\MT@font@name#1=\rpcode\MT@font@name\MT@char
%<debug>\MT@dinfo@nl{2}{-- heir of \MT@char: #1}%
%<debug>\MT@dinfo@nl{4}{;;; lp/rp (#1): \number\lpcode\MT@font@name\MT@char/%
%<debug>                                \number\rpcode\MT@font@name\MT@char}%
}
%    \end{macrocode}
%\end{macro}
%
%\subsubsection{Expansion}
%
%\begin{macro}{\MT@set@ex@codes@s}
% Setting up font expansion is a bit different because of the \opt{selected} option.
% There are two versions of this macro.
%
% If \opt{selected}|=true|, we only apply font expansion to those fonts for which a
% list has been declared (\ie, like for protrusion).
%    \begin{macrocode}
\def\MT@set@ex@codes@s{%
   \MT@get@codes@list{ex}%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name}{%
      \MT@get@ex@opt
      \MT@resetefcode
      \MT@get@inh@list{ex}%
      \MT@ifdefined@c\MT@ex@inh@name{%
         \MT@let@cn\@tempc{MT@ex@inh@\MT@ex@inh@name}%
         \ifx\@tempc\@empty\else
%<debug>    \MT@dinfo@nl{1}{parsing inheritance list ...}%
            \let\MT@inh@name\MT@ex@inh@name
            \def\MT@curr@list@name{inheritance list}%
            \expandafter\MT@inh@do\@tempc,\relax,%
            \global\MT@let@nc{MT@ex@inh@\MT@ex@inh@name}\@empty
         \fi
      }\relax
      \MT@load@list{ex}{\MT@ex@c@name}%
      \edef\MT@curr@list@name{expansion list `\MT@ex@c@name'}%
      \MT@let@cn\@tempc{MT@ex@c@\MT@ex@c@name}%
      \expandafter\MT@ex@do\@tempc,\relax,%
      \pdffontexpand\MT@font@name \MT@stretch@ \MT@shrink@ \MT@step@ \MT@auto@\relax
   }\relax
}
%    \end{macrocode}
%\end{macro}
%
%\begin{macro}{\MT@set@ex@codes@n}
% If, on the other hand, all characters should be expanded by the same amount,
% we only take the first optional argument to \cs{SetExpansion} into account.
%\begin{macro}{\ifMT@nonselected}\IndexNewif{MT@nonselected}
% We need this boolean in \cs{MT@get@codes@list} so that no warning for missing
% lists will be issued.
%    \begin{macrocode}
\newif\ifMT@nonselected
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\def\MT@set@ex@codes@n{%
   \MT@nonselectedtrue
   \MT@get@codes@list{ex}%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name}%
      \MT@get@ex@opt
   {%
      \let\MT@stretch@\MT@stretch
      \let\MT@shrink@\MT@shrink
      \let\MT@step@\MT@step
      \let\MT@auto@\MT@auto
      \let\MT@ex@factor@\MT@ex@factor
   }%
   \MT@resetefcode
   \pdffontexpand\MT@font@name \MT@stretch@ \MT@shrink@ \MT@step@ \MT@auto@\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@set@ex@codes}
%\changes{v1.5}{2004/12/02}{allow non-selected font expansion}
%\changes{v1.6}{2004/12/26}{introduce \texttt{factor} option}
%\changes{v1.7}{2005/02/06}{two versions of this macro}
% Default is non-selected. It can be changed in the package options.
%    \begin{macrocode}
\let\MT@set@ex@codes\MT@set@ex@codes@n
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@resetefcode@}
% At first, all expansion factors for the characters will be set to 1000
% (respectively the |factor| of this font).
%    \begin{macrocode}
\def\MT@resetefcode@{%
   \@tempcnta=\z@
   \MT@loop
      \efcode\MT@font@name\@tempcnta=\MT@ex@factor@
%<debug>\MT@dinfo@nl{4}{::: ef (\number\@tempcnta): \number\efcode\MT@font@name\@tempcnta}%
      \advance\@tempcnta \@ne
      \ifnum\@tempcnta < \@cclvi \MT@repeat
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@resetefcode}
% However, this is only necessary for versions prior to~1.20.
%\changes{v1.6a}{2005/01/30}{only reset \cmd{\efcode}s for older \pdftex\ versions}
%    \begin{macrocode}
\ifnum\MT@pdftex@no < 4
   \let\MT@resetefcode\MT@resetefcode@
\else
   \def\MT@resetefcode{%
      \ifnum\MT@ex@factor@=\@m \else
         \MT@resetefcode@
      \fi
   }
\fi
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@ex@do}
% There's only one number per character.
%    \begin{macrocode}
\def\MT@ex@do#1,{%
   \ifx\relax#1\@empty\else
      \MT@ex@split #1==\relax
      \expandafter\MT@ex@do
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@ex@split}
%    \begin{macrocode}
\def\MT@ex@split#1=#2=#3\relax{%
   \def\@tempa{#1}%
   \ifx\@tempa\@empty\else
      \MT@get@slot
      \ifnum\MT@char > \m@ne
         \@tempcnta=#2 \relax
%    \end{macrocode}
% Take an optional factor into account.
%    \begin{macrocode}
         \ifnum\MT@ex@factor@=\@m \else
            \MT@scale\@tempcnta \MT@ex@factor@ \@m
         \fi
         \ifnum\@tempcnta > \@m
            \MT@warn@ex@too@large
            \@tempcnta=\@m
         \fi
         \efcode\MT@font@name\MT@char=\@tempcnta
%<debug> \MT@dinfo@nl{4}{::: ef (\MT@char): \number\efcode\MT@font@name\MT@char}%
%    \end{macrocode}
% Heirs, heirs, I love thy heirs.
%    \begin{macrocode}
         \MT@ifdefined@c\MT@ex@inh@name{%
            \MT@ifdefined@n{MT@inh@\MT@ex@inh@name @\MT@char @}{%
               \expandafter\MT@map@tlist@c
                  \csname MT@inh@\MT@ex@inh@name @\MT@char @\endcsname
                  \MT@set@ex@heirs
            }\relax
         }\relax
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@warn@ex@too@large}
%    \begin{macrocode}
\def\MT@warn@ex@too@large{%
   \MT@warning@nl{Expansion factor
      \number\@tempcnta\space too large for character\MessageBreak
      `\expandafter\string\the\toks@' in \MT@curr@list@name.\MessageBreak
      Setting it to the maximum of 1000}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@ex@opt}
%\begin{macro}{\MT@ex@factor@}
%\begin{macro}{\MT@stretch@}
%\begin{macro}{\MT@shrink@}
%\begin{macro}{\MT@step@}
%\begin{macro}{\MT@auto@}
% Apply different values to this font?
%    \begin{macrocode}
\def\MT@get@ex@opt{%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name @factor}{%
      \MT@let@cn\MT@ex@factor@{MT@ex@c@\MT@ex@c@name @factor}%
      \MT@vinfo{... : Multiplying expansion factors by \number\MT@ex@factor@/1000}%
   }{%
      \let\MT@ex@factor@\MT@ex@factor
   }%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name @stretch}{%
      \MT@let@cn\MT@stretch@{MT@ex@c@\MT@ex@c@name @stretch}%
      \MT@vinfo{... : Setting stretch limit to \number\MT@stretch@}%
   }{%
      \let\MT@stretch@\MT@stretch
   }%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name @shrink}{%
      \MT@let@cn\MT@shrink@{MT@ex@c@\MT@ex@c@name @shrink}%
      \MT@vinfo{... : Setting shrink limit to \number\MT@shrink@}%
   }{%
      \let\MT@shrink@\MT@shrink
   }%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name @step}{%
      \MT@let@cn\MT@step@{MT@ex@c@\MT@ex@c@name @step}%
      \MT@vinfo{... : Setting expansion step to \number\MT@step@}%
   }{%
      \let\MT@step@\MT@step
   }%
   \MT@ifdefined@n{MT@ex@c@\MT@ex@c@name @auto}{%
      \MT@let@cn\MT@auto@{MT@ex@c@\MT@ex@c@name @auto}%
      \def\@tempa{autoexpand}%
      \MT@vinfo{... : \ifx\@tempa\MT@auto@ En\else Dis\fi
                        abling automatic expansion}%
   }{%
      \let\MT@auto@\MT@auto
   }%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@set@ex@heirs}
%    \begin{macrocode}
\def\MT@set@ex@heirs#1{%
   \efcode\MT@font@name#1=\efcode\MT@font@name\MT@char
%<debug>\MT@dinfo@nl{2}{-- heir of \MT@char: #1}%
%<debug>\MT@dinfo@nl{4}{::: ef (#1) \number\efcode\MT@font@name\MT@char}%
}
%    \end{macrocode}
%\end{macro}
%
%\subsubsection{Loading the Configuration}
%
%\begin{macro}{\MT@load@list}
% Recurse through the lists to be loaded.
%\changes{v1.3}{2004/10/27}{check whether list exists}
%    \begin{macrocode}
\def\MT@load@list#1#2{%
   \edef\@tempa{#2}%
   \MT@let@cn\@tempb{MT@#1@c@\@tempa load}%
   \ifx\@tempa\@tempb
      \MT@warning{\@nameuse{MT@abbr@#1} list `\@tempa' cannot load itself}%
   \else
      \ifx\@tempb\relax\else
         \MT@ifdefined@n{MT@#1@c@\@tempb}{%
            \MT@vinfo{... : Additionally loading \@nameuse{MT@abbr@#1} list `\@tempb'}%
            \begingroup
               \MT@load@list{#1}{\@tempb}%
            \endgroup
            \edef\MT@curr@list@name{\@nameuse{MT@abbr@#1} list `\@tempb'}%
            \MT@let@cn\@tempc{MT@#1@c@\@tempb}%
            \expandafter\csname MT@#1@do\expandafter\endcsname\@tempc,\relax,%
         }{%
            \MT@warning{\@nameuse{MT@abbr@#1} list `\@tempb' undefined.
                        Cannot load\MessageBreak it from list `\@tempa'}%
         }%
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\changes{v1.1}{2004/09/13}{configuration file names in lowercase
%                           (suggested by Harald Harders)}
%\begin{macro}{\MT@find@file}
%\changes{v1.1}{2004/09/14}{bug fix: also check whether the file for the base
%                           font family has already been loaded}
% Micro-typographic settings may be written into a file |mt-|\meta{font family}|.cfg|.
%\changes{v1.8}{2005/04/16}{no longer wrap names in commands}
%\begin{macro}{\MT@file@list}
% We must also record whether we've already loaded the file.
%    \begin{macrocode}
\let\MT@file@list\@empty
\def\MT@find@file#1{%
%    \end{macrocode}
%\end{macro}
% Check for existence of the file only once.
%    \begin{macrocode}
   \MT@in@clist{#1}\MT@file@list
   \ifMT@inlist@\else
%    \end{macrocode}
% Don't forget that because reading the files takes place inside a group, all
% commands that may be used there have to be defined globally.
%    \begin{macrocode}
      \MT@begin@catcodes
      \let\MT@begin@catcodes\relax
      \let\MT@end@catcodes\relax
      \InputIfFileExists{mt-#1.cfg}{%
         \MT@vinfo{... Loading configuration file mt-#1.cfg}%
         \MT@xadd\MT@file@list{#1,}%
      }{%
         \expandafter\MT@get@basefamily#1\relax\relax\relax
         \expandafter\MT@in@clist\expandafter{\@tempa}\MT@file@list
         \ifMT@inlist@\else
            \InputIfFileExists{mt-\@tempa.cfg}{%
               \MT@vinfo{... Loading configuration file mt-\@tempa.cfg}%
               \MT@xadd\MT@file@list{\@tempa,#1,}%
            }{%
               \MT@vinfo{... No configuration file mt-#1.cfg}%
               \MT@xadd\MT@file@list{#1,}%
            }%
         \fi
      }%
      \endgroup
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@begin@catcodes}
% We have to make sure that all characters have the correct category code.
% Especially, new lines and spaces should be ignored, since files might be
% loaded in the middle of the document. This is basically \cmd{\nfss@catcodes}
% (from the \LaTeX\ kernel). I've added:
%\changes{v1.4a}{2004/11/16}{bug fix: reset some more catcodes when reading files
%                          (reported by Michael Hoppe)} ^^A <mh\at michael-hoppe.de>
%                                  ^^A in <MID:p06002000bdbff1f93eb7@[192.168.0.34]>
% |&| (in |tabular|s), |!|, |?|, |;|,
%\changes{v1.7}{2005/02/06}{reset catcode of `\texttt{:}'
%                           (compatibility with \pkg{french}* packages)}
% |:| (|french|), |,|, |$|, |_|, |~|,
%\changes{v1.5}{2004/11/28}{reset catcode of `\texttt{\quotechar=}'
%                           (compatibility with Turkish \pkg{babel})}
% and |=| (Turkish \pkg{babel}).
%
%\changes{v1.8}{2005/03/29}{reset catcodes of the remaining \ascii\ characters}
% OK, now all printable characters up to 127 are `other'. We hope that letters
% are always letters and numbers other.
%
% We leave |^| at catcode 7, so that stuff like `|^^ff|' remains possible.
%
% This will be used before reading the files as well as in the configuration
% commands \cs{SetExpansion}, \cs{SetProtrusion} and \cs{DeclareCharacterInheritance},
% so that the catcodes are also harmless when these commands are used outside
% the configuration files.
%\changes{v1.7}{2005/02/17}{also use inside configuration commands}
%    \begin{macrocode}
\def\MT@begin@catcodes{%
   \begingroup
   \makeatletter
   \catcode`\^7%
   \catcode`\ 9%
   \catcode`\^^I9%
   \catcode`\^^M9%
   \catcode`\\\z@
   \catcode`\{\@ne
   \catcode`\}\tw@
   \catcode`\#6%
   \catcode`\%14%
   \MT@map@tlist@n
      {\!\"\$\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\[\]\_\`\|\~}%
      \@makeother
%    \end{macrocode}
% Inside the configuration files, we don't have to bother about spaces.
%    \begin{macrocode}
   \def\MT@remove@spaces##1{}%
   \let\KV@@sp@def\def
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@end@catcodes}
% End group if outside configuration file (otherwise relax).
%    \begin{macrocode}
\let\MT@end@catcodes\endgroup
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@basefamily}
% The family name might have a suffix
%\changes{v1.1}{2004/09/14}{only remove suffix, if it is `x' or `j'}
% for expert or old style number font set
%\changes{v1.2}{2004/09/26}{also remove `w' (swash capitals)}
% or for swash capitals (|x|, |j| or |w|). We mustn't simply remove the last
% letter, as this would make for instance |cms| out of |cmss| \textit{and}
% |cmsy| (OK, |cmex| will still become |cme|~\dots).
%\changes{v1.4b}{2004/11/25}{bug fix: failed for font names of the form \texttt{abczz}
%                           (reported by Georg Verweyen)} ^^A <Georg.Verweyen\at WEB.DE>
%                                                  ^^A in: <MID:41A64DC7.7040404@web.de>
%    \begin{macrocode}
\def\MT@get@basefamily#1#2#3#4\relax{%
   \ifx\relax#2\relax\def\@tempa{#1}\else
      \ifx\relax#3\relax\def\@tempa{#1#2}\else
         \def\@tempa{#1#2#3}%
         \ifx\relax#4\relax\else
            \edef\@tempc{\string#4}%
            \edef\@tempb{\string x}%
            \ifx\@tempc\@tempb\else
               \edef\@tempb{\string j}%
               \ifx\@tempc\@tempb\else
                  \edef\@tempb{\string w}%
                  \ifx\@tempc\@tempb\else
                     \def\@tempa{#1#2#3#4}%
                  \fi
               \fi
            \fi
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@listname}
%\begin{macro}{\MT@get@listname}
%\begin{macro}{\MT@get@listname@}
% Try all combinations of font family, series, shape and size to get a list for
% the current font.
%\changes{v1.1}{2004/09/15}{don't check for empty characteristics list}
%\changes{v1.2}{2004/09/30}{alternatively check for alias font name}
%\changes{v1.7}{2005/03/15}{use \cmd{\@tfor} (Andreas B\"uhmann's idea)}
%\changes{v1.8}{2005/04/16}{made recursive}
%    \begin{macrocode}
\def\MT@get@listname#1{%
%<debug>\MT@dinfo@nl{1}{trying to find \@nameuse{MT@abbr@#1} list for font \MT@font@name}%
   \let\MT@listname\@undefined
   \def\@tempb{#1}%
   \MT@map@tlist@c\MT@try@order\MT@get@listname@
}
\def\MT@get@listname@#1{%
   \expandafter\MT@next@listname#1%
   \ifx\MT@listname\@undefined \else
      \expandafter\MT@tlist@break
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@try@order}
%\changes{v1.7}{2005/03/11}{bug fix: also check for //\meta{series}/\meta{shape}//
%                          (reported by Andreas B\"uhmann)} ^^A <andreas.buehmann\at web.de>
%                                                           ^^A private mail, 10/3/2005
%\changes{v1.7}{2005/03/11}{always check for size, too
%                          (suggested by Andreas B\"uhmann)} ^^A <andreas.buehmann\at web.de>
%                                                            ^^A private mail, 10/3/2005
%
%\begin{table}\footnotesize
%\caption{Order for matching font attributes}\label{tab:match-order}
%\catcode`\!=13 \let!\match
%\begin{tabular}{@{}L{38pt}*{16}{p{19.5pt}<{\centering}@{}}}
%\ifbooktabs\addlinespace\toprule\addlinespace\else\hline\fi
%          & 1.& 2.& 3.& 4.& 5.& 6.& 7.& 8.& 9.&10.&11.&12.&13.&14.&15.&16.\\
%\ifbooktabs\cmidrule(r){2-2}\cmidrule(r){3-3}\cmidrule(r){4-4}\cmidrule(r){5-5}\cmidrule(r){6-6}
%     \cmidrule(r){7-7}\cmidrule(r){8-8}\cmidrule(r){9-9}\cmidrule(r){10-10}\cmidrule(r){11-11}\cmidrule(r){12-12}
%     \cmidrule(r){13-13}\cmidrule(r){14-14}\cmidrule(r){15-15}\cmidrule(r){16-16}\cmidrule{17-17}\else\hline\fi
% Encoding & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! & ! \\
% Family   & ! & ! & ! & ! & ! & ! & ! & ! & - & - & - & - & - & - & - & - \\
% Series   & ! & ! & ! & ! & - & - & - & - & ! & ! & ! & ! & - & - & - & - \\
% Shape    & ! & ! & - & - & ! & ! & - & - & ! & ! & - & - & ! & ! & - & - \\
% Size     & ! & - & ! & - & ! & - & ! & - & ! & - & ! & - & ! & - & ! & - \\
%\ifbooktabs\bottomrule\else\hline\fi
%\end{tabular}
%\end{table}
%
% Beginning with version 1.7, we always check for the font size. Since the
% matching order has become more logical now, it can be described in words, so
% that we don't need table~\ref{tab:match-order} in the documentation part any
% longer and can cast it off here.
%    \begin{macrocode}
\def\MT@try@order{%
   {1111}{1110}{1101}{1100}{1011}{1010}{1001}{1000}%
   {0111}{0110}{0101}{0100}{0011}{0010}{0001}{0000}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@next@listname}
%    \begin{macrocode}
\def\MT@next@listname#1#2#3#4{%
   \edef\@tempa{\MT@encoding
               /\ifnum#1=\@ne \MT@family\fi
               /\ifnum#2=\@ne \MT@series\fi
               /\ifnum#3=\@ne \MT@shape\fi
               /\ifnum#4=\@ne *\fi}%
%<debug>\MT@dinfo@nl{1}{trying \@tempa}%
   \MT@ifdefined@n{MT@\@tempb @\@tempa}{%
      \MT@next@listname@#4%
   }{%
%    \end{macrocode}
% Also try with an alias family.
%    \begin{macrocode}
      \ifnum#1=\@ne
         \ifx\MT@familyalias\@empty\else
            \edef\@tempa{\MT@encoding
                        /\MT@familyalias
                        /\ifnum#2=\@ne \MT@series\fi
                        /\ifnum#3=\@ne \MT@shape\fi
                        /\ifnum#4=\@ne *\fi}%
%<debug>    \MT@dinfo@nl{1}{(alias) \@tempa}%
            \MT@ifdefined@n{MT@\@tempb @\@tempa}{%
               \MT@next@listname@#4%
            }\relax
         \fi
      \fi
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@next@listname@}
% If size is to be evaluated, do it, otherwise use the current list.
%    \begin{macrocode}
\def\MT@next@listname@#1{%
   \ifnum#1=\@ne
      \expandafter\MT@in@rlist\csname MT@\@tempb @\@tempa @sizes\endcsname
      \ifMT@inlist@
         \let\MT@listname\MT@size@name
      \fi
   \else
      \MT@let@cn\MT@listname{MT@\@tempb @\@tempa}%
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@codes@list}
%\changes{v1.7}{2005/02/06}{don't define \cs{MT@\#1@c@name} \cmd{\global}ly,
%                           here and elsewhere}
%\begin{macro}{\MT@get@inh@list}
%\changes{v1.6}{2004/12/18}{correct message if \opt{selected} is false}
%    \begin{macrocode}
\def\MT@get@codes@list#1{%
   \MT@get@listname{#1@c}%
   \MT@ifdefined@c\MT@listname{%
      \MT@edef@n{MT@#1@c@name}{\MT@listname}%
      \ifMT@nonselected
         \MT@vinfo{... Applying non-selected expansion (list `\MT@ex@c@name')}%
      \else
         \MT@vinfo{... Loading \@nameuse{MT@abbr@#1} list `\@nameuse{MT@#1@c@name}'}%
      \fi
   }{%
%    \end{macrocode}
% Since the name cannot be \cmd{\@empty}, this is a sound proof that no matching
% list exists.
%    \begin{macrocode}
      \MT@let@nc{MT@#1@c@name}\@empty
%    \end{macrocode}
% Don't warn if \opt{selected}|=false|.
%    \begin{macrocode}
      \ifMT@nonselected
         \MT@vinfo{... Applying non-selected expansion}%
      \else
         \MT@warning{%
            I cannot find a \@nameuse{MT@abbr@#1} list for font\MessageBreak
            `\expandafter\string\MT@font@name'. Switching off \@nameuse{MT@abbr@#1}%
            \MessageBreak for this font}%
       \fi
   }%
}
\def\MT@get@inh@list#1{%
   \MT@get@listname{#1@inh}%
   \MT@ifdefined@c\MT@listname{%
      \MT@edef@n{MT@#1@inh@name}{\MT@listname}%
%<debug>\MT@dinfo@nl{1}{... Using \@nameuse{MT@abbr@#1} inheritance list
%<debug>                `\@nameuse{MT@#1@inh@name}'}%
   }{%
      \MT@let@nc{MT@#1@inh@name}\@undefined
   }%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%
% \subsubsection{Translating Characters}
%
%\changes{v1.4}{2004/11/04}{don't use scratch registers in global definitions}
%\begin{macro}{\Mt@char}
% Get the slot number of the character in the current encoding.
%
% First we define some helper macros which inspect the \cmd{\meaning} of their
% arguments. No upper case |T| in macro names!
%    \begin{macrocode}
%<debug>\def\Mt@info{\MT@dinfo@nl{3}}
\begingroup
   \catcode`\/=0
   /catcode`/\=12
   /MT@map@tlist@n{/E/R/L/A/C/H/T}/@makeother
   /lowercase{%
      /def/x{%
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\Mt@is@letter}
%\begin{macro}{\Mt@letterstring}
% Test whether argument expands to a letter.
%    \begin{macrocode}
         /def/Mt@letterstring{THE LETTER}%
         /def/Mt@is@letter ##1THE LETTER##2##3/relax{%
            /@tempswafalse
            /ifx/relax##1/relax
               /@tempswatrue
               /edef/Mt@char{/number`##2}%
%<debug>       /Mt@info{> `/the/toks@' is a letter (/Mt@char)}%
               /Mt@testrest{/Mt@letterstring}{##3}%
            /fi
         }%
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\Mt@is@character}
%\changes{v1.8}{2005/04/04}{warning for non-\ascii\ characters}
%\begin{macro}{\Mt@characterstring}
% Argument expands to a character (anything with catcode 12, also a number).
%    \begin{macrocode}
         /def/Mt@characterstring{THE CHARACTER}%
         /def/Mt@is@character ##1THE CHARACTER##2##3/relax{%
            /@tempswafalse
            /ifx/relax##1/relax
               /@tempswatrue
               /edef/Mt@char{/number`##2}%
%<debug>       /Mt@info{> `/the/toks@' is a character (/Mt@char)}%
               /ifnum/Mt@char>127 /Mt@warn@ascii /fi
               /Mt@testrest{/Mt@characterstring}{##3}%
            /fi
         }%
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\Mt@is@char}
%\begin{macro}{\Mt@charstring}
% Everything that has been defined with \cs{DeclareTextSymbol} in the encoding
% definition files.
%    \begin{macrocode}
         /def/Mt@charstring{\CHAR"}%
         /def/Mt@is@char##1\CHAR"##2##3##4/relax{%
            /@tempswafalse
            /ifx/relax##1/relax
               /@tempswatrue
               /if##3\/relax
                  /edef/Mt@char{/number"##2}%
                  /Mt@testrest{/Mt@charstring}{##3##4}%
               /else
                  /edef/Mt@char{/number"##2##3}%
                  /Mt@testrest{/Mt@charstring}{##4}%
               /fi
%<debug>       /Mt@info{> `/the/toks@' is a \char (/Mt@char)}%
            /fi
         }%
      }%
   }
/expandafter/endgroup/x
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\Mt@testrest}
%\begin{macro}{\ifMT@norest}\IndexNewif{MT@norest}
% Test whether all of the string has been used up.
%    \begin{macrocode}
\newif\ifMT@norest
\def\Mt@testrest#1#2{%
   \edef\x{#1}%
   \def\y{#2}%
   \ifx\x\y \else
      \MT@norestfalse
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@get@slot}
%\changes{v1.2}{2004/09/26}{bug fix: group must also include \cs{MT@get@composite}}
%\changes{v1.4b}{2004/11/22}{don't define \cs{MT@char} globally (save stack problem)}
%\changes{v1.6a}{2005/01/30}{completely redone, hopefully more robust
%                           (compatible with \pkg{frenchpro})}
%\changes{v1.7}{2005/03/21}{remove backslash hack}
%\begin{macro}{\MT@char}
% There are lots of possibilities how a character may be specified in the
% configuration files, which makes translating them into slot numbers quite
% expensive. Also, we want to have this as robust as possible, so that the user
% does not have to solve a sphinx's riddle if anything goes wrong.
%
% The character is in \cs{@tempa}, we want its slot number in \cs{MT@char}.
%    \begin{macrocode}
\def\MT@get@slot{%
   \MT@count=\escapechar
   \escapechar=`\\
   \let\Mt@char\m@ne
   \MT@noresttrue
%    \end{macrocode}
%\end{macro}
% Save unexpanded string in case we need to issue a warning message.
%    \begin{macrocode}
   \toks@=\expandafter{\@tempa}%
   \MT@get@slot@
   \let\MT@char\Mt@char
   \ifnum\Mt@char < \z@
      \MT@warn@unknown
   \else
%    \end{macrocode}
% If the user has specified something like `|fi|', or wanted to define a number
% but forgot to use three digits, we'll have something left of the string. In
% this case, we issue a warning and forget the complete string.
%    \begin{macrocode}
      \ifMT@norest \else
         \MT@warn@unknown@i
         \let\MT@char\m@ne
      \fi
   \fi
   \escapechar=\MT@count
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@slot@}
% Now, let's walk through (hopefully all) possible cases.
%    \begin{macrocode}
\def\MT@get@slot@{%
   \edef\MT@char{\expandafter\meaning\@tempa}%
%    \end{macrocode}
%\begin{itemize}
% \item It's either a letter
%    \begin{macrocode}
   \expandafter\expandafter\expandafter\Mt@is@letter
         \expandafter\MT@char\Mt@letterstring \relax\relax
   \ifnum\Mt@char < \z@
%    \end{macrocode}
% \item An`other' character (catcode 12)
%    \begin{macrocode}
      \expandafter\expandafter\expandafter\Mt@is@character
            \expandafter\MT@char\Mt@characterstring \relax\relax
%    \end{macrocode}
% \item A number?
%    \begin{macrocode}
      \if@tempswa
         \expandafter\MT@get@number\@tempa\relax\relax
      \fi
      \ifnum\Mt@char < \z@
%    \end{macrocode}
%\changes{v1.8}{2005/03/30}{bug fix: expand active characters}
% \item It might be an active character, \ie, an 8-bit character defined by
%       \pkg{inputenc}.
%    \begin{macrocode}
         \expandafter\expandafter\expandafter
               \MT@is@active\expandafter\string\@tempa\@nil
%    \end{macrocode}
% \item OK, so it must be a macro. We do not allow random commands but only
%       those defined in \LaTeX's idiosyncratic font encoding scheme:
%
%       If |\|\meta{encoding}|\|\meta{command} (that's \emph{one} command) is
%       defined, we try to extract the slot number.
%\changes{v1.7}{2005/02/27}{test whether \cs{}\meta{encoding}\cs{\meta{..}} is defined}
%\changes{v1.8}{2005/04/05}{test whether \cs{}\meta{encoding}\cs{\meta{..}} is
%                           defined made more robust with \etex}
%    \begin{macrocode}
         \MT@ifdefined@n{\MT@encoding\MT@detokenize\@tempa}%
            \MT@get@symbol
         {%
%    \end{macrocode}
% \item Now, we'll catch the rest, which hopefully is an accented character
%       (\eg~|\"a|).
%    \begin{macrocode}
            \expandafter\MT@get@composite\@tempa\relax\relax
         }%
         \ifnum\Mt@char < \z@
%    \end{macrocode}
% \item It could also be a \cmd{\chardef}ed command (\eg\ the percent character).
%       This seems the least likely case, so it's last.
%\changes{v1.7}{2005/03/20}{test for \cmd{\chardef}ed commands}
%    \begin{macrocode}
            \expandafter\expandafter\expandafter\Mt@is@char
                  \expandafter\MT@char\Mt@charstring \relax\relax\relax
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\end{itemize}
%\end{macro}
%\begin{macro}{\MT@get@number}
% Numbers may be specified as a three-digit decimal number (|029|),
%\changes{v1.1}{2004/09/13}{numbers may also be specified in hexadecimal or octal
%                           (suggested by Harald Harders)}
% as a hexadecimal number (prefixed with~|"|: |"1D|) or as a octal number
% (prefixed with~|'|: |'35|). They must consist of at least three characters
% (including the prefix), that is, |"F| is not permitted.
%    \begin{macrocode}
\def\MT@get@number#1#2#3\relax{%
   \ifx\relax#3\relax\else
      \ifx\relax#2\relax\else
         \MT@noresttrue
         \if#1"\relax
            \def\x{\uppercase{\edef\Mt@char{\number#1#2#3}}}\x
%<debug>    \MT@dinfo@nl{3}{> ... a hexadecimal number: \Mt@char}%
         \else
            \if#1'\relax
               \def\Mt@char{\number#1#2#3}%
%<debug>       \MT@dinfo@nl{3}{> ... an octal number: \Mt@char}%
            \else
               \MT@ifnumber{#1#2#3}{%
                  \def\Mt@char{\number#1#2#3}%
%<debug>          \MT@dinfo@nl{3}{> ... a decimal number: \Mt@char}%
               }\MT@norestfalse
            \fi
         \fi
         \ifnum\Mt@char > \@cclv
            \MT@warn@number@too@large{\noexpand#1\noexpand#2\noexpand#3}%
            \let\Mt@char\m@ne
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@is@active}
%\changes{v1.8}{2005/03/30}{new macro: translate \pkg{inputenc}-defined characters}
% Expand an active character. Thus, specifying |Ä|, as stated in the documentation,
% is indeed possible. (This was completely broken in v1.7, and only worked by
% chance before.)
%
%\todo{Make \microtype\ Unicode-savvy?}
% Unicode characters (\ie, \pkg{inputenc}/|utf8|) are currently not supported.
%
%\begin{macro}{\MT@toks}
% We cannot simply fully expand \cs{@tempa} since the current encoding might be
% wrong (and it could fail spectacularly). Instead, we do some magic with token
% registers to translate, \eg, |Ä| into |\"A|, that is to whatever it is
% defined in the \pkg{inputenc} encoding file.
%    \begin{macrocode}
\newtoks\MT@toks
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\def\MT@is@active#1#2\@nil{%
   \ifx\\#2\\%
      \ifnum\catcode`#1 = \active
         \MT@toks=\expandafter\expandafter\expandafter{\@tempa}%
         \expandafter\MT@active@inpenc\the\MT@toks\relax\relax
         \edef\@tempa{\the\MT@toks}%
%    \end{macrocode}
% Append what we think the translation is to the token register we use for the
% log.
%    \begin{macrocode}
%         \toks@=\expandafter\expandafter\expandafter\expandafter
%                \expandafter\expandafter\expandafter\expandafter
%                \expandafter\expandafter\expandafter\expandafter
%                \expandafter\expandafter\expandafter
%               {\expandafter\expandafter\expandafter\expandafter
%                \expandafter\expandafter\expandafter
%                \the
%                   \expandafter\expandafter\expandafter
%                \toks@
%                   \expandafter
%                      \space
%                   \expandafter
%                      (\the\MT@toks)}%
%    \end{macrocode}
% Just kidding.
%    \begin{macrocode}
         \edef\x{\toks@={\the\toks@\space(= \the\MT@toks)}}\x
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@active@inpenc}
% There may be two special commands in the definition, which we have to remove
% here: \cmd{\@tabacckludge} (which is nothing to smoke but used to access the
% \cmd{\`}, \cmd{\'}, and \cmd{\=} accents in a way compatible with the
% |tabbing| environment) and \cmd{\IeC} (to preserve spaces).
%
% Unfortunately, the \pkg{inputenc} definitions prefer the protected/generic
% variants (\eg, \cmd{\copyright} instead of \cmd{\textcopyright}), which our
% parser won't be able to understand.
% (I'm fed up now, so you have to complain if you really, really want to be
% able to write `|©|' instead of \cmd{\textcopyright}, thus rendering your
% configuration files unportable.)
%    \begin{macrocode}
\def\MT@active@inpenc#1#2#3\relax{%
   \ifx#1\IeC
      \def\IeC##1{\MT@toks={##1}}%
      \the\MT@toks
      \expandafter\MT@active@inpenc\the\MT@toks\relax\relax
   \fi
   \ifx#1\@tabacckludge
      \def\@tabacckludge##1##2{%
         \MT@toks=\expandafter{\csname\string##1\endcsname#3}}%
      \the\MT@toks
   \fi
%    \end{macrocode}
% The character is undefined in the encoding.
%    \begin{macrocode}
   \ifx#1\@inpenc@undefined@
      \def\@inpenc@undefined@##1{%
         \edef\x{\MT@toks={%
            undefined^^J(microtype)\@spaces\@spaces\@spaces\@spaces
            in input encoding ``##1''}}\x}%
      \the\MT@toks
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@symbol}
% The symbol commands might expand to funny stuff, depending on context.
% Instead of simply expanding |\|\meta{command}, we construct the command
% |\|\meta{encoding}|\|\meta{command} and see whether its meaning is
% \cmd{\char}|"|\meta{hex number}~\dots
%    \begin{macrocode}
\def\MT@get@symbol{%
   \edef\@tempa{\expandafter\expandafter\expandafter
%    \end{macrocode}
% (Why did I use seven \cmd{\expandafter}s?)
%    \begin{macrocode}
%                \expandafter\expandafter\expandafter\expandafter
                \meaning\expandafter
                   \csname\expandafter
                      \MT@encoding\expandafter
                      \string\@tempa
                   \endcsname}%
   \expandafter\expandafter\expandafter\Mt@is@char
         \expandafter\@tempa\Mt@charstring \relax\relax\relax
   \if@tempswa \else
%    \end{macrocode}
% \dots~or, if it hasn't been defined by \cs{DeclareTextSymbol}, to a letter
% (\eg\ \cmd{\i}, when using \pkg{frenchpro}). ^^A as noted by Bernard Gaulle <gaulle\at idris.fr>,
%                                                ^^A private mail, 28/1/2005
%    \begin{macrocode}
      \expandafter\expandafter\expandafter\Mt@is@letter
            \expandafter\@tempa\Mt@letterstring \relax\relax
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@composite}
% Here, we are dealing with accented characters, specified as two tokens.
%\changes{v1.7}{2005/03/10}{new macro: construct command for composite character;
%                           no uncontrolled expansion}
%    \begin{macrocode}
\def\MT@get@composite#1#2\relax{%
   \MT@ifempty{#2}\relax{%
%    \end{macrocode}
% Again, we construct a control sequence, this time of the form:
% |\\|\meta{encoding}\hskip0pt|\|\meta{accent}|-|\meta{character}, \eg\
% |\\T1\"-a|, whose meaning is a letter if it has been defined by
% \cs{DeclareTextComposite}. This should be robust, finally.
%    \begin{macrocode}
      \edef\@tempa{\expandafter\expandafter\expandafter\expandafter
                   \expandafter\expandafter\expandafter
                   \meaning\expandafter
                      \csname\expandafter
                         \string\csname\MT@encoding\endcsname
                         \string#1-%
                         \string#2%
                      \endcsname}%
      \expandafter\expandafter\expandafter\Mt@is@letter
            \expandafter\@tempa\Mt@letterstring \relax\relax
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@detokenize}
% Translate a macro into a character token list. When using \etex, we utilize the
% \cmd{\detokenize} command, which allows us to specify accented characters
% consisting of two commands, like \cmd{\`}\cmd{\i} or \cmd{\U}\cmd{\CYRI}.
% With the non-\etex\ version, this fails. It could probably also be made to
% work (fiddling with \cmd{\meaning}), however, I can't be bothered right now
% -- before somebody stumbles over this, vanilla \TeX\ will be dead.
%    \begin{macrocode}
\ifcase\MT@etex@no
   \def\MT@detokenize#1{\expandafter\string#1}
\else
   \def\MT@detokenize#1{%
      \detokenize\expandafter\expandafter\expandafter{\expandafter\string#1}}
\fi
%    \end{macrocode}
%\end{macro}
% Some warning messages, for performance reasons separated here.
%\begin{macro}{\MT@curr@list@name}
%\changes{v1.8}{2005/06/08}{new macro: current list type and name}
% The type and name of the current list.
%    \begin{macrocode}
\let\MT@curr@list@name\@empty
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\Mt@warn@ascii}
% For characters with character code \textgreater\ 127, we issue a warning
% (\pkg{inputenc} probably hasn't been loaded), since correspondence with
% the slot numbers would be purely coincidental.
%    \begin{macrocode}
\def\Mt@warn@ascii{%
   \MT@warning@nl{Character `\expandafter\string\the\toks@' (= \Mt@char)
      is outside of ASCII range.\MessageBreak
      You must load the inputenc package before using\MessageBreak
      8-bit characters in \MT@curr@list@name}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@warn@unknown}
% No idea what went wrong.
%    \begin{macrocode}
\def\MT@warn@unknown{%
   \MT@warning@nl{Unknown slot number of character
      `\expandafter\string\the\toks@' in\MessageBreak
      font encoding `\MT@encoding' in \MT@curr@list@name}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@warn@unknown@i}
% Not all of the string has been parsed.
%    \begin{macrocode}
\def\MT@warn@unknown@i{%
   \MT@warning@nl{Unknown slot number of character
      `\expandafter\string\the\toks@' in\MessageBreak
      font encoding `\MT@encoding'. Make sure it's a single\MessageBreak
      character (or a number) in \MT@curr@list@name}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@warn@number@too@large}
% Number too large.
%    \begin{macrocode}
\def\MT@warn@number@too@large#1{%
   \MT@warning@nl{%
      Number #1 in encoding `\MT@encoding' too large!\MessageBreak
      Ignoring it in \MT@curr@list@name}%
}
%    \end{macrocode}
%\end{macro}
%
%\subsubsection{Hook into \LaTeX's font selection}
%
% We append \cs{MT@setupfont} to \cmd{\pickup@font}, which is called by \LaTeX\
% every time a font is selected. We then check whether we've already seen this
% font, and if not, set it up for micro-typography.
% This ensures that we will catch all fonts, and that we will not set up fonts
% more than once. The whole package really hangs on this command.
%
% In contrast to the \pkg{pdfcprot} package, there is no need to declare the
% fonts in advance that should benefit from micro-typographic treatment. Also,
% only those fonts that are actually being used will be set up for expansion
% and protrusion.
%
% For my reference:
%\begin{itemize}
%  \item \cmd{\pickup@font} is called by \cmd{\selectfont}, \cmd{\wrong@fontshape},
%     or \\ \cmd{\getanddefine@fonts} (for math).
%  \item \cmd{\pickup@font} calls \cmd{\define@newfont}.
%  \item \cmd{\define@newfont} may call (inside a group!)
%  \begin{itemize}
%     \item \cmd{\wrong@fontshape}, which in turn will call \cmd{\pickup@font},
%        and thus \\ \cmd{\define@newfont} again, or
%     \item \cmd{\extract@font}.
%  \end{itemize}
%  \item \cmd{\get@external@font} is called by \cmd{\extract@font}, by itself,
%        and by the substitution macros
%\end{itemize}
%
%\changes{v1.2}{2004/10/02}{check for packages that might load fonts}
%\changes{v1.4}{2004/11/04}{no need to check for packages that might load fonts anymore}
%\changes{v1.4}{2004/11/04}{use \cmd{\pickup@font} instead of \cmd{\define@newfont}
%                           as the hook for \cs{MT@setupfont}}
% Up to version 1.3 of this package, we were using \cmd{\define@newfont} as the
% hook, which is only called for new fonts, and therefore seemed the natural
% choice.
% However, this meant that we had to take special care to catch all fonts: We
% additionally had to set up the default font, the error font (if it wasn't the
% default font), we had to check for some packages that might have been loaded
% before \microtype\ and were loading fonts, e.g. \pkg{jurabib},
% \pkg{ledmac}, \pkg{pifont} (loaded by \pkg{hyperref}), \pkg{tipa}, and
% probably many more. Furthermore, we had to include a hack for the
% \pkg{IEEEtran} class which loads all fonts in the class file itself (to fine
% tune inter-word spacing). Then I learned that even my favorite class, the
% \pkg{memoir} class, loads fonts. To cut this short: It seemed to get out of
% hand, and I decided that it would be better to use \cmd{\pickup@font} and
% decide for ourselves whether we've already seen that font. I hope the
% overhead isn't too large.
%\begin{macro}{\MT@font@list}
% (We use a comma-separated list.)
%    \begin{macrocode}
\let\MT@font@list\@empty
%    \end{macrocode}
%\end{macro}
%\changes{v1.8}{2005/05/15}{if font substitution has occurred, set up the
%                           substitute font, not the selected one}
%\begin{macro}{\MT@font@name}
% Additionally, we hook into \cmd{\do@subst@correction}, which is called if
% a substitution has taken place, to record the name of the ersatz font.
% Unfortunately, this will only work for one-level substitutions.
%    \begin{macrocode}
\let\MT@font@name\@empty
\g@addto@macro\do@subst@correction{%
   \xdef\MT@font@name{\csname \curr@fontshape/\f@size\endcsname}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@orig@pickupfont}
% Check whether \cmd{\pickup@font} is defined as expected.
% The warning issued by \cmd{\CheckCommand*} would be a bit too generic.
%    \begin{macrocode}
\def\MT@orig@pickupfont{\expandafter\ifx\font@name\relax\define@newfont\fi}
\ifx\pickup@font\MT@orig@pickupfont \else
   \MT@warning@nl{%
      Command \string\pickup@font\space is not defined as expected.\MessageBreak
      Double-check whether micro-typography is indeed\MessageBreak
      applied to the document.\MessageBreak (Hint: Turn on `verbose' mode)%
   }
\fi
%    \end{macrocode}
%\end{macro}
% Then we append our stuff.
%    \begin{macrocode}
\g@addto@macro\pickup@font{%
   \begingroup
      \escapechar\m@ne
%    \end{macrocode}
% If \cs{MT@font@name} is empty, no substitution has taken place, hence
% \cmd{\font@name} is correct. Otherwise, if they are different,
% \cmd{\font@name} does not describe the font actually used. This test will
% catch one-level substitutions, like |bx| to |b|, but it will still fail if
% the substituting font is itself substituted.
%    \begin{macrocode}
      \ifx\MT@font@name\@empty
         \let\MT@font@name\font@name
      \else
         \ifx\MT@font@name\font@name \else
            \xdef\MT@font@list{\MT@font@list\font@name,}%
         \fi
      \fi
      \expandafter\MT@in@clist\expandafter{\MT@font@name}\MT@font@list
      \ifMT@inlist@ \else
         \MT@setupfont
         \xdef\MT@font@list{\MT@font@list\MT@font@name,}%
      \fi
   \endgroup
   \global\let\MT@font@name\@empty
}
%    \end{macrocode}
%\begin{macro}{\MT@pickupfont}
% Remember the patched command for later.
%    \begin{macrocode}
\let\MT@pickupfont\pickup@font
%    \end{macrocode}
%\end{macro}
%\changes{v1.8}{2005/06/14}{bug fix: disable micro-typographic setup inside \cmd{\add@accent}
%                           (reported by Stephan Hennig)}% ^^A <stephanhennig\at arcor.de>
%                      ^^A in <MID: <42adb0e3$0$27784$9b4e6d93@newsread2.arcor-online.net>
% Inside \cmd{\add@accent}, we have to disable \microtype's setup, since the
% grouping in the patched \cmd{\pickup@font} would break the accent if
% different fonts are used for the base character and the accent. Fortunately,
% \LaTeX\ takes care that the fonts used for the \cmd{\accent} are already set
% up, so that we cannot be overlooking them.
% At first, I was going to change \cmd{\hmode@bgroup} only, but that is also
% used in the commands defined by \cmd{\DeclareTextFontCommand}, \ie,
% \cmd{\textit} etc.
%    \begin{macrocode}
\let\MT@add@accent\add@accent
\def\add@accent#1#2{%
   \let\pickup@font\MT@orig@pickupfont
   \MT@add@accent{#1}{#2}%
   \let\pickup@font\MT@pickupfont
}
%    \end{macrocode}
%\changes{v1.6}{2004/12/29}{test whether \cmd{\pickup@font} has changed}
% We also test whether our definition has survived (\cmd{\pickup@font} is
% at least redefined by \pkg{CJK}\footnote{
%     Can anybody say something about how \microtype\ and \pkg{CJK} work
%     together?}).
%    \begin{macrocode}
\AtBeginDocument{%
   \ifx\MT@pickupfont\pickup@font \else
      \MT@error{%
         Another package has overwritten the definition\MessageBreak
         of \string\pickup@font. I might not be able to\MessageBreak
         apply any micro-typography. Please find the\MessageBreak
         culprit, and load it before the microtype package
      }{%
The microtype package attaches the micro-typographic setup to\MessageBreak
\string\pickup@font. If the other package has simply overwritten this\MessageBreak
command, nothing will work. If, on the other hand, it has changed\MessageBreak
the command in a cautious way, everything may be fine.\MessageBreak
In either case, please send a report to <w.m.l@gmx.net>.
      }%
   \fi
}
%    \end{macrocode}
%
%
%\subsection{Configuration}
%
%\subsubsection{Font Sets}
%
%\begin{macro}{\DeclareMicrotypeSet}
%\begin{macro}{\DeclareMicrotypeSet*}
% Calling this macro will create a comma list for every font characteristic of
% the form: |\MT|\meta{|pr|\textbar|ex|}|list@|\meta{characteristic}|@|\meta{set name}.
% If the optional argument is empty, lists for both expansion and protrusion
% will be created.
%
% The third argument must be a list of |key=value| pairs. If a font characteristic
% is not specified, we define the corresponding list to \cmd{\relax}, so that it
% does not constitute a constraint.
%    \begin{macrocode}
\def\DeclareMicrotypeSet{%
   \@ifstar
      {\@ifnextchar[\MT@DeclareSetAndUseIt
                   {\MT@DeclareSetAndUseIt[]}}%
      {\@ifnextchar[\MT@DeclareSet
                   {\MT@DeclareSet[]}}%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@DeclareSet}
%    \begin{macrocode}
\def\MT@DeclareSet[#1]{%
   \MT@DeclareSet@{#1}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@DeclareSetAndUseIt}
%    \begin{macrocode}
\def\MT@DeclareSetAndUseIt[#1]#2#3{%
   \MT@DeclareSet@{#1}{#2}{#3}%
   \UseMicrotypeSet[#1]{#2}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@DeclareSet@}
%\changes{v1.1}{2004/09/15}{remove spaces around first argument}
%    \begin{macrocode}
\def\MT@DeclareSet@#1#2#3{%
   \KV@@sp@def\@tempa{#1}%
   \MT@ifempty\@tempa{%
      \MT@declare@sets{pr}{#2}{#3}%
      \MT@declare@sets{ex}{#2}{#3}%
   }{%
      \expandafter\MT@declare@sets\expandafter
            {\csname MT@rbba@\@tempa\endcsname}{#2}{#3}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@curr@set@name}
% We need to remember the name of the set currently being declared.
%    \begin{macrocode}
\let\MT@curr@set@name\@empty
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@declare@sets}
% Define the current set name and parse the keys.
%\changes{v1.1}{2004/09/20}{remove spaces around set name}
%\changes{v1.8}{2005/05/15}{warning when redefining a set}
%    \begin{macrocode}
\def\MT@declare@sets#1#2#3{%
   \KV@@sp@def\MT@curr@set@name{#2}%
   \MT@ifdefined@n{MT@#1@set@@\MT@curr@set@name}{%
      \MT@warning{Redefining set `\MT@curr@set@name'}%
   }\relax
   \global\MT@let@nc{MT@#1@set@@\MT@curr@set@name}\@empty
%<debug>\MT@dinfo{1}{declaring \@nameuse{MT@abbr@#1} set `\MT@curr@set@name'}%
   \setkeys{MT@#1@set}{#3}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@set@keys}
% Define the \pkg{keyval} keys for expansion and protrusion sets.
%    \begin{macrocode}
\def\MT@define@set@keys#1{%
   \MT@define@set@key{#1}{encoding}%
   \MT@define@set@key{#1}{family}%
   \MT@define@set@key{#1}{series}%
   \MT@define@set@key{#1}{shape}%
   \MT@define@set@key@size{#1}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@set@key}
% \meta{\#1} = \meta{|pr|\textbar|ex|}, \meta{\#2} = font axis,
%\changes{v1.8}{2005/04/16}{use comma lists instead of token lists}
%    \begin{macrocode}
\def\MT@define@set@key#1#2{%
   \csname MT@#1list@#2@\MT@curr@set@name\endcsname
   \define@key{MT@#1@set}{#2}[]{%
      \global\MT@let@nc{MT@#1list@#2@\MT@curr@set@name}\@empty
      \MT@map@clist@n{##1}{%
%    \end{macrocode}
% Get rid of spaces.
%    \begin{macrocode}
         \KV@@sp@def\MT@val{####1}%
         \MT@get@highlevel{#2}%
         \MT@make@string\MT@val
         \expandafter\MT@xadd
            \csname MT@#1list@#2@\MT@curr@set@name\endcsname{\MT@val,}%
      }%
%<debug>\MT@dinfo@nl{1}{-- #2: \@nameuse{MT@#1list@#2@\MT@curr@set@name}}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@highlevel}
% Saying, for instance, `|family=rm*|' or `|shape=bf*|' will lead to
% \cmd{\rmdefault} resp. \cmd{\bfdefault} being expanded/protruded.
%    \begin{macrocode}
\def\MT@get@highlevel#1{%
   \expandafter\MT@test@ast\MT@val*\@nil
   \if@tempswa
%    \end{macrocode}
% And `|family = *|' will become \cmd{\familydefault}.
%    \begin{macrocode}
      \MT@ifempty\@tempa{\def\@tempa{#1}}\relax
      \edef\MT@val{\csname \@tempa default\endcsname}%
%    \end{macrocode}
% Beware that \cmd{\rmdefault} etc. might change after this package has been
% loaded! Therefore, we check (once for each characteristic/list) at the
% beginning of the document.
%\changes{v1.2}{2004/09/26}{check whether defaults have changed}
%\changes{v1.5}{2004/12/02}{don't test defaults if called after begin document}
%    \begin{macrocode}
      \ifx\@nodocument\relax \else
         \expandafter\ifx
               \csname MT@check@\MT@curr@set@name @\@tempa\endcsname\@empty
         \else
            \global\MT@edef@n{MT@\MT@curr@set@name @\@tempa @default}{\MT@val}%
            \edef\x{{\MT@curr@set@name}{\@tempa}}%
            \expandafter\AtBeginDocument\expandafter{%
               \expandafter\MT@check@default\x
            }%
            \global\MT@let@nc{MT@check@\MT@curr@set@name @\@tempa}\@empty
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@test@ast}
% Test whether last character is an asterisk.
%\changes{v1.7}{2005/03/10}{make it simpler}
%    \begin{macrocode}
\def\MT@test@ast#1*#2\@nil{%
   \def\@tempa{#1}%
   \MT@ifempty{#2}%
      \@tempswafalse
      \@tempswatrue
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@check@default}
%\changes{v1.2}{2004/09/26}{new macro}
%    \begin{macrocode}
\def\MT@check@default#1#2{%
   \MT@let@cn\@tempa{MT@#1@#2@default}%
   \edef\@tempb{\csname #2default\endcsname}%
   \ifx\@tempa\@tempb\else
      \MT@warning@nl{%
         \expandafter\noexpand\csname #2default\endcsname
         has changed (`\@tempa' <> `\@tempb')!\MessageBreak
         This might affect the `#1' font set.\MessageBreak
         Please make all relevant font changes *before*\MessageBreak
         loading the `microtype' package}%
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@set@key@size}
% |size| requires special treatment.
%    \begin{macrocode}
\def\MT@define@set@key@size#1{%
   \define@key{MT@#1@set}{size}[]{%
      \MT@map@clist@n{##1}{%
         \KV@@sp@def\MT@val{####1}%
         \expandafter\MT@get@range\MT@val--\@nil
         \ifx\MT@val\relax \else
            \expandafter\MT@xadd
                  \csname MT@#1list@size@\MT@curr@set@name\endcsname
                 {{{\MT@lower}{\MT@upper}\relax}}%
         \fi
      }%
%<debug>\MT@dinfo@nl{1}{-- size: \@nameuse{MT@#1list@size@\MT@curr@set@name}}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\changes{v1.7}{2005/03/11}{allow specification of size ranges
%                           (suggested by Andreas B\"uhmann)} ^^A <andreas.buehmann\at web.de>
%                                                             ^^A private mail, 10/3/2005
% Font sizes may also be specified as ranges. This has been requested by Andreas
% B\"uhmann, who has also offered valuable help in implementing this. Now, it
% is for instance possible to set up different lists for fonts with optical
% sizes. (The MinionPro project is trying to do this for the OpenType version
% of Adobe's Minion. See \url{http://developer.berlios.de/projects/minionpro/}.)%
%
%\begin{macro}{\MT@get@range}
%\begin{macro}{\MT@upper}
%\begin{macro}{\MT@lower}
%\changes{v1.7}{2005/03/11}{new macro: allow size ranges}
% Ranges will be stored as triples of
% |{|\meta{lower bound}|}{|\meta{upper bound}|}{|\meta{list name}|}|.
% For simple sizes, the upper boundary is -1.
%    \begin{macrocode}
\def\MT@get@range#1-#2-#3\@nil{%
   \MT@ifempty{#1}{%
      \MT@ifempty{#2}{%
         \let\MT@val\relax
      }{%
         \def\MT@lower{0}%
         \def\MT@val{#2}%
         \MT@get@size
         \edef\MT@upper{\MT@val}%
      }%
   }{%
      \def\MT@val{#1}%
      \MT@get@size
      \ifx\MT@val\relax \else
         \edef\MT@lower{\MT@val}%
         \MT@ifempty{#2}{%
            \MT@ifempty{#3}{%
               \def\MT@upper{-1}%
            }{%
               \def\MT@upper{2048}%
            }%
         }{%
            \def\MT@val{#2}%
            \MT@get@size
            \ifx\MT@val\relax \else
               \MT@ifgt\MT@lower\MT@val{%
                  \MT@warning{%
                     Invalid size range (\MT@lower\space > \MT@val) in font set
                     `\MT@curr@set@name'.\MessageBreak Swapping sizes}%
                  \edef\MT@upper{\MT@lower}%
                  \edef\MT@lower{\MT@val}%
               }{%
                  \edef\MT@upper{\MT@val}%
               }%
               \MT@ifeq\MT@lower\MT@upper{%
                  \def\MT@upper{-1}%
               }\relax
            \fi
         }%
      \fi
   }%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@get@size}
% Translate a size selection command and normalize it.
%    \begin{macrocode}
\def\MT@get@size{%
%    \end{macrocode}
% A single star would mean \cs{sizedefault}, which doesn't exist, so we define
% it to be \cmd{\normalsize}.
%    \begin{macrocode}
   \if*\MT@val\relax
      \def\@tempa{\normalsize}%
   \else
      \MT@let@cn\@tempa{\MT@val}%
   \fi
   \ifx\@tempa\relax \else
%    \end{macrocode}
% The \pkg{relsize} solution of parsing \cmd{\@setfontsize} does not work with the
% \pkg{ams*} classes, among others. I hope my hijacking doesn't do any harm.
%\changes{v1.2}{2004/09/26}{hijack \cmd{\set@fontsize} instead of \cmd{\@setfontsize}}
% We redefine \cmd{\set@fontsize}, and not \cmd{\@setfontsize} because some classes
% might define the size selection commands by simply using \cmd{\fontsize}
% (\eg\ the \pkg{a0poster} class).
%    \begin{macrocode}
      \begingroup
         \def\set@fontsize##1##2##3##4\@nil{\gdef\MT@val{##2}}%
         \@tempa\@nil
      \endgroup
   \fi
%    \end{macrocode}
% Test whether we finally got a number or dimension so that we can strip the
% `|pt|' (\cmd{\@defaultunits} and \cmd{\strip@pt} are kernel macros).
%\changes{v1.2}{2004/09/27}{additional magic to catch some errors}
%\changes{v1.4b}{2004/11/22}{don't set \cs{MT@count} globally (save stack problem)}
%\changes{v1.7}{2005/03/15}{comparison with 1 to allow size smaller than 1
%                           (suggested by Andreas B\"uhmann)} ^^A <andreas.buehmann\at web.de>
%                                                             ^^A private mail, 15/03/2005
%    \begin{macrocode}
   \setbox\z@=\hbox{%
      \MT@count=1\MT@val\relax
      \ifnum\MT@count=\@ne
         \@tempswafalse
      \else
         \@tempswatrue
      \fi\expandafter}%
   \if@tempswa
      \@defaultunits\@tempdima\MT@val pt\relax\@nnil
      \edef\MT@val{\strip@pt\@tempdima}%
   \else
      \MT@warning{Could not parse font size `\MT@val'\MessageBreak
                  in font set `\MT@curr@set@name'}%
      \let\MT@val\relax
   \fi
}
%    \end{macrocode}
%\end{macro}
% We have finally assembled all pieces to define \cs{DeclareMicrotypeSet}'s
% keys.
%    \begin{macrocode}
\MT@define@set@keys{pr}
\MT@define@set@keys{ex}
%    \end{macrocode}
%\begin{macro}{\UseMicrotypeSet}
% To use a particular set we simply redefine
% |MT@|\meta{|pr|\textbar|ex|}|@setname|. If the optional argument is empty,
% both \cs{MT@pr@setname} and \cs{MT@ex@setname} will be redefined.
%\changes{v1.1}{2004/09/20}{remove spaces around first argument}
%    \begin{macrocode}
\renewcommand*\UseMicrotypeSet[2][]{%
   \KV@@sp@def\@tempa{#1}%
   \MT@ifempty\@tempa{%
      \MT@use@set{pr}{#2}%
      \MT@use@set{ex}{#2}%
   }{%
      \expandafter\MT@use@set\expandafter
         {\csname MT@rbba@\@tempa\endcsname}{#2}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@pr@setname}
%\begin{macro}{\MT@ex@setname}
%\begin{macro}{\MT@use@set}
% Only use sets that have been declared.
%\changes{v1.1}{2004/09/20}{remove spaces around set name}
%\changes{v1.4b}{2004/11/25}{don't use undeclared font sets}
%\changes{v1.6}{2005/01/19}{retain current set if new set is undeclared}
%\changes{v1.8}{2005/05/15}{bug fix: remove braces in first line}
%    \begin{macrocode}
\def\MT@use@set#1#2{%
   \KV@@sp@def\@tempa{#2}%
   \MT@ifdefined@n{MT@#1@set@@\@tempa}{%
      \global\MT@edef@n{MT@#1@setname}{\@tempa}%
      \MT@info{Using \@nameuse{MT@abbr@#1} set `\@tempa'}%
   }{%
      \MT@ifdefined@n{MT@#1@setname}\relax{%
         \global\MT@edef@n{MT@#1@setname}{\@nameuse{MT@default@#1@set}}%
      }%
      \MT@warning{%
         The \@nameuse{MT@abbr@#1} set `\@tempa' is undeclared.\MessageBreak
         Using set `\@nameuse{MT@#1@setname}' instead}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\DeclareMicrotypeSetDefault}
%\changes{v1.8}{2005/05/15}{new macro: set fall back font set}
% This command can be used in the main configuration file to declare the
% default font set, in case no set has been specified in the package options.
%    \begin{macrocode}
\renewcommand*\DeclareMicrotypeSetDefault[2][]{%
   \KV@@sp@def\@tempa{#1}%
   \MT@ifempty\@tempa{%
      \MT@set@default@set{pr}{#2}%
      \MT@set@default@set{ex}{#2}%
   }{%
      \expandafter\MT@set@default@set\expandafter
         {\csname MT@rbba@\@tempa\endcsname}{#2}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@default@pr@set}
%\begin{macro}{\MT@default@ex@set}
%\begin{macro}{\MT@set@default@set}
%    \begin{macrocode}
\def\MT@set@default@set#1#2{%
   \KV@@sp@def\@tempa{#2}%
   \MT@ifdefined@n{MT@#1@set@@\@tempa}{%
%<debug>\MT@dinfo{1}{declaring default \@nameuse{MT@abbr@#1} set `\@tempa'}%
      \global\MT@edef@n{MT@default@#1@set}{\@tempa}%
   }{%
      \MT@warning{%
         The \@nameuse{MT@abbr@#1} set `\@tempa' is not declared.\MessageBreak
         Cannot make it the default set. Using set\MessageBreak `all' instead}%
      \global\MT@edef@n{MT@default@#1@set}{all}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\DeclareMicrotypeAlias}
% This can be used to set an alias name for a font, so that the file (and the
% settings) for the aliased font will be loaded.
%\changes{v1.5}{2004/12/03}{remove spaces around arguments}
%\changes{v1.8}{2005/05/09}{warning when overriding an alias font}
%    \begin{macrocode}
\renewcommand*\DeclareMicrotypeAlias[2]{%
   \KV@@sp@def\@tempa{#1}%
   \KV@@sp@def\@tempb{#2}%
   \MT@make@string\@tempb
   \MT@ifdefined@n{MT@\@tempa @alias}{%
      \MT@warning{Alias font family `\@tempb' will override
         alias `\@nameuse{MT@\@tempa @alias}'\MessageBreak
         for font family `\@tempa'}}\relax
   \global\MT@edef@n{MT@\@tempa @alias}{\@tempb}%
%    \end{macrocode}
% If we encounter this command while a font is being set up, we also set the
% alias for the current font so that if \cs{DeclareMicrotypeAlias} has been
% issued inside a configuration file, the configuration file for the alias font
% will be loaded, too.
%\changes{v1.7}{2005/03/23}{may also be used inside configuration files}
%    \begin{macrocode}
   \MT@ifdefined@c\MT@family{%
%<debug>\MT@dinfo{1}{Activating alias font `\@tempb' for `\MT@family'}%
      \global\let\MT@familyalias\@tempb
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\LoadMicrotypeFile}
%\changes{v1.7}{2005/03/22}{new macro (suggested by Andreas B\"uhmann)}
%                                              ^^A <andreas.buehmann\at web.de>
%                                              ^^A private mail, 21/3/2005
% May be used to load a configuration file manually.
%    \begin{macrocode}
\def\LoadMicrotypeFile#1{%
   \KV@@sp@def\@tempa{#1}%
   \MT@make@string\@tempa
   \expandafter\MT@in@clist\expandafter{\@tempa}\MT@file@list
   \ifMT@inlist@
      \MT@vinfo{... Configuration file mt-\@tempa.cfg already loaded}%
   \else
      \MT@xadd\MT@file@list{\@tempa,}%
      \MT@begin@catcodes
      \InputIfFileExists{mt-\@tempa.cfg}{%
         \MT@vinfo{... Loading configuration file mt-\@tempa.cfg}%
      }{%
         \MT@warning{... Configuration file mt-\@tempa.cfg\MessageBreak
                     does not exist}%
      }%
      \MT@end@catcodes
   \fi
}
%</package>
%    \end{macrocode}
%\end{macro}
%
%\subsubsection{Declarations}
%
% We now set up some default sets (in the main configuration file).
%\changes{v1.2}{2004/10/02}{new font sets: \texttt{allmath} and \texttt{basicmath}}
%\changes{v1.8}{2005/05/25}{font sets: add \texttt{U} encoding to \texttt{allmath}}
%
%\NoIndexing
%    \begin{macrocode}
%<*config&m-t>

%%% ----------------------------------------------------------------------
%%% FONT SETS

\DeclareMicrotypeSet{all}
   { }

\DeclareMicrotypeSet{allmath}
   { encoding = {T1,OT1,LY1,TS1,OML,OMS,U} }

\DeclareMicrotypeSet{alltext}
   { encoding = {T1,OT1,LY1,TS1} }

\DeclareMicrotypeSet{basicmath}
   { encoding = {T1,OT1,LY1,OML,OMS},
     family   = {rm*,sf*},
     series   = {m},
     size     = {normalsize,footnotesize,small,large}
   }

\DeclareMicrotypeSet{basictext}
   { encoding = {T1,OT1,LY1},
     family   = {rm*,sf*},
     series   = {m},
     size     = {normalsize,footnotesize,small,large}
   }

\DeclareMicrotypeSet{normalfont}
   { encoding = *,
     family   = *,
     series   = *,
     shape    = *,
     size     = *
   }

%    \end{macrocode}
% The default sets.
%    \begin{macrocode}
\DeclareMicrotypeSetDefault[protrusion]{alltext}
\DeclareMicrotypeSetDefault[expansion] {basictext}

%    \end{macrocode}
% The Latin Modern fonts, the virtual fonts from the \pkg{ae} and \pkg{zefonts},
% and the \pkg{eco} and \pkg{hfoldsty} packages (oldstyle numerals) all inherit
% the (basic) settings from Computer Modern Roman. Some of them are in part
% overwritten later.
%\changes{v1.2}{2004/10/03}{declare \texttt{cmr} as an alias for \texttt{cmor}}
%\changes{v1.3}{2004/10/22}{declare \texttt{cmr} as an alias for
%                          \texttt{aer}, \texttt{zer} and \texttt{hfor}}
% The packages \pkg{pxfonts} and \pkg{txfonts} fonts inherit Palatino and Times
% settings respectively.
%\changes{v1.8}{2005/04/19}{declare \texttt{ppl} and \texttt{ptm} as alias
%                           fonts for \texttt{pxr} resp. \texttt{txr}}
%    \begin{macrocode}
%%% ----------------------------------------------------------------------
%%% FONT ALIASES

\DeclareMicrotypeAlias{lmr} {cmr}  % lmodern
\DeclareMicrotypeAlias{aer} {cmr}  % ae
\DeclareMicrotypeAlias{zer} {cmr}  % zefonts
\DeclareMicrotypeAlias{cmor}{cmr}  % eco
\DeclareMicrotypeAlias{hfor}{cmr}  % hfoldsty
\DeclareMicrotypeAlias{pxr} {ppl}  % pxfonts
\DeclareMicrotypeAlias{txr} {ptm}  % txfonts
%</config&m-t>
%    \end{macrocode}
%\Indexing
%
%\subsubsection{Fine Tuning}
%
% The macros \cs{SetExpansion} and \cs{SetProtrusion} provide a similar
% interface for setting the character protrusion resp. expansion factors for a
% set of fonts.
%
%\begin{macro}{\SetProtrusion}
%\begin{macro}{\MT@pr@c@name}
%\begin{macro}{\MT@load}
%\begin{macro}{\MT@extra@factor}
%\begin{macro}{\MT@extra@unit}
% This macro accepts three arguments: [options,] set of font characteristics and
% list of character protrusion factors.
%
% A new macro called |\MT@pr@c@|\meta{name} will be defined to be \meta{\#3}
% (i.e. the list of characters, not expanded).
%    \begin{macrocode}
%<*package>
\renewcommand*\SetProtrusion[2][]{%
   \let\MT@pr@c@name\@undefined
   \let\MT@load\@undefined
   \let\MT@extra@factor\@undefined
   \let\MT@extra@unit\@undefined
%    \end{macrocode}
% Parse the optional first argument:
%    \begin{macrocode}
   \setkeys{MT@pr@c}{#1}%
%    \end{macrocode}
% If the user hasn't specified a name, we will create one.
%    \begin{macrocode}
   \MT@get@codes@name{pr}%
   \MT@set@pr@opt
%<debug>\MT@dinfo{1}{creating protrusion list `\MT@pr@c@name'}%
   \setkeys{MT@pr@c}{#2}%
%    \end{macrocode}
%\begin{macro}{\MT@permutelist}
% We have parsed the second argument, and can now define macros for all
% permutations of the font characteristics to point to
% |\MT@pr@c@|\meta{name},~\dots
%    \begin{macrocode}
   \def\MT@permutelist{pr@c}%
   \MT@permute
%    \end{macrocode}
% \dots~which we can now define to be \meta{\#3}.
% We want the catcodes to be correct even if this is called in the preamble.
%    \begin{macrocode}
   \MT@begin@catcodes
   \MT@set@pr@list
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@set@pr@list}
% Here, as elsewhere, we have to make the definitions global, since they will
% occur inside a group.
%    \begin{macrocode}
\def\MT@set@pr@list#1{%
   \global\MT@def@n{MT@pr@c@\MT@pr@c@name}{#1}%
   \MT@end@catcodes
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\SetExpansion}
%\begin{macro}{\MT@ex@c@name}
%\begin{macro}{\MT@load}
%\begin{macro}{\MT@extra@factor}
%\begin{macro}{\MT@extra@stretch}
%\begin{macro}{\MT@extra@shrink}
%\begin{macro}{\MT@extra@step}
%\begin{macro}{\MT@extra@auto}
% \cs{SetExpansion} only differs in that it allows some extra options
% (|stretch|, |shrink|, |step|, |auto|).
%    \begin{macrocode}
\renewcommand*\SetExpansion[2][]{%
   \let\MT@ex@c@name\@undefined
   \let\MT@load\@undefined
   \let\MT@extra@factor\@undefined
   \let\MT@extra@stretch\@undefined
   \let\MT@extra@shrink\@undefined
   \let\MT@extra@step\@undefined
   \let\MT@extra@auto\@undefined
   \setkeys{MT@ex@c}{#1}%
   \MT@get@codes@name{ex}%
   \MT@set@ex@opt
%<debug>\MT@dinfo{1}{creating expansion list `\MT@ex@c@name'}%
   \setkeys{MT@ex@c}{#2}%
   \def\MT@permutelist{ex@c}%
   \MT@permute
   \MT@begin@catcodes
   \MT@set@ex@list
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@set@ex@list}
% Same story.
%    \begin{macrocode}
\def\MT@set@ex@list#1{%
   \global\MT@def@n{MT@ex@c@\MT@ex@c@name}{#1}%
   \MT@end@catcodes
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@codes@name}
% Simply use a roman number as the list name if the user didn't bother creating
% one.
%    \begin{macrocode}
\def\MT@get@codes@name#1{%
   \MT@ifdefined@n{MT@#1@c@name}{%
      \MT@ifdefined@n{MT@#1@c@\csname MT@#1@c@name\endcsname}{%
         \MT@warning{Redefining list `\@nameuse{MT@#1@c@name}'}%
      }\relax
   }{%
      \@tempcnta=\@ne
      \MT@loop
         \MT@ifdefined@n{MT@#1@c@#1-\romannumeral\@tempcnta}{%
            \advance \@tempcnta \@ne
         }{%
            \MT@edef@n{MT@#1@c@name}{#1-\romannumeral\@tempcnta}%
            \@tempcnta=\z@
         }%
         \ifnum\@tempcnta > \z@ \MT@repeat
   }%
   \MT@let@cn\MT@curr@set@name{MT@#1@c@name}%
%    \end{macrocode}
%\changes{v1.3}{2004/10/27}{bug fix: specifying \texttt{load} option does no
%                           longer require to give a \texttt{name}, too}
% Now that we know the name, we can cater for any set to be loaded by this list.
%    \begin{macrocode}
   \MT@ifdefined@c\MT@load{%
      \global\MT@let@nc{MT@#1@c@\MT@curr@set@name load}\MT@load
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@set@pr@opt}
% Two extra option for protrusion: |factor| and |unit|.
%    \begin{macrocode}
\def\MT@set@pr@opt{%
   \MT@ifdefined@c\MT@extra@factor{%
      \global\MT@let@nc{MT@pr@c@\MT@pr@c@name @factor}\MT@extra@factor
   }\relax
   \MT@ifdefined@c\MT@extra@unit{%
      \global\MT@let@nc{MT@pr@c@\MT@pr@c@name @unit}\MT@extra@unit
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@set@ex@opt}
% The extra options to \cs{SetExpansion} also have to be dealt with only after
% we know the name.
%\changes{v1.4}{2004/11/10}{bug fix: specifying extra options does no
%                           longer require to give a \texttt{name}, too}
%    \begin{macrocode}
\def\MT@set@ex@opt{%
   \MT@ifdefined@c\MT@extra@factor{%
      \ifnum\MT@extra@factor>\@m
         \MT@warning@nl{Expansion factor \number\MT@extra@factor\space too
            large in list\MessageBreak `\MT@ex@c@name'. Setting it to the
            maximum of 1000}%
         \let\MT@extra@factor\@m
      \fi
      \global\MT@let@nc{MT@ex@c@\MT@ex@c@name @factor}\MT@extra@factor
   }\relax
   \MT@ifdefined@c\MT@extra@stretch{%
      \global\MT@let@nc{MT@ex@c@\MT@ex@c@name @stretch}\MT@extra@stretch
   }\relax
   \MT@ifdefined@c\MT@extra@shrink{%
      \global\MT@let@nc{MT@ex@c@\MT@ex@c@name @shrink}\MT@extra@shrink
   }\relax
   \MT@ifdefined@c\MT@extra@step{%
      \global\MT@let@nc{MT@ex@c@\MT@ex@c@name @step}\MT@extra@step
   }\relax
   \MT@ifdefined@c\MT@extra@auto{%
      \global\MT@let@nc{MT@ex@c@\MT@ex@c@name @auto}\MT@extra@auto
   }\relax
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@code@key}
% Define the keys for expansion and protrusion character code lists.
%    \begin{macrocode}
\def\MT@define@code@key#1#2{%
   \define@key{MT@#1}{#2}[]{%
      \@tempcnta=\@ne
      \MT@map@clist@n{##1}{%
         \KV@@sp@def\MT@val{####1}%
%    \end{macrocode}
% Here, too, we allow for something like `|bf*|'. It will be expanded
% immediately.
%    \begin{macrocode}
         \MT@get@highlevel{#2}%
         \MT@edef@n{MT@temp#2\romannumeral\@tempcnta}{\MT@val}%
         \advance\@tempcnta \@ne
      }%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@code@key@size}
%    \begin{macrocode}
\def\MT@define@code@key@size#1{%
   \define@key{MT@#1}{size}[]{%
      \MT@map@clist@n{##1}{%
         \KV@@sp@def\MT@val{####1}%
         \expandafter\MT@get@range\MT@val--\@nil
         \ifx\MT@val\relax \else
            \expandafter\MT@xadd
                \csname MT@tempsize\endcsname
               {{{\MT@lower}{\MT@upper}{\csname MT@#1@name\endcsname}}}%
         \fi
      }%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@declare@codes}
%    \begin{macrocode}
\def\MT@declare@codes#1{%
   \define@key{MT@#1@c}{name}[]{%
      \MT@ifempty{##1}\relax{%
         \MT@def@n{MT@#1@c@name}{##1}%
      }%
   }%
   \define@key{MT@#1@c}{load}[]{%
      \MT@ifempty{##1}\relax{%
         \def\MT@load{##1}%
      }%
   }%
   \define@key{MT@#1@c}{factor}[]{%
      \MT@ifempty{##1}\relax{%
         \def\MT@extra@factor{##1 }%
      }%
   }%
   \MT@define@code@key{#1@c}{encoding}%
   \MT@define@code@key{#1@c}{family}%
   \MT@define@code@key{#1@c}{series}%
   \MT@define@code@key{#1@c}{shape}%
   \MT@define@code@key@size{#1@c}%
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@declare@codes{pr}
\MT@declare@codes{ex}
%    \end{macrocode}
% Protrusion factors may be relative to character width, or to any length.
%\changes{v1.8}{2005/04/14}{\cs{SetProtrusion}: new option: \texttt{unit}}
%    \begin{macrocode}
\define@key{MT@pr@c}{unit}[relative]{%
   \let\MT@extra@unit\@empty
   \KV@@sp@def\@tempa{#1}%
   \def\@tempb{relative}%
   \ifx\@tempa\@tempb \else
%    \end{macrocode}
% Test whether it's a dimension, but do not translate it into its final
% form here, since it may be font-specific.
%    \begin{macrocode}
      \setbox\z@=\hbox{%
         \MT@count=1\@tempa\relax
         \ifnum\MT@count=\@ne
            \@tempswafalse
         \else
            \@tempswatrue
         \fi\expandafter}%
      \if@tempswa
         \let\MT@extra@unit\@tempa
      \else
         \MT@warning{`\@tempa' is not a dimension.\MessageBreak
            Ignoring it and setting values relative to\MessageBreak
            character widths}%
      \fi
   \fi
}
%    \end{macrocode}
%\begin{macro}{\MT@define@ex@c@key}
% The first argument to \cs{SetExpansion} accepts some more options.
%    \begin{macrocode}
\def\MT@define@ex@c@key#1{%
   \define@key{MT@ex@c}{#1}[]{%
      \MT@ifempty{##1}\relax{%
         \MT@ifnumber{##1}{%
%    \end{macrocode}
% A space terminates the number.
%    \begin{macrocode}
            \MT@def@n{MT@extra@#1}{##1 }%
         }{%
            \MT@warning{%
               Value `##1' for option `#1' is not a number.\MessageBreak
               Ignoring it}%
         }%
      }%
   }%
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@define@ex@c@key{stretch}
\MT@define@ex@c@key{shrink}
\MT@define@ex@c@key{step}
\define@key{MT@ex@c}{auto}[true]{%
   \KV@@sp@def\@tempa{#1}%
   \csname if\@tempa\endcsname
%    \end{macrocode}
% Don't alter \cs{MT@extra@auto} for \pdftex\ version older than 1.20.
%\changes{v1.7}{2005/03/07}{\cs{SetExpansion}: bug fix: remove
%                           space after \texttt{autoexpand}}
%\changes{v1.7}{2005/03/07}{\cs{SetExpansion}: don't allow automatic
%                           expansion for old \pdftex\ versions}
%    \begin{macrocode}
      \ifnum\MT@pdftex@no > \thr@@
         \def\MT@extra@auto{autoexpand}%
      \else
         \MT@warning{pdfTeX too old for automatic font expansion.}%
      \fi
   \else
      \ifnum\MT@pdftex@no > \thr@@
         \let\MT@extra@auto\@empty
      \fi
   \fi
}
%    \end{macrocode}
%
%\subsubsection{Character Inheritance}
%
%\begin{macro}{\DeclareCharacterInheritance}
%\changes{v1.1}{2004/09/15}{new macro: possibility to specify character inheritance}
% This macro may be used in the configuration files to declare characters that
% should inherit protrusion resp. expansion values from other characters. Thus,
% there is no need to define all accented characters (\eg\ |\`a|, |\'a|,
% |\^a|, |\~a|, |\"a|, |\r{a}|, |\k{a}|, |\u{a}|), which will make the
% configuration files look much nicer and easier to maintain. If a single
% character of an inheritance list should have a different value, one can
% simply override it.
%    \begin{macrocode}
\renewcommand*\DeclareCharacterInheritance[2][]{%
   \MT@begin@catcodes
   \MT@set@inh@list{#1}{#2}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@set@inh@list}
% Safe category codes in the third argument.
%    \begin{macrocode}
\def\MT@set@inh@list#1#2#3{%
   \KV@@sp@def\@tempa{#1}%
   \MT@ifempty\@tempa{%
       \MT@declare@char@inh{pr}{#2}{#3}%
       \MT@declare@char@inh{ex}{#2}{#3}%
   }{%
       \expandafter\MT@declare@char@inh\expandafter
            {\csname MT@rbba@\@tempa\endcsname}{#2}{#3}%
   }%
   \MT@end@catcodes
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@declare@char@inh}
% The optional argument may be used to restrict the inheritance list to
% protrusion or expansion.
%    \begin{macrocode}
\def\MT@declare@char@inh#1#2#3{%
   \MT@let@nc{MT@#1@inh@name}\@undefined
   \MT@get@inh@name{#1}%
%<debug>\MT@dinfo{1}{creating inheritance list `\@nameuse{MT@#1@inh@name}'}%
   \global\MT@def@n{MT@#1@inh@\csname MT@#1@inh@name\endcsname}{#3}%
   \setkeys{MT@#1@inh}{#2}%
   \def\MT@permutelist{#1@inh}%
   \MT@permute
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@get@inh@name}
% The inheritance lists cannot be named by the user.
%    \begin{macrocode}
\def\MT@get@inh@name#1{%
   \@tempcnta=\@ne
   \MT@loop
      \MT@ifdefined@n{MT@#1@inh@#1-inh-\romannumeral\@tempcnta}{%
         \advance \@tempcnta \@ne
      }{%
         \MT@edef@n{MT@#1@inh@name}{#1-inh-\romannumeral\@tempcnta}%
         \@tempcnta=\z@
      }%
      \ifnum\@tempcnta > \z@ \MT@repeat
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@inh@key@encoding}
% Parse the first argument. \cs{DeclareCharacterInheritance} may also be set
% up for various combinations.
%\changes{v1.2}{2004/09/29}{check whether only one encoding specified}
%    \begin{macrocode}
\def\MT@define@inh@key@encoding#1{%
   \define@key{MT@#1}{encoding}[]{%
      \def\MT@val{##1}%
      \expandafter\MT@encoding@check\MT@val,\@nil
      \MT@get@highlevel{encoding}%
      \MT@edef@n{MT@tempencoding\romannumeral1}{\MT@val}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@encoding@check}
% But we only allow \emph{one} encoding.
%    \begin{macrocode}
\def\MT@encoding@check#1,#2\@nil{%
   \MT@ifempty{#2}\relax{%
      \edef\MT@val{#1}%
      \MT@warning{You may only specify one encoding for character\MessageBreak
                  inheritance lists. Ignoring encoding(s) #2}%
   }%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@define@inh@keys}
%    \begin{macrocode}
\def\MT@define@inh@keys#1{%
   \MT@define@inh@key@encoding{#1@inh}%
%    \end{macrocode}
% For the rest, we can reuse the key setup from \cs{SetProtrusion} resp.
% \cs{SetExpansion}.
%    \begin{macrocode}
   \MT@define@code@key{#1@inh}{family}%
   \MT@define@code@key{#1@inh}{series}%
   \MT@define@code@key{#1@inh}{shape}%
   \MT@define@code@key@size{#1@inh}%
}
\MT@define@inh@keys{pr}
\MT@define@inh@keys{ex}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@inh@do}
% Parse the second argument, the inheritance lists. We define the commands
% |\MT@inh@|\meta{name}|@|\meta{slot}|@|, containing the inheriting characters.
% They will also be translated to slot numbers here, to save some time. The
% following will be executed only once, namely the first time this inheritance
% list is encountered (in \cs{MT@set@pr@codes} resp. \cs{MT@set@ex@codes}).
%    \begin{macrocode}
\def\MT@inh@do#1,{%
   \ifx\relax#1\@empty\else
      \MT@inh@split #1==\relax
      \expandafter\MT@inh@do
   \fi
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@inh@split}
% Only gather the inheriting characters here. Their protrusion/expansion codes
% will actually be set in |MT@set@|\meta{|prot|\textbar|exp|}|@codes|),
%    \begin{macrocode}
\def\MT@inh@split#1=#2=#3\relax{%
   \def\@tempa{#1}%
   \ifx\@tempa\@empty\else
      \MT@get@slot
      \ifnum\MT@char > \m@ne
         \let\MT@val\MT@char
         \MT@map@clist@n{#2}{%
            \def\@tempa{##1}%
            \ifx\@tempa\@empty\else
               \MT@get@slot
               \ifnum\MT@char > \m@ne
                  \expandafter\MT@xadd
                     \csname MT@inh@\MT@inh@name @\MT@val @\endcsname
                     {{\MT@char}}%
               \fi
            \fi
         }%
%<debug>\MT@dinfo@nl{2}{children of #1 (\MT@val):
%<debug>                \@nameuse{MT@inh@\MT@inh@name @\MT@val @}}%
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%
%\subsubsection{Permutation}
%
%\begin{macro}{\MT@permute}
%\changes{v1.1}{2004/09/15}{don't use sets for empty encoding}
%\begin{macro}{\MT@permute@}
%\begin{macro}{\MT@permute@@}
%\begin{macro}{\MT@permute@@@}
%\begin{macro}{\MT@permute@@@@}
%\begin{macro}{\MT@permute@@@@@}
% Calling \cs{MT@permute} will define commands for all permutations
% of the specified font characteristics of the form
% |\MT@|\meta{list type}|@/|\meta{encoding}|/|\meta{family}|/|^^A
%       \meta{series}|/|\hskip0pt\meta{shape}|/|\meta{\textbar*}
% to be the expansion of |\MT@|\meta{list type}|@name|, \ie, the name of
% the currently defined list. Size ranges are held in a separate macro called
% |\MT@|\meta{list type}|@/|\meta{font axes}|@sizes|, which in turn contains
% the respective \meta{list name}s attached to the ranges.
%    \begin{macrocode}
\def\MT@permute{%
   \let\MT@cnt@encoding\@ne
   \MT@permute@
%    \end{macrocode}
% Undefine commands for the next round.
%    \begin{macrocode}
   \MT@permute@reset
}
\def\MT@permute@{%
   \let\MT@cnt@family\@ne
   \MT@permute@@
   \MT@increment\MT@cnt@encoding
   \MT@ifdefined@n{MT@tempencoding\romannumeral\MT@cnt@encoding}%
      \MT@permute@
      \relax
}
\def\MT@permute@@{%
   \let\MT@cnt@series\@ne
   \MT@permute@@@
   \MT@increment\MT@cnt@family
   \MT@ifdefined@n{MT@tempfamily\romannumeral\MT@cnt@family}%
      \MT@permute@@
      \relax
}
\def\MT@permute@@@{%
   \let\MT@cnt@shape\@ne
   \MT@permute@@@@
   \MT@increment\MT@cnt@series
   \MT@ifdefined@n{MT@tempseries\romannumeral\MT@cnt@series}%
      \MT@permute@@@
      \relax
}
\def\MT@permute@@@@{%
   \MT@permute@@@@@
   \MT@increment\MT@cnt@shape
   \MT@ifdefined@n{MT@tempshape\romannumeral\MT@cnt@shape}%
      \MT@permute@@@@
      \relax
}
\def\MT@permute@@@@@{%
   \MT@permute@define{encoding}%
   \MT@permute@define{family}%
   \MT@permute@define{series}%
   \MT@permute@define{shape}%
   \edef\@tempa{\MT@tempencoding
               /\MT@tempfamily
               /\MT@tempseries
               /\MT@tempshape
               /\MT@ifdefined@c\MT@tempsize *\@empty}%
%    \end{macrocode}
%\changes{v1.2}{2004/09/29}{more sanity checks for \cs{SetProtrusion} and
%                          \cs{SetExpansion}}
% Some sanity checks: An encoding must be specified (unless nothing else is).
%    \begin{macrocode}
   \def\@tempb{////}%
   \ifx\@tempa\@tempb\else
      \ifx\MT@tempencoding\@empty
         \MT@warning{%
            You have to specify an encoding for\MessageBreak
            \@nameuse{MT@abbr@\MT@permutelist} list
            `\@nameuse{MT@\MT@permutelist @name}'.\MessageBreak
            Ignoring it}%
      \else
         \MT@ifdefined@c\MT@tempsize{%
%    \end{macrocode}
% Add the list of ranges to the beginning of the current combination, after
% checking for conflicts.
%\changes{v1.8}{2005/04/20}{add ranges to the beginning of the lists}
%    \begin{macrocode}
            \MT@ifdefined@n{MT@\MT@permutelist @\@tempa @sizes}{%
               \MT@map@tlist@c
                  \MT@tempsize
                  \MT@check@rlist
            }\relax
            \expandafter\MT@xaddb
                  \csname MT@\MT@permutelist @\@tempa @sizes\endcsname
                  \MT@tempsize
%<debug>    \MT@dinfo@nl{1}{initializing: use list for font \@tempa,\MessageBreak
%<debug>          sizes: \csname MT@\MT@permutelist @\@tempa @sizes\endcsname}%
         }{%
%    \end{macrocode}
% Only one list should apply to a given combination.
%    \begin{macrocode}
            \MT@ifdefined@n{MT@\MT@permutelist @\@tempa}{%
               \MT@warning{\@nameuse{MT@abbr@\MT@permutelist} list
                  `\@nameuse{MT@\MT@permutelist @name}' will override list\MessageBreak
                  `\@nameuse{MT@\MT@permutelist @\@tempa}' for font `\@tempa'}%
            }\relax
%<debug>    \MT@dinfo@nl{1}{initializing: use list for font \@tempa}%
         }%
         \global\MT@edef@n{MT@\MT@permutelist @\@tempa}%
               {\csname MT@\MT@permutelist @name\endcsname}%
      \fi
   \fi
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@permute@define}
% Define the commands.
%    \begin{macrocode}
\def\MT@permute@define#1{%
   \expandafter\@tempcnta=\csname MT@cnt@#1\endcsname\relax
   \MT@ifdefined@n{MT@temp#1\romannumeral\@tempcnta}%
      {\MT@edef@n{MT@temp#1}{\csname MT@temp#1\romannumeral\@tempcnta\endcsname}}%
      {\MT@let@nc{MT@temp#1}\@empty}%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@permute@reset}
% Reset the commands.
%    \begin{macrocode}
\def\MT@permute@reset{%
   \MT@permute@reset@{encoding}%
   \MT@permute@reset@{family}%
   \MT@permute@reset@{series}%
   \MT@permute@reset@{shape}%
   \let\MT@tempsize\@undefined
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@permute@reset@}
%    \begin{macrocode}
\def\MT@permute@reset@#1{%
   \@tempcnta=\@ne
   \MT@loop
      \MT@let@nc{MT@temp#1\romannumeral\@tempcnta}\@undefined
      \advance\@tempcnta\@ne
      \MT@ifdefined@n{MT@temp#1\romannumeral\@tempcnta}%
         \@tempswatrue
         \@tempswafalse
      \if@tempswa \MT@repeat
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@check@rlist}
%\changes{v1.8}{2005/04/20}{made recursive}
% For every new range item in \cs{MT@tempsize}, check whether it overlaps with
% ranges in the existing list.
%    \begin{macrocode}
\def\MT@check@rlist#1{%
   \expandafter\MT@check@rlist@#1%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@check@rlist@}
% Define the current new range and \dots
%    \begin{macrocode}
\def\MT@check@rlist@#1#2#3{%
   \def\@tempb{#1}%
   \def\@tempc{#2}%
   \@tempswafalse
   \expandafter\MT@map@tlist@c
      \csname MT@\MT@permutelist @\@tempa @sizes\endcsname
      \MT@check@range
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@check@range}
% \dots~recurse through the list of existing ranges.
%    \begin{macrocode}
\def\MT@check@range#1{%
   \expandafter\MT@check@range@#1%
}
%    \end{macrocode}
%\end{macro}
%\begin{macro}{\MT@check@range@}
% \cmd{\@tempb} and \cmd{\@tempc} are lower resp. upper bound of the new range,
% \meta{\#2} and \meta{\#3} those of the existing range.
%    \begin{macrocode}
\def\MT@check@range@#1#2#3{%
   \MT@ifeq{#2}\m@ne{%
      \MT@ifeq\@tempc\m@ne{%
%    \end{macrocode}
%\begin{itemize}
% \item Both items are simple sizes.
%    \begin{macrocode}
         \MT@ifeq\@tempb{#1}\@tempswatrue\relax
      }{%
%    \end{macrocode}
% \item Item in list is a simple size, new item is a range.
%    \begin{macrocode}
         \MT@ifgt\@tempb{#1}\relax{%
            \MT@ifgt\@tempc{#1}{%
               \@tempswatrue
               \edef\@tempb{#1 (with range: \@tempb\space to \@tempc)}%
            }\relax
         }%
      }%
   }{%
      \MT@ifeq\@tempc\m@ne{%
%    \end{macrocode}
% \item Item in list is a range, new item is a simple size.
%    \begin{macrocode}
         \MT@iflt\@tempb{#2}{%
            \MT@iflt\@tempb{#1}\relax\@tempswatrue
         }\relax
      }{%
%    \end{macrocode}
% \item Both items are ranges.
%    \begin{macrocode}
         \MT@iflt\@tempb{#2}{%
            \MT@ifgt\@tempc{#1}{%
               \@tempswatrue
               \edef\@tempb{#1 to #2 (with range: \@tempb\space to \@tempc)}%
            }\relax
         }\relax
      }%
   }%
   \if@tempswa
      \MT@warning{\@nameuse{MT@abbr@\MT@permutelist} list
         `\@nameuse{MT@\MT@permutelist @name}' will override\MessageBreak
         list `#3' for font \@tempa,\MessageBreak size \@tempb}%
%    \end{macrocode}
% If we've already found a conflict with this item, we can skip the rest of the
% list.
%    \begin{macrocode}
      \expandafter\MT@tlist@break
   \fi
}
%    \end{macrocode}
%\end{itemize}
%\end{macro}
%
%\subsection{User Command}
%
%\begin{macro}{\microtypesetup}
%\changes{v1.4}{2004/11/04}{bug fix: set the correct levels, and remember them;
%                           warning when enabling an option disabled in package options}
%\changes{v1.7}{2005/02/17}{bug fix: warning also when setting to \texttt{(no)compatibility}}
%\begin{macro}{\MT@define@optionX}
% This command may be used anywhere in the document. It accepts the options:
% |protrusion|, |expansion| and |activate|. Specifying font sets is not
% allowed.
%    \begin{macrocode}
\def\microtypesetup{\setkeys{MTX}}
\def\MT@define@optionX#1{%
   \define@key{MTX}{#1}[true]{%
      \KV@@sp@def\@tempb{#1}%
      \MT@map@clist@n{##1}{%
         \KV@@sp@def\MT@val{####1}%
         \edef\@tempb{\csname MT@rbba@\@tempb\endcsname}%
         \MT@ifempty\MT@val\relax{%
            \@tempcnta=\m@ne
            \def\@tempa{false}%
            \ifx\MT@val\@tempa
               \@tempcnta=\z@
               \MT@info{Disabling #1}%
               \let\MT@val\relax
            \fi
%    \end{macrocode}
% Enabling micro-typography in the middle of the document is not allowed if it
% has been disabled in the package options since fonts might already have been
% loaded and hence wouldn't be set up.
%    \begin{macrocode}
            \def\@tempa{true}%
            \ifx\MT@val\@tempa
               \MT@checksetup{\@tempb}%
               \if@tempswa
                  \expandafter\@tempcnta=\csname MT@\@tempb @level\endcsname\relax
                  \MT@info{Enabling #1
                           (level \number\csname MT@\@tempb @level\endcsname)}%
                  \let\MT@val\relax
               \fi
            \fi
            \def\@tempa{compatibility}%
            \ifx\MT@val\@tempa
               \MT@checksetup{\@tempb}%
               \if@tempswa
                  \@tempcnta=\@ne
                  \MT@let@nc{MT@\@tempb @level}\@ne
                  \MT@info{Setting #1 to level 1}%
                  \let\MT@val\relax
               \fi
            \fi
            \def\@tempa{nocompatibility}%
            \ifx\MT@val\@tempa
               \MT@checksetup{\@tempb}%
               \if@tempswa
                  \@tempcnta=\tw@
                  \MT@let@nc{MT@\@tempb @level}\tw@
                  \MT@info{Setting #1 to level 2}%
                  \let\MT@val\relax
               \fi
            \fi
            \ifx\MT@val\relax\else
               \MT@warning{%
                  Value `\MT@val' for key `#1' not recognized.\MessageBreak
                  Use any of `true', `false', `compatibility' or\MessageBreak
                  `nocompatibility'}%
            \fi
            \ifnum\@tempcnta>\m@ne
               \def\@tempa{ex}%
               \ifx\@tempa\@tempb
                  \pdfadjustspacing\@tempcnta
               \else
                  \pdfprotrudechars\@tempcnta
               \fi
            \fi
         }%
      }%
   }%
}
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@checksetup}
% Test whether \opt{protrusion}/\opt{expansion} wasn't disabled in the package
% options.
%    \begin{macrocode}
\def\MT@checksetup#1{%
   \expandafter\csname ifMT@\csname MT@abbr@#1\endcsname\endcsname
      \@tempswatrue
   \else
      \MT@warning{%
         You cannot enable \@nameuse{MT@abbr@#1} if it was disabled\MessageBreak
         in the package options,}%
      \let\MT@val\relax
      \@tempswafalse
   \fi
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@define@optionX{protrusion}
\MT@define@optionX{expansion}
\define@key{MTX}{activate}[]{%
   \setkeys{MTX}{protrusion={#1}}%
   \setkeys{MTX}{expansion={#1}}%
}
%    \end{macrocode}
% Disable everything -- may be used as a work-around in case setting up fonts
% doesn't work in certain environments. \emph{(Undocumented.)}
%    \begin{macrocode}
\def\MT@gobblethree#1#2#3{}
\let\MT@saved@setupfont\MT@setupfont
\define@key{MTX}{disable}[]{%
   \MT@info{Inactivate microtype package}%
   \let\MT@setupfont\MT@gobblethree
}
\define@key{MTX}{enable}[]{%
   \MT@info{Reactivate microtype package}%
   \let\MT@setupfont\MT@saved@setupfont
}
%    \end{macrocode}
%
%\subsection{Package Options}
%
%\subsubsection{Declaring the Options}
%
%\begin{macro}{\ifMT@opt@protrusion}\IndexNewif{MT@opt@protrusion}
%\begin{macro}{\ifMT@opt@expansion}\IndexNewif{MT@opt@expansion}
%\begin{macro}{\ifMT@opt@auto}\IndexNewif{MT@opt@auto}
% Keep track of whether the user explicitly set these options.
%    \begin{macrocode}
\newif\ifMT@opt@protrusion
\newif\ifMT@opt@expansion
\newif\ifMT@opt@auto
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\end{macro}
%\begin{macro}{\MT@define@option}
% \opt{expansion} and \opt{protrusion} may be |true|, |false|, |compatibility|,
% |nocompatibility| and/or a \meta{set name}.
%    \begin{macrocode}
\def\MT@define@option#1{%
   \define@key{MT}{#1}[]{%
      \csname MT@opt@#1true\endcsname
      \MT@map@clist@n{##1}{%
         \KV@@sp@def\MT@val{####1}%
         \MT@ifempty\MT@val\relax{%
            \csname MT@#1true\endcsname
            \edef\@tempb{\csname MT@rbba@#1\endcsname}%
            \def\@tempa{false}%
            \ifx\MT@val\@tempa
               \csname MT@#1false\endcsname
               \let\MT@val\relax
            \fi
            \def\@tempa{compatibility}%
            \ifx\MT@val\@tempa
               \MT@let@nc{MT@\@tempb @level}\@ne
               \let\MT@val\relax
            \fi
            \def\@tempa{nocompatibility}%
            \ifx\MT@val\@tempa
               \MT@let@nc{MT@\@tempb @level}\tw@
               \let\MT@val\relax
            \fi
            \ifx\MT@val\relax\else
               \def\@tempa{true}%
               \ifx\MT@val\@tempa
               \else
%    \end{macrocode}
% If everything failed, it must be a set name.
%    \begin{macrocode}
                  \MT@ifdefined@n{MT@\@tempb @set@@\MT@val}{%
                     \global\MT@edef@n{MT@\@tempb @setname}{\MT@val}%
                     \MT@info@nl{Using #1 set `\MT@val'}%
                  }{%
                     \global\MT@edef@n{MT@\@tempb @setname}%
                        {\@nameuse{MT@default@\@tempb @set}}%
                     \MT@warning@nl{%
                        The #1 set `\MT@val' is undeclared.\MessageBreak
                        Using set `\@nameuse{MT@\@tempb @setname}' instead}%
                  }%
               \fi
            \fi
         }%
      }%
   }%
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@define@option{protrusion}
\MT@define@option{expansion}
%    \end{macrocode}
% \opt{activate} is a shortcut.
%    \begin{macrocode}
\define@key{MT}{activate}[]{%
   \setkeys{MT}{protrusion={#1}}%
   \setkeys{MT}{expansion={#1}}%
}
%    \end{macrocode}
%\changes{v1.5}{2004/12/02}{new option: \opt{selected}, by default false
%                           (suggested by \thanh)} ^^A <hanthethanh\at gmx.net>
%                                                  ^^A private mail, 30/11/2004
%\begin{macro}{\MT@def@bool@opt}
% The |true|/|false| options:
% \opt{draft} (may be inherited from the class options),
% \opt{DVIoutput},
% \opt{auto},
% \opt{selected}.
%    \begin{macrocode}
\def\MT@def@bool@opt#1{%
   \define@key{MT}{#1}[]{%
      \MT@ifempty{##1}%
         {\def\@tempa{true}}%
         {\def\@tempa{##1}}%
      \def\@tempb{true}%
      \ifx\@tempa\@tempb \else
         \def\@tempb{false}%
         \ifx\@tempa\@tempb \else
            \MT@warning@nl{%
               `##1' is not an admissible value for option\MessageBreak
               `#1'. Assuming `false'}%
         \fi
      \fi
      \csname MT@#1\@tempb\endcsname
   }%
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@map@tlist@n{{draft}{DVIoutput}{auto}{selected}}\MT@def@bool@opt
%    \end{macrocode}
% \opt{final} is the opposite to \opt{draft}.
%\changes{v1.4a}{2004/11/16}{new option: \opt{final}}
%    \begin{macrocode}
\define@key{MT}{final}[]{%
   \MT@draftfalse
   \MT@ifempty{#1}%
      {\def\@tempa{true}}%
      {\def\@tempa{#1}}%
   \def\@tempb{true}%
   \ifx\@tempa\@tempb
   \else
      \def\@tempb{false}%
      \ifx\@tempa\@tempb
         \MT@drafttrue
      \else
         \MT@warning@nl{%
            `#1' is not an admissible value for option\MessageBreak
            `final'. Assuming `true'}%
      \fi
   \fi
}
%    \end{macrocode}
% For \opt{verbose} output, we simply redefine \cs{MT@vinfo}.
%    \begin{macrocode}
\define@key{MT}{verbose}[]{%
   \let\MT@vinfo\MT@info@nl
   \MT@ifempty{#1}%
      {\def\@tempa{true}}%
      {\def\@tempa{#1}}%
   \def\@tempb{true}%
   \ifx\@tempa\@tempb \else
%    \end{macrocode}
%\changes{v1.7}{2005/03/16}{new value for \opt{verbose} option: \texttt{errors}}
% Take problems seriously.
%    \begin{macrocode}
      \def\@tempb{errors}%
      \ifx\@tempa\@tempb
         \let\MT@warning\MT@warn@err
         \let\MT@warning@nl\MT@warn@err
      \else
         \let\MT@vinfo\@gobble
         \def\@tempb{false}%
         \ifx\@tempa\@tempb \else
            \MT@warning@nl{%
               `#1' is not an admissible value for option\MessageBreak
               `verbose'. Assuming `false'}%
         \fi
      \fi
   \fi
}
%    \end{macrocode}
%\changes{v1.5}{2004/12/02}{defaults: \opt{step}: 4
%                           (suggested by \thanh)} ^^A <hanthethanh\at gmx.net>
%                                                  ^^A private mail, 30/11/2004
%\changes{v1.6}{2004/12/18}{new option: \opt{factor}, by default 1000}
%\begin{macro}{\MT@def@num@opt}
% Options with numerical keys:
% \opt{factor},
% \opt{stretch},
% \opt{shrink},
% \opt{step}.
%    \begin{macrocode}
\def\MT@def@num@opt#1{%
   \define@key{MT}{#1}[]{%
      \MT@ifempty{##1}%
         {\MT@let@cn\@tempa{MT@#1@default}}%
         {\def\@tempa{##1 }}%
%    \end{macrocode}
% No nonsense in \cs{MT@factor} et al.?
%\changes{v1.6}{2005/01/06}{test whether numeric options receive a number}
% A space terminates the number.
%    \begin{macrocode}
      \MT@ifnumber\@tempa{%
         \MT@edef@n{MT@#1}{\@tempa}%
      }{%
         \MT@warning@nl{%
            Value `##1' for option `#1' is not a number.\MessageBreak
            Using default value of \number\@nameuse{MT@#1@default}}%
      }%
   }%
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@map@tlist@n{{factor}{stretch}{shrink}{step}}\MT@def@num@opt
%    \end{macrocode}
% Unit for protrusion factors.
%\changes{v1.8}{2005/04/14}{new option: \opt{unit}, by default \texttt{relative}}
%    \begin{macrocode}
\define@key{MT}{unit}[]{%
   \MT@ifempty{#1}%
      {\def\@tempa{relative}}%
      {\KV@@sp@def\@tempa{#1}}%
   \def\@tempb{relative}%
   \ifx\@tempa\@tempb \else
      \setbox\z@=\hbox{\MT@count=1\@tempa\relax
         \ifnum\MT@count=\@ne
            \@tempswafalse
         \else
            \@tempswatrue
         \fi\expandafter}%
      \if@tempswa
         \let\MT@pr@unit\@tempa
      \else
         \MT@warning@nl{`\@tempa' is not a dimension. Ignoring it and\MessageBreak
            setting values relative to character widths}%
      \fi
   \fi
}
%    \end{macrocode}
% The package should just work if called without any options. Therefore,
% expansion will be switched off by default if output is \dvi, since it isn't
% likely that expanded fonts are available. (This grows more important as \TeX\
% systems are switching to the \pdftex\ engine even for \dvi\ output, so that
% the user might not even be aware of the fact that she's running \pdftex.)
%    \begin{macrocode}
\MT@protrusiontrue
\ifnum\pdfoutput=\z@\else
%    \end{macrocode}
% Also, we only enable expansion by default if \pdftex\ can expand the fonts
% automatically.
%\changes{v1.6}{2004/12/23}{defaults: turn off expansion for old \pdftex\ versions}
%    \begin{macrocode}
   \ifnum\MT@pdftex@no > \thr@@
      \MT@expansiontrue
      \MT@autotrue
   \fi
\fi
%    \end{macrocode}
% The main configuration file will be loaded before processing the package
% options.
%\changes{v1.8}{2005/05/15}{new option: \opt{config} to load a different main
%                           configuration file}
%\begin{macro}{\MT@config@file}
%\begin{macro}{\MT@get@config}
% However, the \opt{config} option must of course be evaluated beforehand.
% We also have to define a no-op for the regular option processing later.
%    \begin{macrocode}
\define@key{MT}{config}[]{\relax}
\def\MT@get@config#1config=#2,#3\@nil{%
   \MT@ifempty{#2}%
      {\def\MT@config@file{microtype.cfg}}%
      {\KV@@sp@def\MT@config@file{#2.cfg}}%
}
\expandafter\expandafter\expandafter\MT@get@config
   \csname opt@\@currname.\@currext\endcsname,config=,\@nil
%    \end{macrocode}
%\end{macro}
%\end{macro}
%\changes{v1.4b}{2004/11/25}{bug fix: set catcodes before reading global configuration file
%                           (reported by Christoph Bier)} ^^A <christoph.bier\at web.de>
%                                            ^^A in: <MID:30k2tqF30v483U1@uni-berlin.de>
% Load the file.
%    \begin{macrocode}
\IfFileExists{\MT@config@file}{%
   \MT@info@nl{Loading configuration file \MT@config@file}%
   \MT@begin@catcodes
   \let\MT@begin@catcodes\relax
   \let\MT@end@catcodes\relax
   \input{\MT@config@file}%
   \endgroup
}{%
   \MT@warning@nl{%
      Could not find configuration file `\MT@config@file'!\MessageBreak
      This will almost certainly cause undesired results.\MessageBreak
      Please fix your installation}%
}
%    \end{macrocode}
% If no default font set has been declared in the main configuration file,
% we use the (empty, possibly non-existent) `|all|' set.
%    \begin{macrocode}
\MT@ifdefined@c\MT@default@pr@set\relax{\gdef\MT@default@pr@set{all}}
\MT@ifdefined@c\MT@default@ex@set\relax{\gdef\MT@default@ex@set{all}}
%    \end{macrocode}
%
%
%\subsubsection{Hook for Other Packages}\label{sub:hook}
%\makeatletter
% {\let\special@index\index\SpecialIndex@{\Microtype@Hook}{\encapchar usage}}
%\makeatother
%
%\begin{macro}{\Microtype@Hook}
%\changes{v1.7}{2005/03/22}{new macro for font package authors}
% This hook may be used by font package authors, \eg\ to declare alias fonts.
% If it is defined, it will be executed here, \ie, after the main
% configuration file has been loaded, and before the package options are
% evaluated.
%
% This hook overcomes the situation that (1) the \microtype\ package should be
% loaded after all font defaults have been set up (hence, using
% \cmd{\@ifpackageloaded} in the font package is not viable), and (2) checking
% \cmd{\AtBeginDocument} might be too late, since fonts might already have been
% loaded, and consequently set up, in the preamble.
%
% Package authors should check whether the command is already defined so that
% existing definitions by other packages aren't overwritten. Example:
%
%\begin{verbatim}
%\def\MinionPro@MT@Hook
%   {\DeclareMicrotypeAlias{MinionPro-LF}{MinionPro}}
%\@ifundefined{Microtype@Hook}
%   {\let\Microtype@Hook\MinionPro@MT@Hook}
%   {\g@addto@macro\Microtype@Hook{\MinionPro@MT@Hook}}
%\end{verbatim}
%
% \cs{MicroType@Hook} with a capital |T| is provided for compatibility reasons.
% At some point in the future, it will no longer be available, hence it should
% not be used.
%
%    \begin{macrocode}
\MT@ifdefined@c\MicroType@Hook\MicroType@Hook\relax
\MT@ifdefined@c\Microtype@Hook\Microtype@Hook\relax
%    \end{macrocode}
%\end{macro}
%
%
%\subsubsection{Processing the Options}
%
%\begin{macro}{\MT@ProcessOptionsWithKV}
% Parse options.
%    \begin{macrocode}
\def\MT@ProcessOptionsWithKV#1{%
   \let\@tempc\relax
   \let\KVo@tempa\@empty
   \MT@map@clist@c\@classoptionslist{%
      \def\CurrentOption{##1}%
      \MT@ifdefined@n{KV@#1@\CurrentOption}{%
         \edef\KVo@tempa{\KVo@tempa,\CurrentOption,}%
         \@expandtwoargs\@removeelement\CurrentOption
            \@unusedoptionlist\@unusedoptionlist
      }\relax
   }%
   \edef\KVo@tempa{%
      \noexpand\setkeys{#1}{%
         \KVo@tempa\@ptionlist{\@currname.\@currext}%
      }%
   }%
   \KVo@tempa
   \AtEndOfPackage{\let\@unprocessedoptions\relax}%
   \let\CurrentOption\@empty
}
%    \end{macrocode}
%\end{macro}
%    \begin{macrocode}
\MT@ProcessOptionsWithKV{MT}
%    \end{macrocode}
% Now we can take the appropriate actions:
%
% \pdftex\ can create \dvi\ output, too. However, both the \dvi\ viewer and
% dvips need to find actual fonts. Therefore, expansion will only work if the
% fonts for different degrees of expansion are readily available.
%
%\changes{v1.4b}{2004/11/19}{new message if \cmd{\pdfoutput} is changed}
% Some packages depend on the value of \cmd{\pdfoutput} and will get confused if
% it is changed after they have been loaded. These packages are, among others:
% \pkg{color}, \pkg{graphics}, \pkg{hyperref}, \pkg{crop}, \pkg{contour},
% \pkg{pstricks} and of course \pkg{ifpdf}. Instead of testing for each package
% (that's not our job), we issue a different message if \cmd{\pdfoutput} is
% actually changed by \opt{DVIoutput}. That must be sufficient!
%    \begin{macrocode}
\ifMT@DVIoutput
   \ifnum\pdfoutput=\z@
      \MT@info@nl{Generating DVI output}
   \else
      \pdfoutput\z@
      \MT@info@nl{Changing output mode to DVI}
%    \end{macrocode}
% For \dvi\ output, the user must have explicitly passed the \opt{expansion} option
% to the package.
%\changes{v1.5}{2004/12/02}{defaults: turn off expansion for \dvi\ output}
%    \begin{macrocode}
      \ifMT@opt@expansion\else
         \MT@expansionfalse
      \fi
   \fi
\else
   \MT@info@nl{Generating \ifnum\pdfoutput=\z@ DVI \else PDF \fi output}
\fi
%    \end{macrocode}
% Tell the log file which options the user has chosen (in case it's interested).
% We disable most of what we've just defined in the \arabic{CodelineNo} lines
% above if we are running in draft mode.
%\changes{v1.7}{2005/02/06}{warning when running in draft mode}
%    \begin{macrocode}
\ifMT@draft
   \MT@warning@nl{`draft' option active.\MessageBreak
                  Disabling all micro-typographic features}
   \MT@protrusionfalse
   \MT@expansionfalse
   \let\MT@setupfont\relax
   \def\DeclareMicrotypeSet{%
      \@ifstar
         {\@ifnextchar[\MT@DeclareSet{\MT@DeclareSet[]}}%
         {\@ifnextchar[\MT@DeclareSet{\MT@DeclareSet[]}}%
   }
   \def\MT@DeclareSet[#1]#2#3{}
   \renewcommand*\UseMicrotypeSet[2][]{}
   \renewcommand*\DeclareMicrotypeSetDefault[2][]{}
   \renewcommand*\SetProtrusion[3][]{}
   \renewcommand*\SetExpansion[3][]{}
   \renewcommand*\DeclareCharacterInheritance[3][]{}
   \renewcommand*\DeclareMicrotypeAlias[2]{}
   \renewcommand*\LoadMicrotypeFile[1]{}
   \renewcommand*\microtypesetup[1]{}
\else
   \ifMT@protrusion
      \MT@info@nl{Character protrusion enabled (level \number\MT@pr@level)%
         \ifnum\MT@factor=\MT@factor@default \else,\MessageBreak factor: \number\MT@factor\fi
         \ifx\MT@pr@unit\@empty \else,\MessageBreak unit: \MT@pr@unit\fi}
%    \end{macrocode}
% We have to make sure that font sets are active at the end of the package. If
% the user didn't activate any in the package options, we use those set declared
% by \cs{DeclareMicrotypeSetDefault}. They can still be overridden later on, of
% course.
%    \begin{macrocode}
      \MT@ifdefined@c\MT@pr@setname\relax{%
         \global\let\MT@pr@setname\MT@default@pr@set
         \MT@info@nl{Using default protrusion set `\MT@pr@setname'}%
      }
   \else
      \MT@info@nl{No character protrusion}
   \fi
   \ifMT@expansion
%    \end{macrocode}
% Set up the values for font expansion: If \opt{stretch} has not been specified, we
% take the default value of 20.
%    \begin{macrocode}
      \ifnum\MT@stretch=\m@ne
         \let\MT@stretch\MT@stretch@default
      \fi
%    \end{macrocode}
% If \opt{shrink} has not been specified, it will inherit the value from \opt{stretch}.
%    \begin{macrocode}
      \ifnum\MT@shrink=\m@ne
         \ifnum\MT@stretch>\z@
            \let\MT@shrink\MT@stretch
         \else
            \let\MT@shrink\MT@shrink@default
         \fi
      \fi
%    \end{macrocode}
% If \opt{step} has not been specified, we will set it to min(\opt{stretch},\opt{shrink})/5,
% rounded off, minimum value 1.
%\changes{v1.5}{2004/12/02}{defaults: calculate \opt{step} as
%                           min(\texttt{stretch},\texttt{shrink})/5}
%    \begin{macrocode}
      \ifnum\MT@step=\m@ne
         \ifnum\MT@stretch>\MT@shrink
            \ifnum\MT@shrink=\z@
               \@tempcnta=\MT@stretch
            \else
               \@tempcnta=\MT@shrink
            \fi
         \else
            \ifnum\MT@stretch=\z@
               \@tempcnta=\MT@shrink
            \else
               \@tempcnta=\MT@stretch
            \fi
         \fi
         \divide\@tempcnta 5\relax
      \else
         \@tempcnta=\MT@step
      \fi
      \ifnum\@tempcnta=\z@ \@tempcnta=\@ne \fi
      \edef\MT@step{\number\@tempcnta\space}
%    \end{macrocode}
%\begin{macro}{\MT@auto}
% Automatic expansion of the font? This new feature of \pdftex\ 1.20 makes the
% \textit{hz}-algorithm really usable. It must be either `|autoexpand|' or
% empty (or `|1000|' for older versions of \pdftex).
%    \begin{macrocode}
      \let\MT@auto\@empty
      \ifMT@auto
         \ifnum\MT@pdftex@no > \thr@@
%    \end{macrocode}
%\end{macro}
% We turn off automatic expansion if output mode is \dvi.
%\changes{v1.5}{2004/12/02}{disable automatic expansion for \dvi\ output}
%    \begin{macrocode}
            \ifnum\pdfoutput=\z@
               \ifMT@opt@auto
                  \MT@warning@nl{%
                     Automatic font expansion only works for PDF output.\MessageBreak
                     However, you are creating a DVI file. I will switch\MessageBreak
                     automatic font expansion off and hope that expanded\MessageBreak
                     fonts are available}
               \fi
               \MT@autofalse
            \else
               \def\MT@auto{autoexpand}
            \fi
%    \end{macrocode}
% Also, if \pdftex\ is too old.
%\changes{v1.1}{2004/09/13}{issue an error instead of a warning, when \pdftex\
%                            version is too old for \texttt{autoexpand}}
%\changes{v1.6}{2004/12/23}{disable automatic expansion for old \pdftex\ versions}
%    \begin{macrocode}
         \else
            \ifMT@opt@auto
               \MT@warning@nl{%
                  The pdftex you are using is too old for automatic\MessageBreak
                  font expansion. I will switch it off and hope that\MessageBreak
                  expanded fonts are available on your system.\MessageBreak
                  Install pdftex version 1.20 or newer}
            \fi
            \MT@autofalse
            \def\MT@auto{1000 }
         \fi
%    \end{macrocode}
% No automatic expansion.
%    \begin{macrocode}
      \else
         \ifnum\MT@pdftex@no < 4
            \def\MT@auto{1000 }
         \fi
      \fi
%    \end{macrocode}
% Choose the appropriate macro for selected expansion.
%    \begin{macrocode}
      \ifMT@selected
         \let\MT@set@ex@codes\MT@set@ex@codes@s
      \else
         \let\MT@set@ex@codes\MT@set@ex@codes@n
      \fi
%    \end{macrocode}
% Info.
%    \begin{macrocode}
      \MT@info@nl{\ifMT@auto Automatic f\else F\fi ont expansion enabled
                  (level \number\MT@ex@level),\MessageBreak
                  stretch: \number\MT@stretch, shrink: \number\MT@shrink,
                  step: \number\MT@step, \ifMT@selected\else non-\fi selected}
      \MT@ifdefined@c\MT@ex@setname\relax{%
         \global\let\MT@ex@setname\MT@default@ex@set
         \MT@info@nl{Using default expansion set `\MT@ex@setname'}%
      }
   \else
      \MT@info@nl{No font expansion}
   \fi
\fi
%    \end{macrocode}
% Finally, we enable the micro-typographic extensions, or we don't.
%    \begin{macrocode}
\ifMT@protrusion
   \pdfprotrudechars\MT@pr@level
\fi
\ifMT@expansion
   \pdfadjustspacing\MT@ex@level
%    \end{macrocode}
%\changes{v1.7}{2005/03/02}{modify \cmd{\showhyphens}}
% Inside \cmd{\showhyphens}, font expansion should be disabled.
%    \begin{macrocode}
   \CheckCommand*{\showhyphens}[1]{%
      \setbox0\vbox{\color@begingroup\everypar{}\parfillskip\z@skip
      \hsize\maxdimen\normalfont\pretolerance\m@ne\tolerance\m@ne
      \hbadness\z@\showboxdepth\z@\ #1\color@endgroup}}
%    \end{macrocode}
%\begin{macro}{\showhyphens}
% I wonder why it's defined globally (in \file{ltfssbas.dtx})?
%    \begin{macrocode}
   \gdef\showhyphens#1{%
      \setbox0\vbox{%
         \color@begingroup
         \pdfadjustspacing\z@
         \everypar{}%
         \parfillskip\z@skip\hsize\maxdimen
         \normalfont
         \pretolerance\m@ne\tolerance\m@ne\hbadness\z@\showboxdepth\z@\ #1%
         \color@endgroup}}
\fi
%</package>
%    \end{macrocode}
%\end{macro}
% That was that.
%
% ^^A -------------------------------------------------------------------------
% ^^A From now on, don't bother indexing:
%\NoIndexing
%
%\section{Configuration Files}
%\changes{v1.6}{2005/01/24}{restructure \file{dtx} file}
%
% Let's now write the font configuration files.
%    \begin{macrocode}
%<*config>

%    \end{macrocode}
% The following characters must not appear verbatim:
%
%\begin{tabular}{l@{\quad:\quad}l}
% |\| & \cmd{\textbackslash}\\
% |{| & \cmd{\textbraceleft}\\
% |}| & \cmd{\textbraceright}\\
% |^| & \cmd{\textasciicircum}\\
% |%| & \cs{\%}\\
% |#| & \cs{\#}
%\end{tabular}
%
%\noindent
% Comma and equal sign must be guarded with braces (`|{,}|', `|{=}|').
% Of course, numerical identification is possible in any case.
% Ligatures and \cmd{\mathchardef}ed symbols always have to be specified
% numerically.
%
%\subsection{Character Inheritance}
%
% First the lists of inheriting characters. We only declare those characters
% that are the same on \emph{both} sides, \ie, not \OE\ for O.
%\changes{v1.1}{2004/09/14}{remove 8-bit characters from the configuration files
%                           (suggested by Harald Harders)}
%    \begin{macrocode}
%<*m-t>
%%% ----------------------------------------------------------------------
%%% CHARACTER INHERITANCE

%    \end{macrocode}
%
%\subsubsection{\otI}
% Glyphs that should possibly inherit settings on one side only:
% |012|~(`fi' ligature), |013|~(`fl'), |014|~(`ffi'), |015|~(`ffl'),
% \AE, \ae, \OE, \oe.
%    \begin{macrocode}
\DeclareCharacterInheritance
   { encoding = OT1 }
   { f = {011}, % ff
     i = {\i},
     j = {\j},
     O = {\O},
     o = {\o},
   }

%    \end{macrocode}
%
%\subsubsection{\tI}
% Candidates here: |028|~(`fi'), |029|~(`fl'), |030|~(`ffi'), |031|~(`ffl'),
% |156| (`IJ'~ligature), |188|~(`ij'), \AE, \ae, \OE, \oe.
%\changes{v1.5}{2004/12/11}{inheritance: remove \cmd{\ss} from \tI\ list,
%                           add \cmd{\DJ}}
%\changes{v1.8}{2005/04/26}{inheritance: remove \cmd{\DJ} from \tI\ list
%                           (it's the same as \cmd{\DH})}
%    \begin{macrocode}
\DeclareCharacterInheritance
   { encoding = T1 }
   { A = {\`A,\'A,\^A,\~A,\"A,\r{A},\k{A},\u{A}},
     a = {\`a,\'a,\^a,\~a,\"a,\r{a},\k{a},\u{a}},
     C = {\'C,\c{C},\v{C}},
     c = {\'c,\c{c},\v{c}},
     D = {\v{D},\DH},
     d = {\v{d},\dj},
     E = {\`E,\'E,\^E,\"E,\k{E},\v{E}},
     e = {\`e,\'e,\^e,\"e,\k{e},\v{e}},
     f = {027}, % ff
     G = {\u{G}},
     g = {\u{g}},
     I = {\`I,\'I,\^I,\"I,\.I},
     i = {\`i,\'i,\^i,\"i,\i},
     j = {\j},
     L = {\L,\'L,\v{L}},
     l = {\l,\'l,\v{l}},
     N = {\'N,\~N,\v{N}},
     n = {\'n,\~n,\v{n}},
     O = {\O,\`O,\'O,\^O,\~O,\"O,\H{O}},
     o = {\o,\`o,\'o,\^o,\~o,\"o,\H{o}},
     R = {\'R,\v{R}},
     r = {\'r,\v{r}},
     S = {\'S,\c{S},\v{S},\SS},
     s = {\'s,\c{s},\v{s}},
     T = {\c{T},\v{T}},
     t = {\c{t},\v{t}},
     U = {\`U,\'U,\^U,\"U,\H{U},\r{U}},
     u = {\`u,\'u,\^u,\"u,\H{u},\r{u}},
     Y = {\'Y,\"Y},
     y = {\'y,\"y},
     Z = {\'Z,\.Z,\v{Z}},
     z = {\'z,\.z,\v{z}},
     - = {127},
   }

%    \end{macrocode}
%
%\subsubsection{\lyI}
% More characters: |008|~(`fl'), |012|~(`fi'), |014|~(`ffi'), |015|~(`ffl'),
% \AE, \ae, \OE, \oe.
%    \begin{macrocode}
\DeclareCharacterInheritance
   { encoding = LY1 }
   { A = {\`A,\'A,\^A,\~A,\"A,\r{A}},
     a = {\`a,\'a,\^a,\~a,\"a,\r{a}},
     C = {\c{C}},
     c = {\c{c}},
     D = {\DH},
     E = {\`E,\'E,\^E,\"E},
     e = {\`e,\'e,\^e,\"e},
     f = {011}, % ff
     I = {\`I,\'I,\^I,\"I},
     i = {\`i,\'i,\^i,\"i,\i},
     L = {\L},
     l = {\l},
     N = {\~N},
     n = {\~n},
     O = {\`O,\'O,\^O,\~O,\"O,\O},
     o = {\`o,\'o,\^o,\~o,\"o,\o},
     S = {\v{S}},
     s = {\v{s}},
     U = {\`U,\'U,\^U,\"U},
     u = {\`u,\'u,\^u,\"u},
     Y = {\'Y,\"Y},
     y = {\'y,\"y},
     Z = {\v{Z}},
     z = {\v{z}},
   }

%</m-t>
%    \end{macrocode}
%
%\subsection{Font Expansion}
%
% These are \thanh's original expansion settings. They are used for all fonts
% (until somebody shows mercy and creates font-specific settings).
%    \begin{macrocode}
%<*m-t>
%%% ----------------------------------------------------------------------
%%% EXPANSION SETTINGS

\SetExpansion
%<m-t>   [ name     = default      ]
%<bch>   [ name     = bch-default  ]
%<cmr>   [ name     = cmr-default  ]
%<pad>   [ name     = pad-default  ]
%<pmn>   [ name     = pmn-default  ]
%<ppl>   [ name     = ppl-default  ]
%<ptm>   [ name     = ptm-default  ]
%<m-t>   { encoding = {OT1,T1,LY1} }
%<!m-t>   { encoding = {OT1,T1,LY1},
%<bch>     family   = bch }
%<cmr>     family   = cmr }
%<pad>     family   = {pad,padx,padj} }
%<pmn>     family   = {pmn,pmnx,pmnj} }
%<ppl>     family   = {ppl,pplx,pplj} }
%<ptm>     family   = {ptm,ptmx,ptmj} }
   {
     A = 500,     a = 700,
   \AE = 500,   \ae = 700,
     B = 700,     b = 700,
     C = 700,     c = 700,
     D = 500,     d = 700,
     E = 700,     e = 700,
     F = 700,
     G = 500,     g = 700,
     H = 700,     h = 700,
     K = 700,     k = 700,
     M = 700,     m = 700,
     N = 700,     n = 700,
     O = 500,     o = 700,
   \OE = 500,   \oe = 700,
     P = 700,     p = 700,
     Q = 500,     q = 700,
     R = 700,
     S = 700,     s = 700,
     U = 700,     u = 700,
     W = 700,     w = 700,
     Z = 700,     z = 700,
     2 = 700,
     3 = 700,
     6 = 700,
     8 = 700,
     9 = 700,
   }

%</m-t>
%    \end{macrocode}
%
%\subsection{Character Protrusion}
%
%\changes{v1.1}{2004/09/14}{protrusion: add factors for some more characters}
%\changes{v1.4b}{2004/11/19}{protrusion: harmonize dashes in upshape and italic
%                           (\texttt{cmr}, \texttt{pad}, \texttt{ppl})}
%
% For future historians, \thanh's original settings (from \file{protcode.tex},
% converted to \microtype\ notation).
%    \begin{macrocode}
%%% ----------------------------------------------------------------------
%%% PROTRUSION SETTINGS

%\SetProtrusion
%   [ name     = thanh ]
%   { encoding = OT1 }
%   {
%     A = {50,50},
%     F = {  ,50},
%     J = {50,  },
%     K = {  ,50},
%     L = {  ,50},
%     T = {50,50},
%     V = {50,50},
%     W = {50,50},
%     X = {50,50},
%     Y = {50,50},
%     k = {  ,50},
%     r = {  ,50},
%     t = {  ,50},
%     v = {50,50},
%     w = {50,50},
%     x = {50,50},
%     y = {50,50},
%     . = { ,700},    {,}= { ,700},
%     : = { ,500},     ; = { ,500},
%     ! = { ,200},     ? = { ,200},
%     ( = {50,  },     ) = {  ,50},
%     - = { ,700},
%     \textendash        = { ,300},     \textemdash        = { ,200},
%     \textquoteleft     = {700, },     \textquoteright    = { ,700},
%     \textquotedblleft  = {500, },     \textquotedblright = { ,500},
%   }
%
%    \end{macrocode}
% We also create configuration files for the fonts
%\changes{v1.5}{2004/11/28}{protrusion: settings for Bitstream Charter}
% Bitstream Charter (\nfss\ code |bch|),
% Computer Modern Roman (|cmr|),
% Palatino (|ppl|, |pplx|, |pplj|),
% Times (|ptm|, |ptmx|, |ptmj|),
% Adobe Garamond (|pad|, |padx|, |padj|) and
%\changes{v1.1}{2004/09/14}{protrusion: settings for Adobe Minion
%                           (contributed by Harald Harders)}
% Minion\footnote{
%     Contributed by Harald Harders (\mailto{h.harders@tu-bs.de})}
% (|pmnx|, |pmnj|),
%\changes{v1.8}{2005/06/01}{protrusion: settings for \ams\ math fonts}
% and for the \ams\ math fonts (|msa|, |msb|, |euf|, |eus|).
%
%\subsubsection{Default}
%
% The default settings always use the most moderate value.
%    \begin{macrocode}
%<*!cfg-u>
\SetProtrusion
%<m-t>   [ name     = default ]
%<bch>   [ name     = bch-default ]
%<cmr>   [ name     = cmr-default ]
%<pad>   [ name     = pad-default ]
%<pmn>   [ name     = pmnj-default ]
%<ppl>   [ name     = ppl-default ]
%<ptm>   [ name     = ptm-default ]
%<m-t>   { encoding = OT1     }
%<!m-t>   { encoding = OT1,
%<bch>     family   = bch }
%<cmr>     family   = cmr }
%<pad>     family   = {pad,padx,padj} }
%<pmn>     family   = pmnj }
%<ppl>     family   = {ppl,pplx,pplj} }
%<ptm>     family   = {ptm,ptmx,ptmj} }
   {
     A = {50,50},
%<m-t|cmr|pad|ptm>   \AE = {50,  },
%<bch|pad|pmn>     C = {50,  },
%<bch|pad|pmn>     D = {  ,50},
%<m-t|bch|cmr|pad|pmn|ptm>     F = {  ,50},
%<bch|pad|pmn>     G = {50,  },
%<m-t|cmr|pad|pmn|ppl|ptm>     J = {50,  },
%<bch>     J = {100,  },
     K = {  ,50},
%<m-t|bch|cmr|pad|pmn|ppl>     L = {  ,50},
%<ptm>     L = {  ,80},
%<bch|pad|pmn>     O = {50,50},
%<bch|pad|pmn>   \OE = {50,  },
%<bch|pad|pmn>     Q = {50,70},
%<bch>     R = {  ,50},
     T = {50,50},
     V = {50,50},
     W = {50,50},
     X = {50,50},
%<m-t|bch|cmr|pad|pmn|ppl>     Y = {50,50},
%<ptm>     Y = {80,80},
     k = {  ,50},
%<pmn>     l = {  ,-50},
%<pad|ppl>     p = {50,50},
%<pad|ppl>     q = {50,  },
     r = {  ,50},
%<cmr|pad|pmn>     t = {  ,70},
%<bch>     t = {  ,50},
     v = {50,50},
     w = {50,50},
     x = {50,50},
%<m-t|bch|pad|pmn>     y = {  ,50},
%<cmr|ppl|ptm>     y = {50,70},
%    \end{macrocode}
%\changes{v1.6}{2005/01/11}{protrusion: improve settings for numbers
%                          (pointed out by Peter Muthesius)} ^^A <newsname\at gmx.de>
%                                        ^^A in: <MID:34b1h7F48s44tU1@individual.net>
%    \begin{macrocode}
%<cmr>     0 = {  ,50},
%<m-t>     1 = {50,50},
%<bch|pad|ptm>     1 = {150,150},
%<cmr>     1 = {100,200},
%<pmn>     1 = {  ,50},
%<ppl>     1 = {100,100},
%<bch|cmr|pad>     2 = {50,50},
%<cmr|pad>     3 = {50,50},
%<bch|pmn>     3 = {50,  },
%<m-t|pad>     4 = {50,50},
%<bch>     4 = {100,50},
%<cmr>     4 = {70,70},
%<pmn>     4 = {50,  },
%<ptm>     4 = {70,  },
%<cmr>     5 = {  ,50},
%<pad>     5 = {50,50},
%<bch>     6 = {50,  },
%<cmr>     6 = {  ,50},
%<pad>     6 = {50,50},
%<m-t>     7 = {50,50},
%<bch|pad|pmn>     7 = {50,80},
%<cmr|ptm>     7 = {50,100},
%<ppl>     7 = { ,50},
%<cmr>     8 = {  ,50},
%<bch|pad>     9 = {50,50},
%<cmr>     9 = {  ,50},
%<m-t|cmr|pad|pmn|ppl|ptm>     . = { ,700},
%<bch>     . = { ,600},
    {,}= { ,500},
%<m-t|cmr|pad|pmn|ppl|ptm>     : = { ,500},
%<bch>     : = { ,400},
%<m-t|bch|pad|pmn|ptm>     ; = { ,300},
%<cmr|ppl>     ; = { ,500},
     ! = { ,100},
%<m-t|pad|pmn|ptm>     ? = { ,100},
%<bch|cmr|ppl>     ? = { ,200},
%<pmn>     " = {300,300},
%<m-t|bch|cmr|pad|pmn|ppl>     @ = {50,50},
%<ptm>     @ = {100,100},
     ~ = {200,250},
%<m-t|bch|pad|pmn|ppl|ptm>     _ = {100,100},
%<cmr>     _ = {200,200},
%<pad|ppl|ptm>     & = {50,100},
%<m-t|cmr|pad|pmn>    \% = {50,50},
%<bch>    \% = {  ,50},
%<ppl|ptm>    \% = {100,100},
%<m-t|ppl|ptm>     * = {200,200},
%<bch|pmn>     * = {200,300},
%<cmr|pad>     * = {300,300},
%<m-t|cmr|ppl|ptm>     + = {250,250},
%<bch>     + = {150,250},
%<pad>     + = {300,300},
%<pmn>     + = {150,200},
%<m-t|pad|pmn|ptm>     ( = {100,   },    ) = {   ,200},
%<bch>     ( = {200,   },    ) = {   ,200},
%<cmr|ppl>     ( = {100,   },    ) = {   ,300},
%<bch|pmn>     [ = {100,   },    ] = {   ,100},
%    \end{macrocode}
%\changes{v1.7}{2005/03/15}{protrusion: fix: remove \textbackslash\ from \otI,
%                           add \cmd{\textbackslash} to \tI\ encoding}
%    \begin{macrocode}
%<m-t|pad|pmn|ptm>     / = {100,200},
%<bch>     / = { ,200},
%<cmr|ppl>     / = {200,300},
%<m-t|ptm>     - = {500,500},
%<bch|cmr|ppl>     - = {400,500},
%<pad>     - = {300,500},
%<pmn>     - = {200,400},
%<m-t|pmn>     \textendash       = {200,200},   \textemdash        = {150,150},
%<bch>     \textendash       = {200,300},   \textemdash        = {150,250},
%<cmr>     \textendash       = {400,300},   \textemdash        = {300,200},
%<pad|ppl|ptm>     \textendash       = {300,300},   \textemdash        = {200,200},
%    \end{macrocode}
% Why settings for left \emph{and} right quotes? Because in some languages they
% might be used like that (see the \pkg{csquotes} package for examples).
%    \begin{macrocode}
%<m-t|bch|pmn>     \textquoteleft    = {300,400},   \textquoteright    = {300,400},
%<cmr>     \textquoteleft    = {500,700},   \textquoteright    = {500,600},
%<pad|ppl>     \textquoteleft    = {500,700},   \textquoteright    = {500,700},
%<ptm>     \textquoteleft    = {500,500},   \textquoteright    = {300,500},
%<m-t|bch|pmn>     \textquotedblleft = {300,300},   \textquotedblright = {300,300},
%<cmr>     \textquotedblleft = {500,300},   \textquotedblright = {200,600},
%<pad|ppl|ptm>     \textquotedblleft = {300,400},   \textquotedblright = {300,400},
%    \end{macrocode}
% Greek uppercase letters (for math mode).
%    \begin{macrocode}
%<*cmr>
   "00 = {   ,150}, % \Gamma
   "01 = {100,100}, % \Delta
   "02 = { 50, 50}, % \Theta
   "03 = {100,100}, % \Lambda
%  "04 = {   ,   }, % \Xi
%  "05 = {   ,   }, % \Pi
   "06 = { 50, 50}, % \Sigma
   "07 = {100,100}, % \Upsilon
   "08 = { 50, 50}, % \Phi
   "09 = { 50, 50}, % \Psi
%  "0A = {   ,   }, % \Omega
%</cmr>
   }

%    \end{macrocode}
% \tI\ and \lyI\ encodings contain some more characters. The default list
% will be loaded first.
%    \begin{macrocode}
\SetProtrusion
%<m-t>   [ name     = T1-default,
%<bch>   [ name     = bch-T1,
%<cmr>   [ name     = cmr-T1,
%<pad>   [ name     = pad-T1,
%<pmn>   [ name     = pmnj-T1,
%<ppl>   [ name     = ppl-T1,
%<ptm>   [ name     = ptm-T1,
%<m-t>     load     = default     ]
%<bch>     load     = bch-default ]
%<cmr>     load     = cmr-default ]
%<pad>     load     = pad-default ]
%<pmn>     load     = pmnj-default ]
%<ppl>     load     = ppl-default ]
%<ptm>     load     = ptm-default ]
%<m-t>   { encoding = {T1,LY1}    }
%<bch|cmr|pad|pmn|ppl>   { encoding = {T1,LY1},
%<ptm>   { encoding = {T1},
%<bch>     family   = bch }
%<cmr>     family   = cmr }
%<pad>     family   = {pad,padx,padj} }
%<pmn>     family   = pmnj }
%<ppl>     family   = {ppl,pplx,pplj} }
%<ptm>     family   = {ptm,ptmx,ptmj} }
   {
%    \end{macrocode}
%\changes{v1.4}{2004/10/30}{protrusion: tweak quote characters for \texttt{cmr}
%                           variants (\otI, \tI, \texttt{lmr})}
% The EC fonts do something weird: They insert an implicit kern between quote
% and boundary character. Therefore, we must override the settings from \otI.
%    \begin{macrocode}
%<m-t|pad|pmn|ptm>     \textbackslash    = {100,200},
%<bch>     \textbackslash    = {150,200},
%<cmr|ppl>     \textbackslash    = {200,300},
%<cmr>     \textquotedblleft = {200,600},
%<pmn>     \TH = {  , 50},
%<m-t|cmr|pad|ppl|ptm>     \quotesinglbase   = {400,400},   \quotedblbase      = {400,400},
%<bch|pmn>     \quotesinglbase   = {400,400},   \quotedblbase      = {300,300},
%<m-t|bch|pmn>     \guilsinglleft    = {400,300},   \guilsinglright    = {300,400},
%<cmr|pad|ppl|ptm>     \guilsinglleft    = {400,400},   \guilsinglright    = {300,500},
%<m-t>     \guillemotleft    = {200,200},   \guillemotright    = {200,200},
%<cmr>     \guillemotleft    = {300,200},   \guillemotright    = {100,400},
%<bch|pmn>     \guillemotleft    = {200,200},   \guillemotright    = {150,300},
%<pad>     \guillemotleft    = {300,300},   \guillemotright    = {200,400},
%<ppl|ptm>     \guillemotleft    = {300,300},   \guillemotright    = {200,400},
%<m-t|bch|cmr|pad|pmn|ppl>     \textexclamdown   = {100,   },   \textquestiondown  = {100,   },
%<ptm>     \textexclamdown   = {200,   },   \textquestiondown  = {200,   },
%<m-t|cmr|pad|ppl|ptm>     \textbraceleft    = {400,200},   \textbraceright    = {200,400},
%<bch|pmn>     \textbraceleft    = {200,   },   \textbraceright    = {   ,300},
%<m-t|bch|cmr|pad|ppl|ptm>     \textless         = {200,100},   \textgreater       = {100,200},
%<pmn>     \textless         = {100,   },   \textgreater       = {   ,100},
%<pmn>     \textvisiblespace = {100,100}, % not in LY1
%  \dh = {  ,  },
%  \th = {  ,  },
%  \NG = {  ,  },
%  \ng = {  ,  },
%  \textasciicircum = {  ,  },
%  \textbar = {  ,  },
%  \textsterling = {  ,  }, % also in TS1
%  \textsection = {  ,  }, % also in TS1
   }

%    \end{macrocode}
% The \pkg{lmodern} fonts, on the other hand, restore the original kerning from
% the \otI\ fonts, and so do we. Silly, isn't it?
%    \begin{macrocode}
%<*cmr>
\SetProtrusion
   [ name     = lmr-T1,
     load     = cmr-T1   ]
   { encoding = {T1,LY1},
     family   = lmr      }
   {
     \textquotedblleft = {500,300},
     \quotedblbase     = {500,300},
   }

%</cmr>
%<*pmn>
\SetProtrusion
   [ name     = pmnx-OT1,
     load     = pmnj-default ]
   { encoding = OT1,
     family   = pmnx }
   {
     1 = {230,180},
   }

\SetProtrusion
   [ name     = pmnx-T1,
     load     = pmnj-T1  ]
   { encoding = {T1,LY1},
     family   = pmnx     }
   {
     1 = {230,180},
   }

%</pmn>
%    \end{macrocode}
% Times is the default font for \lyI, therefore we provide settings for the
% additional characters in this encoding, too.
%\changes{v1.8}{2005/04/26}{protrusion: add \lyI\ characters for Times}
%    \begin{macrocode}
%<*ptm>
\SetProtrusion
   [ name     = ptm-LY1,
     load     = ptm-T1 ]
   { encoding = LY1,
     family   = {ptm,ptmx,ptmj} }
   {
     \texttrademark            = {100,100},
     \textregistered           = {100,100},
     \textcopyright            = {100,100},
     \textdegree               = {300,300},
     \textminus                = {200,200},
     \textellipsis             = {100,100},
     \texteuro                 = {   ,   }, % ?
     \textcent                 = {100,100},
     \textquotesingle          = {500,500},
     \textflorin               = { 50, 70},
     \textdagger               = {150,150},
     \textdaggerdbl            = {100,100},
     \textperthousand          = {   , 50},
     \textbullet               = {150,150},
     \textonesuperior          = {100,100},
     \texttwosuperior          = { 50, 50},
     \textthreesuperior        = { 50, 50},
     \textperiodcentered       = {300,300},
     \textplusminus            = { 50, 80},
     \textmultiply             = {100,100},
     \textdivide               = { 50,150},
%    \textbrokenbar            = {   ,   },
%    \textyen                  = {   ,   },
%    \textfractionsolidus      = {   ,   },
%    \textordfeminine          = {   ,   },
%    \textordmasculine         = {   ,   },
%    \textmu                   = {   ,   },
%    \textparagraph            = {   ,   },
%    \textonequarter           = {   ,   },
%    \textonehalf              = {   ,   },
%    \textthreequarters        = {   ,   },
   }

%</ptm>
%    \end{macrocode}
%
%\subsubsection{Italics}
%
% To find default settings for italic is difficult, since the character shapes
% and their behaviour at the beginning or end of line may be wildly different
% for different fonts. Therefore, we leave the letters away, and only set up the
% punctuation characters.
%\changes{v1.4b}{2004/11/22}{protrusion: slanted like italics}
%\changes{v1.6}{2004/12/26}{protrusion: add italic uppercase Greek letters}
%    \begin{macrocode}
\SetProtrusion
%<m-t>   [ name     = OT1-it   ]
%<bch>   [ name     = bch-it   ]
%<cmr>   [ name     = cmr-it   ]
%<pad>   [ name     = pad-it   ]
%<pmn>   [ name     = pmnj-it  ]
%<ppl>   [ name     = ppl-it   ]
%<ptm>   [ name     = ptm-it   ]
   { encoding = OT1,
%<bch>     family   = bch,
%<cmr>     family   = cmr,
%<pad>     family   = {pad,padx,padj},
%<pmn>     family   = pmnj,
%<ppl>     family   = {ppl,pplx,pplj},
%<ptm>     family   = {ptm,ptmx,ptmj},
%<!cmr>     shape    = {it,sl}  }
%<cmr>     shape    = it       }
   {
%<cmr|ptm>     A = {100,50},
%<pad|pmn>     A = {50,  },
%<ppl>     A = {50,50},
%<cmr|ptm>   \AE = {100,  },
%<pad|ppl>   \AE = {50,  },
%<pmn>   \AE = {  ,-50},
%<cmr|pad|ppl|ptm>     B = {50,  },
%<pmn>     B = {20,-50},
%<bch|ppl|ptm>     C = {50,  },
%<cmr|pad>     C = {100, },
%<pmn>     C = {50,-50},
%<cmr|pad|ppl|ptm>     D = {50,50},
%<pmn>     D = {20,  },
%<cmr|pad|ppl|ptm>     E = {50,  },
%<pmn>     E = {20,-50},
%<cmr|pad|ptm>     F = {100, },
%<pmn>     F = {10,  },
%<ppl>     F = {50,  },
%<bch|ppl|ptm>     G = {50,  },
%<cmr|pad>     G = {100, },
%<pmn>     G = {50,-50},
%<cmr|pad|ppl|ptm>     H = {50,  },
%<cmr|pad|ptm>     I = {50,  },
%<pmn>     I = {20,-50},
%<cmr|ptm>     J = {100, },
%<pad>     J = {50,  },
%<pmn>     J = {20,  },
%<cmr|pad|ppl|ptm>     K = {50,  },
%<pmn>     K = {20,  },
%<cmr|pad|ppl|ptm>     L = {50,  },
%<pmn>     L = {20,50},
%<cmr|ptm>     M = {50,  },
%<pmn>     M = {  ,-30},
%<cmr|ptm>     N = {50,  },
%<pmn>     N = {  ,-30},
%<bch|pmn|ppl|ptm>     O = {50,  },
%<cmr|pad>     O = {100, },
%<bch|pmn|ppl|ptm>   \OE = {50,  },
%<cmr|pad>   \OE = {100, },
%<cmr|pad|ppl|ptm>     P = {50,  },
%<pmn>     P = {20,-50},
%<bch|pmn|ppl|ptm>     Q = {50,  },
%<cmr|pad>     Q = {100, },
%<cmr|pad|ppl|ptm>     R = {50,  },
%<pmn>     R = {20,  },
%<bch|cmr|pad|ppl|ptm>     S = {50,  },
%<pmn>     S = {20,-30},
%<bch|cmr|pad|ppl|ptm>     $ = {50,  },
%<pmn>     $ = {20,-30},
%<bch|pmn>     T = {70,  },
%<cmr|pad|ppl|ptm>     T = {100, },
%<cmr|pad|ppl|ptm>     U = {50,  },
%<pmn>     U = {50,-50},
%<cmr|pad|pmn>     V = {100, },
%<ppl|ptm>     V = {100,50},
%<cmr|pad|pmn>     W = {100, },
%<ppl>     W = {50,  },
%<ptm>     W = {100,50},
%<cmr|ppl|ptm>     X = {50,  },
%<cmr|ptm>     Y = {100, },
%<pmn>     Y = {50,  },
%<ppl>     Y = {100,50},
%<pmn>     Z = {  ,-50},
%<pmn>     d = {  ,-50},
%<pad|pmn>     f = { ,-100},
%<pmn>     i = {  ,-30},
%<pmn>     j = {  ,-30},
%<pmn>     l = {  ,-100},
%<bch>     o = {50,50},
%<bch>     p = {  ,50},
%<pmn>     p = {-50,  },
%<bch>     q = {50,  },
%<pmn>     r = {  ,50},
%<bch>     t = {  ,50},
%<pmn>     v = {50,  },
%<bch>     w = {  ,50},
%<pmn>     w = {50,  },
%<bch>     y = {  ,50},
%<cmr>     0 = {100, },
%<bch|ptm>     1 = {150,100},
%<cmr>     1 = {200,50},
%<pad>     1 = {150, },
%<pmn>     1 = {50,  },
%<ppl>     1 = {100, },
%<cmr>     2 = {100,-100},
%<pad|ppl|ptm>     2 = {50,  },
%<pmn>     2 = {-50,  },
%<bch>     3 = {50,  },
%<cmr>     3 = {100,-100},
%<pmn>     3 = {-100, },
%<ptm>     3 = {100,50},
%<bch>     4 = {100, },
%<cmr|pad>     4 = {150, },
%<ppl|ptm>     4 = {50,  },
%<cmr>     5 = {100, },
%<ptm>     5 = {50,  },
%<bch>     6 = {50,  },
%<cmr>     6 = {100, },
%<bch|pad|ptm>     7 = {100, },
%<cmr>     7 = {200,-150},
%<pmn>     7 = {20,  },
%<ppl>     7 = {50,  },
%<cmr>     8 = {50,-50},
%<cmr>     9 = {100,-100},
%<m-t|cmr|pad|pmn|ppl>     . = { ,500},
%<bch|ptm>     . = { ,700},
%<m-t|cmr|pad|pmn|ppl>    {,}= { ,500},
%<bch>    {,}= { ,600},
%<ptm>    {,}= { ,700},
%<m-t|cmr|pad|ppl>     : = { ,300},
%<bch>     : = { ,400},
%<pmn>     : = { ,200},
%<ptm>     : = { ,500},
%<m-t|cmr|pad|ppl>     ; = { ,300},
%<bch>     ; = { ,400},
%<pmn>     ; = { ,200},
%<ptm>     ; = { ,500},
%<ptm>     ! = { ,100},
%<bch>     ? = { ,200},
%<ptm>     ? = { ,100},
%<ppl>     ? = { ,300},
%<pmn>     " = {400,200},
%<m-t|bch|pmn>     _ = {  ,100},
%<cmr>     _ = {100,200},
%<pad|ppl|ptm>     _ = {100,100},
%<m-t|pad|pmn|ppl|ptm>     & = {50,50},
%<bch>     & = {  ,80},
%<cmr>     & = {100,50},
%<m-t|cmr|pad|pmn>    \% = {100, },
%<bch>    \% = {50,50},
%<ppl|ptm>    \% = {100,100},
%<m-t|pmn|ppl>     * = {200,200},
%<bch>     * = {300,200},
%<cmr>     * = {400,100},
%<pad>     * = {500,100},
%<ptm>     * = {400,200},
%<m-t|cmr|pmn|ppl>     + = {150,200},
%<bch>     + = {250,250},
%<pad|ptm>     + = {250,200},
%<m-t|pad|pmn|ppl>     @ = {50,50},
%<bch>     @ = {80,50},
%<cmr>     @ = {200,50},
%<ptm>     @ = {150,150},
%<m-t|bch>     ~ = {150,150},
%<cmr|pad|pmn|ppl|ptm>     ~ = {200,150},
     ( = {200, },     ) = {   ,200},
%<m-t|cmr|pad|ppl|ptm>     / = {100,200},
%<bch>     / = {  ,150},
%<pmn>     / = {100,150},
%<m-t>     - = {300,300},
%<bch|pad>     - = {300,400},
%<pmn>     - = {200,300},
%<cmr>     - = {500,300},
%<ppl>     - = {300,500},
%<ptm>     - = {500,500},
%<m-t|pmn>     \textendash       = {200,200},   \textemdash        = {150,150},
%<bch>     \textendash       = {200,300},   \textemdash        = {150,200},
%<cmr>     \textendash       = {500,300},   \textemdash        = {400,200},
%<pad|ppl|ptm>     \textendash       = {300,300},   \textemdash        = {200,200},
%<m-t|bch|pmn>     \textquoteleft    = {400,200},   \textquoteright    = {400,200},
%<cmr|pad>     \textquoteleft    = {800,200},   \textquoteright    = {800,200},
%<ppl>     \textquoteleft    = {700,400},   \textquoteright    = {700,400},
%<ptm>     \textquoteleft    = {800,500},   \textquoteright    = {800,500},
%<m-t|bch|pmn>     \textquotedblleft = {400,200},   \textquotedblright = {400,200},
%<cmr>     \textquotedblleft = {700,100},   \textquotedblright = {500,300},
%<pad>     \textquotedblleft = {700,200},   \textquotedblright = {700,200},
%<ppl>     \textquotedblleft = {500,300},   \textquotedblright = {500,300},
%<ptm>     \textquotedblleft = {700,400},   \textquotedblright = {700,400},
%<*cmr>
   "00 = {200,150}, % \Gamma
   "01 = {150,100}, % \Delta
   "02 = {150, 50}, % \Theta
   "03 = {150, 50}, % \Lambda
   "04 = {100,100}, % \Xi
   "05 = {100,100}, % \Pi
   "06 = {100, 50}, % \Sigma
   "07 = {200,150}, % \Upsilon
   "08 = {150, 50}, % \Phi
   "09 = {150,100}, % \Psi
   "0A = { 50, 50}, % \Omega
%</cmr>
   }

\SetProtrusion
%<m-t>   [ name     = T1-it-default,
%<bch>   [ name     = bch-it-T1,
%<cmr>   [ name     = cmr-it-T1,
%<pad>   [ name     = pad-it-T1,
%<pmn>   [ name     = pmnj-it-T1,
%<ppl>   [ name     = ppl-it-T1,
%<ptm>   [ name     = ptm-it-T1,
%<m-t>     load     = OT1-it   ]
%<bch>     load     = bch-it   ]
%<cmr>     load     = cmr-it   ]
%<pmn>     load     = pmnj-it  ]
%<pad>     load     = pad-it   ]
%<ppl>     load     = ppl-it   ]
%<ptm>     load     = ptm-it   ]
%<m-t|bch|cmr|pad|pmn|ppl>   { encoding = {T1,LY1},
%<ptm>   { encoding = {T1},
%<bch>     family   = bch,
%<cmr>     family   = cmr,
%<pmn>     family   = pmnj,
%<pad>     family   = {pad,padx,padj},
%<ppl>     family   = {ppl,pplx,pplj},
%<ptm>     family   = {ptm,ptmx,ptmj},
%<!cmr>     shape    = {it,sl}  }
%<cmr>     shape    = it       }
   {
%<m-t|pad|ppl|ptm>     \textbackslash    = {100,200},
%<cmr>     \textbackslash    = {300,300},
%<bch>     \textbackslash    = {150,150},
%<pmn>     \textbackslash    = {100,150},
%<pmn>     031 = { ,-100}, % ffl
%<cmr|ptm>     156 = {100, },  % IJ
%<pad>     156 = {50,  },  % IJ
%<pmn>     156 = {20,  },  % IJ
%<pmn>     188 = {  ,-30}, % ij
%<pmn>   \v{t} = { ,100},
%<cmr>     \textquotedblleft = {500,300},
%<m-t|ptm>     \quotesinglbase   = {300,700},   \quotedblbase      = {400,500},
%<cmr>     \quotesinglbase   = {300,700},   \quotedblbase      = {200,600},
%<bch|pmn>     \quotesinglbase   = {200,500},   \quotedblbase      = {150,500},
%<pad|ppl>     \quotesinglbase   = {500,500},   \quotedblbase      = {400,400},
%<m-t|ppl|ptm>     \guilsinglleft    = {400,400},   \guilsinglright    = {300,500},
%<bch|pmn>     \guilsinglleft    = {300,400},   \guilsinglright    = {200,500},
%<cmr>     \guilsinglleft    = {500,300},   \guilsinglright    = {400,400},
%<pad>     \guilsinglleft    = {500,400},   \guilsinglright    = {300,500},
%<m-t|ppl>     \guillemotleft    = {300,300},   \guillemotright    = {300,300},
%<bch|pmn>     \guillemotleft    = {200,300},   \guillemotright    = {150,400},
%<cmr>     \guillemotleft    = {400,100},   \guillemotright    = {200,300},
%<pad>     \guillemotleft    = {300,300},   \guillemotright    = {200,400},
%<ptm>     \guillemotleft    = {300,400},   \guillemotright    = {200,400},
%<m-t|pad|ppl>     \textexclamdown   = {100,   },   \textquestiondown  = {200,   },
%<cmr|ptm>     \textexclamdown   = {200,   },   \textquestiondown  = {200,   },
%<pmn>     \textexclamdown   = {-50,   },   \textquestiondown  = {-50,   },
%<m-t|ppl>     \textbraceleft    = {200,100},   \textbraceright    = {200,200},
%<bch|pmn>     \textbraceleft    = {200,   },   \textbraceright    = {   ,200},
%<cmr|pad|ptm>     \textbraceleft    = {400,100},   \textbraceright    = {200,200},
%<bch|pmn>     \textless         = {100,   },   \textgreater       = {   ,100},
%<cmr|pad|ppl|ptm>     \textless         = {300,100},   \textgreater       = {200,100},
%<pmn>     \textvisiblespace = {100,100},
   }

%<*cmr>
%    \end{macrocode}
%\changes{v1.8}{2005/06/01}{protrusion: verified settings for slanted Computer Modern Roman}
% Slanted is very similar to italic.
%    \begin{macrocode}
\SetProtrusion
   [ name     = cmr-sl,
     load     = cmr-it ]
   { encoding = OT1,
     family   = cmr,
     shape    = sl  }
   {
      L = {  ,50},
      f = { ,-50},
      - = {300, },
     \textendash = {400,  },  \textemdash = {300,  },
   }

\SetProtrusion
   [ name     = cmr-sl-T1,
     load     = cmr-it-T1 ]
   { encoding = {T1,LY1},
     family   = cmr,
     shape    = sl  }
   {
      L = {  ,50},
      f = { ,-50},
      - = {300, },
     \textendash = {400,  },  \textemdash = {300,  },
   }

\SetProtrusion
   [ name     = lmr-it-T1,
     load     = cmr-it-T1 ]
   { encoding = {T1,LY1},
     family   = lmr,
     shape    = {it,sl} }
   {
     \textquotedblleft = {700,100},
     \quotedblbase     = {600,300},
   }

%    \end{macrocode}
% Oldstyle numerals are slightly different.
%    \begin{macrocode}
\SetProtrusion
   [ name = cmr(oldstyle)-it,
     load = cmr-it-T1 ]
   { encoding = T1,
     family   = {hfor,cmor},
     shape    = {it,sl}  }
   {
     1 = {250, 50},
     2 = {150,-100},
     3 = {100,-50},
     4 = {150,150},
     6 = {200,   },
     7 = {200, 50},
     8 = {150,-50},
     9 = {100, 50},
   }

%</cmr>
%<*pmn>
\SetProtrusion
   [ name     = pmnx-it,
     load     = pmnj-it ]
   { encoding = OT1,
     family   = pmnx,
     shape    = {it,sl} }
   {
     1 = {100,150},
   }

\SetProtrusion
   [ name     = pmnx-it-T1,
     load     = pmnj-it-T1 ]
   { encoding = {T1,LY1},
     family   = pmnx,
     shape    = {it,sl} }
   {
     1 = {100,150},
   }

%</pmn>
%<*ptm>
\SetProtrusion
   [ name     = ptm-it-LY1,
     load     = ptm-it-T1   ]
   { encoding = {LY1},
     family   = {ptm,ptmx,ptmj},
     shape    = {it,sl}  }
   {
     \texttrademark            = {100,100},
     \textregistered           = {100,100},
     \textcopyright            = {100,100},
     \textdegree               = {300,100},
     \textminus                = {200,200},
     \textellipsis             = {100,150},
     \texteuro                 = {   ,   },
     \textcent                 = {100,100},
     \textquotesingle          = {500,   },
     \textflorin               = {100, 70},
     \textdagger               = {150,150},
     \textdaggerdbl            = {100,100},
     \textbullet               = {150,150},
     \textonesuperior          = {150,100},
     \texttwosuperior          = {150, 50},
     \textthreesuperior        = {150, 50},
     \textparagraph            = {100,   },
     \textperiodcentered       = {500,300},
     \textonequarter           = { 50,   },
     \textonehalf              = { 50,   },
     \textplusminus            = {100,100},
     \textmultiply             = {150,150},
     \textdivide               = {150,150},
   }

%</ptm>
%    \end{macrocode}
%
%\subsubsection{Small caps}
%
% Small caps should inherit the values from their big brothers. Since values are
% relative to character width, we don't need to adjust them any further (but
% we have to reset some characters).
%    \begin{macrocode}
\SetProtrusion
%<m-t>   [ name     = OT1-sc,
%<bch>   [ name     = bch-sc,
%<cmr>   [ name     = cmr-sc,
%<pad>   [ name     = pad-sc,
%<pmn>   [ name     = pmnj-sc,
%<ppl>   [ name     = ppl-sc,
%<ptm>   [ name     = ptm-sc,
%<m-t>     load     = default ]
%<bch>     load     = bch-default ]
%<cmr>     load     = cmr-default ]
%<pad>     load     = pad-default ]
%<pmn>     load     = pmnj-default ]
%<ppl>     load     = ppl-default ]
%<ptm>     load     = ptm-default ]
   { encoding = OT1,
%<bch>     family   = bch,
%<cmr>     family   = cmr,
%<pad>     family   = {pad,padx,padj},
%<pmn>     family   = pmnj,
%<ppl>     family   = {ppl,pplx,pplj},
%<ptm>     family   = {ptm,ptmx,ptmj},
     shape    = sc }
   {
     a = {50,50},
%<cmr|pad|ppl|ptm>   \ae = {50,  },
%<bch|pmn>     c = {50,  },
%<bch|pad|pmn>     d = {  ,50},
%<m-t|bch|cmr|pad|pmn|ptm>     f = {  ,50},
%<bch|pad|pmn>     g = {50,  },
%<m-t|cmr|pad|pmn|ppl|ptm>     j = {50,  },
%<bch>     j = {100,  },
%<m-t|bch|cmr|pad|pmn|ppl>     l = {  ,50},
%<ptm>     l = {  ,80},
%<m-t|bch|cmr|pad|pmn|ppl>   013 = {  ,50}, % fl
%<ptm>   013 = {  ,80}, % fl
%<bch|pad|pmn>     o = {50,50},
%<bch|pad|pmn>   \oe = {50,  },
%<ppl>     p = { 0, 0},
%<bch|pad|pmn>     q = {50,70},
%<ppl>     q = { 0,  },
%<m-t|cmr|pad|pmn|ppl|ptm>     r = {  , 0},
     t = {50,50},
%<m-t|bch|cmr|pad|pmn|ppl>     y = {50,50},
%<ptm>     y = {80,80},
   }

\SetProtrusion
%<m-t>   [ name     = T1-sc,
%<bch>   [ name     = bch-sc-T1,
%<cmr>   [ name     = cmr-sc-T1,
%<pad>   [ name     = pad-sc-T1,
%<pmn>   [ name     = pmnj-sc-T1,
%<ppl>   [ name     = ppl-sc-T1,
%<ptm>   [ name     = ptm-sc-T1,
%<m-t>     load     = T1-default ]
%<bch>     load     = bch-T1     ]
%<cmr>     load     = cmr-T1     ]
%<pad>     load     = pad-T1     ]
%<pmn>     load     = pmnj-T1    ]
%<ppl>     load     = ppl-T1     ]
%<ptm>     load     = ptm-T1     ]
   { encoding = {T1,LY1},
%<bch>     family   = bch,
%<cmr>     family   = cmr,
%<pad>     family   = {pad,padx,padj},
%<pmn>     family   = pmnj,
%<ppl>     family   = {ppl,pplx,pplj},
%<ptm>     family   = {ptm,ptmx,ptmj},
     shape    = sc }
   {
     a = {50,50},
%<cmr|pad|ppl|ptm>   \ae = {50,  },
%<bch|pmn>     c = {50,  },
%<bch|pad|pmn>     d = {  ,50},
%<m-t|bch|cmr|pad|pmn|ptm>     f = {  ,50},
%<bch|pad|pmn>     g = {50,  },
%<m-t|cmr|pad|pmn|ppl|ptm>     j = {50,  },
%<bch>     j = {100,  },
%<m-t|bch|cmr|pad|pmn|ppl>     l = {  ,50},
%<ptm>     l = {  ,80},
%<m-t|bch|cmr|pad|pmn|ppl>   029 = {  ,50}, % fl
%<ptm>   029 = {  ,80}, % fl
%<bch|pad|pmn>     o = {50,50},
%<bch|pad|pmn>   \oe = {50,  },
%<ppl>     p = { 0, 0},
%<bch|pad|pmn>     q = {50,70},
%<ppl>     q = { 0,  },
%<m-t|cmr|pad|pmn|ppl|ptm>     r = {  , 0},
     t = {50,50},
%<m-t|bch|cmr|pad|pmn|ppl>     y = {50,50},
%<ptm>     y = {80,80},
   }

%<*pmn>
\SetProtrusion
   [ name     = pmnx-sc,
     load     = pmnj-sc ]
   { encoding = OT1,
     family   = pmnx,
     shape    = sc }
   {
     1 = {230,180},
   }

\SetProtrusion
   [ name     = pmnx-sc-T1,
     load     = pmnj-sc-T1 ]
   { encoding = {T1,LY1},
     family   = pmnx,
     shape    = sc }
   {
     1 = {230,180},
   }

%    \end{macrocode}
%
%\subsubsection{Italic Small Caps}
% Minion provides real small caps in italics.
% The \pkg{slantsc} package calls them |scit|, Philipp Lehman's
% \pkg{fontinstallationguide} suggests |si|.
%    \begin{macrocode}
\SetProtrusion
   [ name     = pmnj-scit,
     load     = pmnj-it   ]
   { encoding = OT1,
     family   = pmnj,
     shape    = {scit,si} }
   {
     a = {50,  },
   \ae = {  ,-50},
     b = {20,-50},
     c = {50,-50},
     d = {20, 0},
     e = {20,-50},
     f = {10, 0},
   012 = {10,-50}, % fi
   013 = {10,-50}, % fl
   014 = {10,-50}, % ffi
   015 = {10,-50}, % ffl
     g = {50,-50},
     i = {20,-50},
     j = {20, 0},
     k = {20,  },
     l = {20,50},
     m = {  ,-30},
     n = {  ,-30},
     o = {50,  },
   \oe = {50,-50},
     p = {20,-50},
     q = {50,  },
     r = {20, 0},
     s = {20,-30},
     t = {70,  },
     u = {50,-50},
     v = {100,  },
     w = {100,  },
     y = {50,  },
     z = {  ,-50},
   }

\SetProtrusion
   [ name     = pmnj-scit-T1,
     load     = pmnj-it-T1   ]
   { encoding = {T1,LY1},
     family   = pmnj,
     shape    = {scit,si}    }
   {
     a = {50,  },
   \ae = {  ,-50},
     b = {20,-50},
     c = {50,-50},
     d = {20, 0},
     e = {20,-50},
     f = {10, 0},
   028 = {10,-50}, % fi
   029 = {10,-50}, % fl
   030 = {10,-50}, % ffi
   031 = {10,-50}, % ffl
     g = {50,-50},
     i = {20,-50},
   188 = {20, 0},  % ij
     j = {20, 0},
     k = {20,  },
     l = {20,50},
     m = {  ,-30},
     n = {  ,-30},
     o = {50,  },
   \oe = {50,-50},
     p = {20,-50},
     q = {50,  },
     r = {20, 0},
     s = {20,-30},
     t = {70,  },
     u = {50,-50},
     v = {100,  },
     w = {100,  },
     y = {50,  },
     z = {  ,-50},
   }

\SetProtrusion
   [ name     = pmnx-scit,
     load     = pmnj-scit ]
   { encoding = OT1,
     family   = pmnx,
     shape    = {scit,si} }
   {
     1 = {100,150},
   }

\SetProtrusion
   [ name     = pmnx-scit-T1,
     load     = pmnj-scit-T1 ]
   { encoding = {T1,LY1},
     family   = pmnx,
     shape    = {scit,si}    }
   {
     1 = {100,150},
   }

%</pmn>
%    \end{macrocode}
%
%\subsubsection{\texttt{textcomp}}
%
% Finally the \tsI\ encoding.
% Still quite incomplete for Times and especially Palatino. Anybody?
%\changes{v1.2}{2004/09/28}{add protrusion factors for Adobe Garamond and
%                           Computer Modern Roman in \tsI\ encoding}
%    \begin{macrocode}
\SetProtrusion
%<m-t>   [ name     = textcomp ]
%<bch>   [ name     = bch-textcomp ]
%<cmr>   [ name     = cmr-textcomp ]
%<pad>   [ name     = pad-textcomp ]
%<pmn>   [ name     = pmn-textcomp ]
%<ppl>   [ name     = ppl-textcomp ]
%<ptm>   [ name     = ptm-textcomp ]
%<m-t>   { encoding = TS1      }
%<!m-t>   { encoding = TS1,
%<bch>     family   = bch }
%<cmr>     family   = cmr }
%<pad>     family   = {pad,padx,padj} }
%<pmn>     family   = {pmnx,pmnj} }
%<ppl>     family   = {ppl,pplx,pplj} }
%<ptm>     family   = {ptm,ptmx,ptmj} }
   {
%<cmr>     \textquotestraightbase    = {300,300},
%<pad|pmn>     \textquotestraightbase    = {400,400},
%<cmr|pmn>     \textquotestraightdblbase = {300,300},
%<pad>     \textquotestraightdblbase = {400,400},
%<bch|cmr|pad|pmn>     \texttwelveudash          = {200,200},
%<bch|cmr|pad|pmn>     \textthreequartersemdash  = {150,150},
%<cmr|pmn>     \textquotesingle          = {300,400},
%<pad>     \textquotesingle          = {400,500},
%<ptm>     \textquotesingle          = {500,500},
%<bch|cmr|pmn>     \textasteriskcentered     = {200,300},
%<pad>     \textasteriskcentered     = {300,300},
%<pmn>     \textfractionsolidus      = {-200,-200},
%<cmr>     \textoneoldstyle          = {100,100},
%<pmn>     \textoneoldstyle          = {   , 50},
%<cmr>     \textthreeoldstyle        = {   , 50},
%<pad|pmn>     \textthreeoldstyle        = { 50,   },
%<cmr>     \textfouroldstyle         = { 50, 50},
%<pad|pmn>     \textfouroldstyle         = { 50,   },
%<cmr|pad|pmn>     \textsevenoldstyle        = { 50, 80},
%<cmr>     \textlangle               = {400,   },
%<cmr>     \textrangle               = {   ,400},
%<m-t|bch|pmn|ptm>     \textminus                = {200,200},
%<cmr|pad|ppl>     \textminus                = {300,300},
%<bch|pad|pmn>     \textlbrackdbl            = {100,   },
%<bch|pad|pmn>     \textrbrackdbl            = {   ,100},
%<pmn>     \textasciigrave           = {200,500},
%<bch|cmr|pad|pmn>     \texttildelow             = {200,250},
%<pmn>     \textasciibreve           = {300,400},
%<pmn>     \textasciicaron           = {300,400},
%<pmn>     \textacutedbl             = {200,300},
%<pmn>     \textgravedbl             = {150,300},
%<bch|pmn>     \textdagger               = { 80, 80},
%<cmr|pad>     \textdagger               = {100,100},
%<ptm>     \textdagger               = {150,150},
%<cmr|pad|pmn>     \textdaggerdbl            = { 80, 80},
%<ptm>     \textdaggerdbl            = {100,100},
%<bch>     \textbardbl               = {100,100},
%<bch>     \textbullet               = {200,200},
%<cmr|pad|pmn>     \textbullet               = {   ,100},
%<ptm>     \textbullet               = {150,150},
%<bch|cmr|pmn>     \textcelsius              = { 50,   },
%<pad>     \textcelsius              = { 80,   },
%<bch>     \textflorin               = { 50, 50},
%<pad>     \textflorin               = {   ,100},
%<pmn>     \textflorin               = { 50,100},
%<ptm>     \textflorin               = { 50, 70},
%<cmr>     \textcolonmonetary        = {   , 50},
%<pad|pmn>     \textcolonmonetary        = { 50,   },
%<pmn>     \textinterrobang          = {   ,100},
%<pmn>     \textinterrobangdown      = {100,   },
%<m-t|pad|ptm>     \texttrademark            = {100,100},
%<bch>     \texttrademark            = {150,150},
%<cmr|ppl>     \texttrademark            = {200,200},
%<pmn>     \texttrademark            = { 50, 50},
%<bch>     \textcent                 = { 50,   },
%<ptm>     \textcent                 = {100,100},
%<bch>     \textsterling             = { 50,   },
%<bch>     \textbrokenbar            = {200,200},
%<pmn>     \textasciidieresis        = {300,400},
%<m-t|bch|cmr|pad|ptm>     \textcopyright            = {100,100},
%<pmn>     \textcopyright            = {100,150},
%<ppl>     \textcopyright            = {200,200},
%<bch|cmr>     \textordfeminine          = {100,200},
%<pad|pmn>     \textordfeminine          = {200,200},
%<bch|cmr|pad|pmn>     \textlnot                 = {200,   },
%<m-t|bch|cmr|pad|ptm>     \textregistered           = {100,100},
%<pmn>     \textregistered           = { 50,150},
%<ppl>     \textregistered           = {200,200},
%<pmn>     \textasciimacron          = {150,200},
%<m-t|ppl|ptm>     \textdegree               = {300,300},
%<bch>     \textdegree               = {150,200},
%<cmr|pad>     \textdegree               = {400,400},
%<pmn>     \textdegree               = {150,400},
%<bch|cmr|pad|pmn>     \textpm                   = {150,200},
%<ptm>     \textpm                   = { 50, 80},
%<bch>     \texttwosuperior          = {100,200},
%<cmr>     \texttwosuperior          = { 50,100},
%<pad|pmn>     \texttwosuperior          = {200,200},
%<ptm>     \texttwosuperior          = { 50, 50},
%<bch>     \textthreesuperior        = {100,200},
%<cmr>     \textthreesuperior        = { 50,100},
%<pad|pmn>     \textthreesuperior        = {200,200},
%<ptm>     \textthreesuperior        = { 50, 50},
%<pmn>     \textasciiacute           = {300,400},
%<bch>     \textmu                   = {   ,100},
%<bch|pad|pmn>     \textparagraph            = {  ,100},
%<bch|cmr|pad|pmn>     \textperiodcentered       = {300,400},
%<ptm>     \textperiodcentered       = {300,300},
%<bch>     \textonesuperior          = {200,300},
%<cmr|pad|pmn>     \textonesuperior          = {200,200},
%<ptm>     \textonesuperior          = {100,100},
%<bch|pad|pmn>     \textordmasculine         = {200,200},
%<cmr>     \textordmasculine         = {100,200},
%<bch|cmr|pmn>     \texteuro                 = {100,   },
%<pad>     \texteuro                 = { 50,100},
%<bch|ptm>     \texttimes                = {100,100},
%<cmr>     \texttimes                = {150,250},
%<pad>     \texttimes                = {100,150},
%<pmn>     \texttimes                = { 70,100},
%<bch|pad|pmn>     \textdiv                  = {150,200},
%<cmr>     \textdiv                  = {150,250},
%<ptm>     \textdiv                  = { 50,100},
%<ptm>     \textperthousand          = {    ,50},
%    \end{macrocode}
% All remaining characters can be found in the source.
%\iffalse
%^^A ... namely, here:
%    \textsection                 = {  ,  },
%    \textyen                     = {  ,  },
%    \textonehalf                 = {  ,  },
%    \textonequarter              = {  ,  },
%    \textthreequarters           = {  ,  },
%    \texttwooldstyle             = {  ,  },
%    \textfiveoldstyle            = {  ,  },
%    \textsixoldstyle             = {  ,  },
%    \texteightoldstyle           = {  ,  },
%    \textnineoldstyle            = {  ,  },
%    \textleftarrow               = {  ,  },
%    \textrightarrow              = {  ,  },
%    \textblank                   = {  ,  },
%    \textdollar                  = {  ,  },
%    \textdblhyphen               = {  ,  },
%    \textdblhyphenchar           = {  ,  },
%    \textohm                     = {  ,  },
%    \textmho                     = {  ,  },
%    \textbigcircle               = {  ,  },
%    \textuparrow                 = {  ,  },
%    \textdownarrow               = {  ,  },
%    \textborn                    = {  ,  },
%    \textdied                    = {  ,  },
%    \textmarried                 = {  ,  },
%    \textdivorced                = {  ,  },
%    \textleaf                    = {  ,  },
%    \textmusicalnote             = {  ,  },
%    \textdollaroldstyle          = {  ,  },
%    \textcentoldstyle            = {  ,  },
%    \textwon                     = {  ,  },
%    \textnaira                   = {  ,  },
%    \textguarani                 = {  ,  },
%    \textpeso                    = {  ,  },
%    \textlira                    = {  ,  },
%    \textrecipe                  = {  ,  },
%    \textdong                    = {  ,  },
%    \textpertenthousand          = {  ,  },
%    \textpilcrow                 = {  ,  },
%    \textbaht                    = {  ,  },
%    \textnumero                  = {  ,  },
%    \textdiscount                = {  ,  },
%    \textestimated               = {  ,  },
%    \textopenbullet              = {  ,  },
%    \textservicemark             = {  ,  },
%    \textlquill                  = {  ,  },
%    \textrquill                  = {  ,  },
%    \textcopyleft                = {  ,  },
%    \textcircledP                = {  ,  },
%    \textreferencemark           = {  ,  },
%    \textsurd                    = {  ,  },
%\fi
%    \begin{macrocode}
   }

%<*cmr|pad|pmn>
\SetProtrusion
%<cmr>   [ name     = cmr-textcomp-it ]
%<pad>   [ name     = pad-textcomp-it ]
%<pmn>   [ name     = pmn-textcomp-it ]
   { encoding = TS1,
%<cmr>     family   = cmr,
%<pad>     family   = {pad,padx,padj},
%<pmn>     family   = {pmnx,pmnj},
     shape    = {it,sl} }
   {
%<cmr>     \textquotestraightbase    = {300,600},
%<pad|pmn>     \textquotestraightbase    = {400,400},
%<cmr>     \textquotestraightdblbase = {300,600},
%<pad>     \textquotestraightdblbase = {300,400},
%<pmn>     \textquotestraightdblbase = {300,300},
     \texttwelveudash          = {200,200},
     \textthreequartersemdash  = {150,150},
%<cmr>     \textquotesingle          = {600,300},
%<pad>     \textquotesingle          = {800,100},
%<pmn>     \textquotesingle          = {300,200},
%<cmr>     \textasteriskcentered     = {300,200},
%<pad>     \textasteriskcentered     = {500,100},
%<pmn>     \textasteriskcentered     = {200,300},
%<pmn>     \textfractionsolidus      = {-200,-200},
%<cmr>     \textoneoldstyle          = {100, 50},
%<pad>     \textoneoldstyle          = {100,   },
%<pmn>     \textoneoldstyle          = { 50,   },
%<pad>     \texttwooldstyle          = { 50,   },
%<pmn>     \texttwooldstyle          = {-50,   },
%<cmr>     \textthreeoldstyle        = {100, 50},
%<pmn>     \textthreeoldstyle        = {-100,  },
%<cmr>     \textfouroldstyle         = { 50, 50},
%<pad>     \textfouroldstyle         = { 50,100},
%<cmr>     \textsevenoldstyle        = { 50, 80},
%<pad>     \textsevenoldstyle        = { 50,   },
%<pmn>     \textsevenoldstyle        = { 20,   },
%<cmr>     \textlangle               = {400,   },
%<cmr>     \textrangle               = {   ,400},
%<cmr|pad>     \textminus                = {300,300},
%<pmn>     \textminus                = {200,200},
%<pad|pmn>     \textlbrackdbl            = {100,   },
%<pad|pmn>     \textrbrackdbl            = {   ,100},
%<pmn>     \textasciigrave           = {300,300},
     \texttildelow             = {200,250},
%<pmn>     \textasciibreve           = {300,300},
%<pmn>     \textasciicaron           = {300,300},
%<pmn>     \textacutedbl             = {200,300},
%<pmn>     \textgravedbl             = {150,300},
%<cmr>     \textdagger               = {100,100},
%<pad>     \textdagger               = {200,100},
%<pmn>     \textdagger               = { 80, 50},
%<cmr|pad>     \textdaggerdbl            = { 80, 80},
%<pmn>     \textdaggerdbl            = { 80, 50},
%<cmr>     \textbullet               = {200,100},
%<pad>     \textbullet               = {300,   },
%<pmn>     \textbullet               = { 30, 70},
%<cmr>     \textcelsius              = {100,   },
%<pad>     \textcelsius              = {200,   },
%<pmn>     \textcelsius              = { 50,-50},
%<pad>     \textflorin               = {100,   },
%<pmn>     \textflorin               = { 50,100},
%<cmr>     \textcolonmonetary        = {150,   },
%<pad>     \textcolonmonetary        = {100,   },
%<pmn>     \textcolonmonetary        = { 50,-50},
%<cmr|pad>     \texttrademark            = {200,   },
%<pmn>     \texttrademark            = { 50,100},
%<pmn>     \textasciidieresis        = {300,200},
%<cmr>     \textcopyright            = {100,   },
%<pad>     \textcopyright            = {200,100},
%<pmn>     \textcopyright            = {100,150},
%<cmr>     \textordfeminine          = {100,100},
%<pmn>     \textordfeminine          = {200,200},
%<cmr|pad>     \textlnot                 = {300,   },
%<pmn>     \textlnot                 = {200,   },
%<cmr>     \textregistered           = {100,   },
%<pad>     \textregistered           = {200,100},
%<pmn>     \textregistered           = { 50,150},
%<pmn>     \textasciimacron          = {150,200},
%<cmr|pad>     \textdegree               = {500,100},
%<pmn>     \textdegree               = {150,150},
%<cmr>     \textpm                   = {150,100},
%<pad>     \textpm                   = {200,150},
%<pmn>     \textpm                   = {150,200},
%<cmr>     \textonesuperior          = {400,   },
%<pad>     \textonesuperior          = {300,100},
%<pmn>     \textonesuperior          = {200,100},
%<cmr>     \texttwosuperior          = {400,   },
%<pad>     \texttwosuperior          = {300,   },
%<pmn>     \texttwosuperior          = {200,100},
%<cmr>     \textthreesuperior        = {400,   },
%<pad>     \textthreesuperior        = {300,   },
%<pmn>     \textthreesuperior        = {200,100},
%<pmn>     \textasciiacute           = {300,200},
%<cmr>     \textparagraph            = {200,   },
%<pmn>     \textparagraph            = {   ,100},
%<cmr>     \textperiodcentered       = {500,500},
%<pad|pmn>     \textperiodcentered       = {300,400},
%<cmr>     \textordmasculine         = {100,100},
%<pmn>     \textordmasculine         = {200,200},
%<cmr>     \texteuro                 = {200,   },
%<pad>     \texteuro                 = {100,   },
%<pmn>     \texteuro                 = {100,-50},
%<cmr>     \texttimes                = {200,200},
%<pad>     \texttimes                = {200,100},
%<pmn>     \texttimes                = { 70,100},
%<cmr|pad>     \textdiv                  = {200,200},
%<pmn>     \textdiv                  = {150,200},
   }

%</cmr|pad|pmn>
%    \end{macrocode}
%
%\subsubsection{Math}
%
% Now to the math symbols for Computer Modern Roman. Definitions have been
% extracted from \file{fontmath.ltx}.
%\changes{v1.2}{2004/10/02}{add protrusion factors for Computer Modern Roman
%                           math symbols}
% I did not spend too much time fiddling with these settings, so they can surely
% be improved.
%
% The math font `|operators|' (also used for the \cmd{\mathrm} and
% \cmd{\mathbf} alphabets) is |OT1/cmr|, which we've already set up above.
% It's declared as:
%\begin{verbatim}
%\DeclareSymbolFont{operators}   {OT1}{cmr} {m}{n}
%\SetSymbolFont{operators}{bold}{OT1}{cmr} {bx}{n}
%\end{verbatim}
%
% \cmd{\mathit} (|OT1/cmr/m/it|) is also already set up.
%
% There are (for the moment) no settings for \cmd{\mathsf} and \cmd{\mathtt}.
%
% Math font `|letters|' (also used as \cmd{\mathnormal}) is declared as:
%\begin{verbatim}
%\DeclareSymbolFont{letters}     {OML}{cmm} {m}{it}
%\SetSymbolFont{letters}  {bold}{OML}{cmm} {b}{it}
%\end{verbatim}
%\changes{v1.6}{2004/12/26}{protrusion: tune CMR math letters (OML encoding)}
%    \begin{macrocode}
%<*cmr>
\SetProtrusion
   [ name     = cmr-math-letters ]
   { encoding = OML,
     family   = cmm,
     series   = {m,b},
     shape    = it  }
   {
       A = {100, 50}, % \mathnormal
       B = { 50,   },
       C = { 50,   },
       D = { 50, 50},
       E = { 50,   },
       F = {100, 50},
       G = { 50, 50},
       H = { 50, 50},
       I = { 50, 50},
       J = {150, 50},
       K = { 50,100},
       L = { 50, 50},
       M = { 50,   },
       N = { 50,   },
       O = { 50,   },
       P = { 50,   },
       Q = { 50, 50},
       R = { 50,   },
       S = { 50,   },
       T = { 50,100},
       U = { 50, 50},
       V = {100,100},
       W = { 50,100},
       X = { 50,100},
       Y = {100,100},
       f = {100,100},
       h = {   ,100},
       i = {   , 50},
       j = {   , 50},
       k = {   , 50},
       r = {   , 50},
       v = {   , 50},
       w = {   , 50},
       x = {   , 50},
     "0B = { 50,100}, % \alpha
     "0C = { 50, 50}, % \beta
     "0D = {200,150}, % \gamma
     "0E = { 50, 50}, % \delta
     "0F = { 50, 50}, % \epsilon
     "10 = { 50,150}, % \zeta
%    "11 = {   ,   }, % \eta
     "12 = { 50,   }, % \theta
     "13 = {   ,100}, % \iota
     "14 = {   ,100}, % \kappa
     "15 = {100, 50}, % \lambda
     "16 = {   , 50}, % \mu
     "17 = {   , 50}, % \nu
     "18 = {   , 50}, % \xi
     "19 = { 50,100}, % \pi
     "1A = { 50, 50}, % \rho
     "1B = {   ,150}, % \sigma
     "1C = { 50,150}, % \tau
     "1D = { 50, 50}, % \upsilon
%    "1E = {   ,   }, % \phi
     "1F = { 50,100}, % \chi
     "20 = { 50, 50}, % \psi
     "21 = {   , 50}, % \omega
     "22 = {   , 50}, % \varepsilon
     "23 = {   , 50}, % \vartheta
     "24 = {   , 50}, % \varpi
     "25 = {100,   }, % \varrho
     "26 = {100,100}, % \varsigma
     "27 = { 50, 50}, % \varphi
     "28 = {100,100}, % \leftharpoonup
     "29 = {100,100}, % \leftharpoondown
     "2A = {100,100}, % \rightharpoonup
     "2B = {100,100}, % \rightharpoondown
     "2C = {300,200}, % \lhook
     "2D = {200,300}, % \rhook
     "2E = {   ,100}, % \triangleright
     "2F = {100,   }, % \triangleleft
     % 0 - 9
     "3A = {   ,500}, % ., \ldotp
     "3B = {   ,500}, % ,
     "3C = {200,100}, % <
     "3D = {300,400}, % /
     "3E = {100,200}, % >
     "3F = {200,200}, % \star
%    "40 = {   ,   }, % \partial
     "5B = {   ,100}, % \flat
%    "5C = {   ,   }, % \natural
%    "5D = {   ,   }, % \sharp
     "5E = {200,200}, % \smile
     "5F = {200,200}, % \frown
%    "60 = {   ,   }, % \ell
%    "7B = {   ,   }, % \imath
     "7C = {100,   }, % \jmath
     "7D = {   ,100}, % \wp
   }

%    \end{macrocode}
% Math font `|symbols|' (also used for the \cmd{\mathcal} alphabet) is declared
% as:
%\begin{verbatim}
%\DeclareSymbolFont{symbols}     {OMS}{cmsy}{m}{n}
%\SetSymbolFont{symbols}  {bold}{OMS}{cmsy}{b}{n}
%\end{verbatim}
%    \begin{macrocode}
\SetProtrusion
   [ name     = cmr-math-symbols ]
   { encoding = OMS,
     family   = cmsy,
     series   = {m,b},
     shape    = n  }
   {
       A = {150, 50}, % \mathcal
       C = {   ,100},
       D = {   , 50},
       F = { 50,150},
       I = {   ,100},
       J = {100,150},
       K = {   ,100},
       L = {100,   },
       M = { 50, 50},
       N = { 50,100},
       P = {   , 50},
       Q = { 50,   },
       R = {   , 50},
       T = { 50,150},
       V = { 50, 50},
       W = {   , 50},
       X = {100,100},
       Y = {100,   },
       Z = {100,150},
     "00 = {300,300}, % -
     "01 = {   ,700}, % \cdot, \cdotp
     "02 = {150,250}, % \times
     "03 = {150,250}, % *, \ast
     "04 = {200,300}, % \div
     "05 = {150,250}, % \diamond
     "06 = {200,200}, % \pm
     "07 = {200,200}, % \mp
     "08 = {100,100}, % \oplus
     "09 = {100,100}, % \ominus
     "0A = {100,100}, % \otimes
     "0B = {100,100}, % \oslash
     "0C = {100,100}, % \odot
     "0D = {100,100}, % \bigcirc
     "0E = {100,100}, % \circ
     "0F = {100,100}, % \bullet
     "10 = {100,100}, % \asymp
     "11 = {100,100}, % \equiv
     "12 = {200,100}, % \subseteq
     "13 = {100,200}, % \supseteq
     "14 = {200,100}, % \leq
     "15 = {100,200}, % \geq
     "16 = {200,100}, % \preceq
     "17 = {100,200}, % \succeq
     "18 = {200,200}, % \sim
     "19 = {150,150}, % \approx
     "1A = {200,100}, % \subset
     "1B = {100,200}, % \supset
     "1C = {200,100}, % \ll
     "1D = {100,200}, % \gg
     "1E = {300,100}, % \prec
     "1F = {100,300}, % \succ
     "20 = {100,200}, % \leftarrow
     "21 = {200,100}, % \rightarrow
     "22 = {100,100}, % \uparrow
     "23 = {100,100}, % \downarrow
     "24 = {100,100}, % \leftrightarrow
     "25 = {100,100}, % \nearrow
     "26 = {100,100}, % \searrow
     "27 = {100,100}, % \simeq
     "28 = {100,100}, % \Leftarrow
     "29 = {100,100}, % \Rightarrow
     "2A = {100,100}, % \Uparrow
     "2B = {100,100}, % \Downarrow
     "2C = {100,100}, % \Leftrightarrow
     "2D = {100,100}, % \nwarrow
     "2E = {100,100}, % \swarrow
     "2F = {   ,100}, % \propto
     "30 = {   ,400}, % \prime
     "31 = {100,100}, % \infty
     "32 = {150,100}, % \in
     "33 = {100,150}, % \ni
     "34 = {100,100}, % \triangle, \bigtriangleup
     "35 = {100,100}, % \bigtriangledown
%    "36 = {   ,   }, % \not
%    "37 = {   ,   }, % \mapstochar
     "38 = {   ,100}, % \forall
     "39 = {100,   }, % \exists
     "3A = {200,   }, % \neg
%    "3B = {   ,   }, % \emptyset
%    "3C = {   ,   }, % \Re
%    "3D = {   ,   }, % \Im
     "3E = {200,200}, % \top
     "3F = {200,200}, % \bot, \perp
%    "40 = {   ,   }, % \aleph
%    "5B = {   ,   }, % \cup
%    "5C = {   ,   }, % \cap
%    "5D = {   ,   }, % \uplus
     "5E = {100,200}, % \wedge
     "5F = {100,200}, % \vee
     "60 = {   ,300}, % \vdash
     "61 = {300,   }, % \dashv
     "62 = {100,100}, % \lfloor
     "63 = {100,100}, % \rfloor
     "64 = {100,100}, % \lceil
     "65 = {100,100}, % \rceil
     "66 = {150,   }, % \lbrace
     "67 = {   ,150}, % \rbrace
     "68 = {400,   }, % \langle
     "69 = {   ,400}, % \rangle
%    "6A = {   ,   }, % \arrowvert, \mid, \vert, |
%    "6B = {   ,   }, % \Arrowvert, \parallel, \Vert
     "6C = {100,100}, % \updownarrow
     "6D = {100,100}, % \Updownarrow
     "6E = {100,300}, % \, \backslash, \setminus
%    "6F = {   ,   }, % \wr
%    "70 = {   ,   }, % \sqrtsign
%    "71 = {   ,   }, % \amalg
     "72 = {100,100}, % \nabla
%    "73 = {   ,   }, % \smallint
%    "74 = {   ,   }, % \sqcup
%    "75 = {   ,   }, % \sqcap
%    "76 = {   ,   }, % \sqsubseteq
%    "77 = {   ,   }, % \sqsupseteq
%    "78 = {   ,   }, % \mathsection
     "79 = {200,200}, % \dagger
     "7A = {100,100}, % \ddagger
     "7B = {100,   }, % \mathparagraph
     "7C = {100,100}, % \clubsuit
     "7D = {100,100}, % \diamondsuit
     "7E = {100,100}, % \heartsuit
     "7F = {100,100}, % \spadesuit
   }

%    \end{macrocode}
% We don't bother about `|largesymbols|', since it will only be used in display
% math, where protrusion doesn't work anyway. It's declared as:
%\begin{verbatim}
%\DeclareSymbolFont{largesymbols}{OMX}{cmex}{m}{n}
%\end{verbatim}
%    \begin{macrocode}
%\SetProtrusion
%   [ name     = cmr-math-largesymbols ]
%   { encoding = OMX,
%     family   = {cmex,cmr} }
%   {
%     "00 % (
%     "01 % )
%     "02 % [
%     "03 % ]
%     "04 % \lfloor
%     "05 % \rfloor
%     "06 % \lceil
%     "07 % \rceil
%     "08 % \lbrace
%     "09 % \rbrace
%     "0A % <, \langle
%     "0B % >, \rangle
%     "0C % \vert, |
%     "0D % \Vert
%     "0E % /
%     "0F % \backslash
%     "3A % \lgroup
%     "3B % \rgroup
%     "3C % \arrowvert
%     "3D % \Arrowvert
%     "3E % \bracevert
%     "3F % \updownarrow
%     "40 % \lmoustache
%     "41 % \rmoustache
%     "46 % \bigsqcup
%     "48 % \ointop
%     "4A % \bigodot
%     "4C % \bigoplus
%     "4E % \bigotimes
%     "50 % \sum
%     "51 % \prod
%     "52 % \intop
%     "53 % \bigcup
%     "54 % \bigcap
%     "55 % \biguplus
%     "56 % \bigwedge
%     "57 % \bigvee
%     "60 % \coprod
%     "70 % \sqrtsign
%     "77 % \Updownarrow
%     "78 % \uparrow
%     "79 % \downarrow
%     "7A % \braceld, \lmoustache
%     "7B % \bracerd, \rmoustache
%     "7C % \bracelu
%     "7D % \braceru
%     "7E % \Uparrow
%     "7F % \Downarrow
%   }
%</cmr>
%</!cfg-u>
%    \end{macrocode}
%
% \subsubsection{\ams\ fonts}
%
%    \begin{macrocode}
%<*cfg-u>
%    \end{macrocode}
% Symbol font `a', defined in \pkg{amssymb}.
%
%\begin{verbatim}
%\DeclareSymbolFont{AMSa}{U}{msa}{m}{n}
%\end{verbatim}
%    \begin{macrocode}
%<*msa>
\SetProtrusion
   [ name     = AMSa ]
   { encoding = U,
     family   = msa  }
   {
%    "00  =  {   ,   },  % \boxdot
%    "01  =  {   ,   },  % \boxplus
%    "02  =  {   ,   },  % \boxtimes
%    "03  =  {   ,   },  % \square
%    "04  =  {   ,   },  % \blacksquare
     "05  =  {150,250},  % \centerdot
     "06  =  {100,100},  % \lozenge
     "07  =  { 50, 50},  % \blacklozenge
     "08  =  { 50, 50},  % \circlearrowright
     "09  =  { 50, 50},  % \circlearrowleft
     "0A  =  { 50, 50},  % \rightleftharpoons
     "0B  =  { 50, 50},  % \leftrightharpoons
%    "0C  =  {   ,   },  % \boxminus
     "0D  =  {-50,150},  % \Vdash
     "0E  =  {-50,150},  % \Vvdash
     "0F  =  {-70,150},  % \vDash
     "10  =  {100,100},  % \twoheadrightarrow
     "11  =  { 50,150},  % \twoheadleftarrow
     "12  =  { 50,100},  % \leftleftarrows
     "13  =  { 50, 80},  % \rightrightarrows
     "14  =  {120,120},  % \upuparrows
     "15  =  {120,120},  % \downdownarrows
     "16  =  {200,200},  % \upharpoonright
     "17  =  {200,200},  % \downharpoonright
     "18  =  {200,200},  % \upharpoonleft
     "19  =  {200,200},  % \downharpoonleft
     "1A  =  { 50, 80},  % \rightarrowtail
     "1B  =  { 50, 80},  % \leftarrowtail
     "1C  =  { 50, 50},  % \leftrightarrows
     "1D  =  { 50, 50},  % \rightleftarrows
     "1E  =  {150,   },  % \Lsh
     "1F  =  {   ,150},  % \Rsh
     "20  =  { 50,100},  % \rightsquigarrow
     "21  =  { 50, 50},  % \leftrightsquigarrow
     "22  =  { 50, 50},  % \looparrowleft
     "23  =  { 50, 50},  % \looparrowright
     "24  =  {   , 50},  % \circeq
     "25  =  {   ,100},  % \succsim
     "26  =  {   ,100},  % \gtrsim
     "27  =  {   ,100},  % \gtrapprox
     "28  =  { 50, 50},  % \multimap
%    "29  =  {   ,   },  % \therefore
%    "2A  =  {   ,   },  % \because
     "2B  =  { 50, 50},  % \doteqdot
     "2C  =  { 50, 50},  % \triangleq
     "2D  =  {100, 50},  % \precsim
     "2E  =  {100, 50},  % \lesssim
     "2F  =  { 50, 50},  % \lessapprox
     "30  =  {100, 50},  % \eqslantless
     "31  =  { 50, 50},  % \eqslantgtr
     "32  =  {100, 50},  % \curlyeqprec
     "33  =  { 50,100},  % \curlyeqsucc
     "34  =  {100, 50},  % \preccurlyeq
%    "35  =  {   ,   },  % \leqq
     "36  =  { 50,   },  % \leqslant
%    "37  =  {   ,   },  % \lessgtr
     "38  =  {   , 50},  % \backprime
     "39  =  {200,200},  % \dabar@ : the dash bar in \dash(left,right)arrow
%    "3A  =  {   ,   },  % \risingdotseq
%    "3B  =  {   ,   },  % \fallingdotseq
     "3C  =  { 50,100},  % \succcurlyeq
%    "3D  =  {   ,   },  % \geqq
     "3E  =  {   , 50},  % \geqslant
%    "3F  =  {   ,   },  % \gtrless
     "40  =  {   , 50},  % \sqsubset
     "41  =  { 50,   },  % \sqsupset
     "42  =  {   ,150},  % \vartriangleright, \rhd
     "43  =  {150,   },  % \vartriangleleft, \lhd
     "44  =  {   ,100},  % \trianglerighteq, \unrhd
     "45  =  {100,   },  % \trianglelefteq, \unlhd
     "46  =  {100,100},  % \bigstar
%    "47  =  {   ,   },  % \between
     "48  =  { 50, 50},  % \blacktriangledown
     "49  =  {   ,100},  % \blacktriangleright
     "4A  =  {100,   },  % \blacktriangleleft
     "4B  =  {   ,150},  % \dashrightarrow (the arrow)
     "4C  =  {150,   },  % \dashleftarrow
     "4D  =  { 50, 50},  % \vartriangle
     "4E  =  { 50, 50},  % \blacktriangle
     "4F  =  { 50, 50},  % \triangledown
     "50  =  { 50, 50},  % \eqcirc
%    "51  =  {   ,   },  % \lesseqgtr
%    "52  =  {   ,   },  % \gtreqless
%    "53  =  {   ,   },  % \lesseqqgtr
%    "54  =  {   ,   },  % \gtreqqless
%    "55  =  {   ,   },  % \yen
     "56  =  {   ,150},  % \Rrightarrow
     "57  =  {150,   },  % \Lleftarrow
     "58  =  {100,200},  % \checkmark
%    "59  =  {   ,   },  % \veebar
%    "5A  =  {   ,   },  % \barwedge
%    "5B  =  {   ,   },  % \doublebarwedge
     "5C  =  { 50, 50},  % \angle
     "5D  =  { 50, 50},  % \measuredangle
     "5E  =  { 50, 50},  % \sphericalangle
     "5F  =  {   , 50},  % \varpropto
     "60  =  {100,100},  % \smallsmile
     "61  =  {100,100},  % \smallfrown
     "62  =  { 50,   },  % \Subset
     "63  =  {   , 50},  % \Supset
%    "64  =  {   ,   },  % \Cup
%    "65  =  {   ,   },  % \Cap
     "66  =  {100,100},  % \curlywedge
     "67  =  {100,100},  % \curlyvee
     "68  =  { 50,100},  % \leftthreetimes
     "69  =  {100, 50},  % \rightthreetimes
%    "6A  =  {   ,   },  % \subseteqq
%    "6B  =  {   ,   },  % \supseteqq
     "6C  =  { 50, 50},  % \bumpeq
     "6D  =  { 50, 50},  % \Bumpeq
     "6E  =  {100,   },  % \lll
     "6F  =  {   ,100},  % \ggg
     "70  =  { 50,100},  % \ulcorner
     "71  =  {100, 50},  % \urcorner
%    "72  =  {   ,   },  % \circledR
%    "73  =  {   ,   },  % \circledS
%    "74  =  {   ,   },  % \pitchfork
     "75  =  {100,150},  % \dotplus
     "76  =  { 50,100},  % \backsim
%    "77  =  {   ,   },  % \backsimeq
     "78  =  { 50,100},  % \llcorner
     "79  =  {100, 50},  % \lrcorner
%    "7A  =  {   ,   },  % \maltese
%    "7B  =  {   ,   },  % \complement
     "7C  =  {100,100},  % \intercal
     "7D  =  { 50, 50},  % \circledcirc
     "7E  =  { 50, 50},  % \circledast
     "7F  =  { 50, 50},  % \circleddash
   }

%</msa>
%    \end{macrocode}
% Symbol font `b'.
%
%\begin{verbatim}
%\DeclareSymbolFont{AMSb}{U}{msb}{m}{n}
%\DeclareSymbolFontAlphabet{\mathbb}{AMSb}
%\end{verbatim}
%    \begin{macrocode}
%<*msb>
\SetProtrusion
   [ name     = AMSb ]
   { encoding = U,
     family   = msb  }
   {
       A  =  { 50, 50},  % \mathbb
       C  =  { 50, 50},
       G  =  {   , 50},
       L  =  {   , 50},
       P  =  {   , 50},
       R  =  {   , 50},
       T  =  {   , 50},
       V  =  { 50, 50},
       X  =  { 50, 50},
       Y  =  { 50, 50},
     "00  =  { 50, 50},  % \lvertneqq
     "01  =  { 50, 50},  % \gvertneqq
     "02  =  { 50, 50},  % \nleq
     "03  =  { 50, 50},  % \ngeq
     "04  =  {100, 50},  % \nless
     "05  =  { 50,150},  % \ngtr
     "06  =  {100, 50},  % \nprec
     "07  =  { 50,150},  % \nsucc
     "08  =  { 50, 50},  % \lneqq
     "09  =  { 50, 50},  % \gneqq
     "0A  =  {100,100},  % \nleqslant
     "0B  =  {100,100},  % \ngeqslant
     "0C  =  {100, 50},  % \lneq
     "0D  =  { 50,100},  % \gneq
     "0E  =  {100, 50},  % \npreceq
     "0F  =  { 50,100},  % \nsucceq
     "10  =  { 50,   },  % \precnsim
     "11  =  { 50, 50},  % \succnsim
     "12  =  { 50, 50},  % \lnsim
     "13  =  { 50, 50},  % \gnsim
     "14  =  { 50, 50},  % \nleqq
     "15  =  { 50, 50},  % \ngeqq
     "16  =  { 50, 50},  % \precneqq
     "17  =  { 50, 50},  % \succneqq
     "18  =  { 50, 50},  % \precnapprox
     "19  =  { 50, 50},  % \succnapprox
     "1A  =  { 50, 50},  % \lnapprox
     "1B  =  { 50, 50},  % \gnapprox
     "1C  =  {150,200},  % \nsim
     "1D  =  { 50, 50},  % \ncong
     "1E  =  {100,150},  % \diagup
     "1F  =  {100,150},  % \diagdown
     "20  =  {100, 50},  % \varsubsetneq
     "21  =  { 50,100},  % \varsupsetneq
     "22  =  {100, 50},  % \nsubseteqq
     "23  =  { 50,100},  % \nsupseteqq
     "24  =  {100, 50},  % \subsetneqq
     "25  =  { 50,100},  % \supsetneqq
     "26  =  {100, 50},  % \varsubsetneqq
     "27  =  { 50,100},  % \varsupsetneqq
     "28  =  {100, 50},  % \subsetneq
     "29  =  { 50,100},  % \supsetneq
     "2A  =  {100, 50},  % \nsubseteq
     "2B  =  { 50,100},  % \nsupseteq
     "2C  =  { 50,100},  % \nparallel
     "2D  =  {100,150},  % \nmid
     "2E  =  {150,150},  % \nshortmid
     "2F  =  {100,100},  % \nshortparallel
     "30  =  {   ,150},  % \nvdash
     "31  =  {   ,150},  % \nVdash
     "32  =  {   ,100},  % \nvDash
     "33  =  {   ,100},  % \nVDash
     "34  =  {   ,100},  % \ntrianglerighteq
     "35  =  {100,   },  % \ntrianglelefteq
     "36  =  {100,   },  % \ntriangleleft
     "37  =  {   ,100},  % \ntriangleright
     "38  =  {100,200},  % \nleftarrow
     "39  =  {100,200},  % \nrightarrow
     "3A  =  {100,100},  % \nLeftarrow
     "3B  =  { 50,100},  % \nRightarrow
     "3C  =  {100,100},  % \nLeftrightarrow
     "3D  =  {100,200},  % \nleftrightarrow
     "3E  =  { 50, 50},  % \divideontimes
     "3F  =  { 50, 50},  % \varnothing
%    "40  =  {   ,   },  % \nexists
     "60  =  {200,   },  % \Finv
     "61  =  {   , 50},  % \Game
%    "66  =  {   ,   },  % \mho
%    "67  =  {   ,   },  % \eth
     "68  =  {100,100},  % \eqsim
     "69  =  { 50,   },  % \beth
     "6A  =  { 50,   },  % \gimel
     "6B  =  {150,   },  % \daleth
     "6C  =  {200,   },  % \lessdot
     "6D  =  {   ,200},  % \gtrdot
     "6E  =  {100,200},  % \ltimes
     "6F  =  {150,100},  % \rtimes
     "70  =  { 50,100},  % \shortmid
     "71  =  { 50, 50},  % \shortparallel
     "72  =  {200,300},  % \smallsetminus
     "73  =  {100,200},  % \thicksim
     "74  =  { 50,100},  % \thickapprox
     "75  =  { 50, 50},  % \approxeq
     "76  =  { 50,100},  % \succapprox
     "77  =  { 50, 50},  % \precapprox
     "78  =  {100,100},  % \curvearrowleft
     "79  =  { 50,150},  % \curvearrowright
     "7A  =  { 50,200},  % \digamma
     "7B  =  {100, 50},  % \varkappa
%    "7C  =  {   ,   },  % \Bbbk
%    "7D  =  {   ,   },  % \hslash
%    "7E  =  {   ,   },  % \hbar
     "7F  =  {200,   },  % \backepsilon
   }

%</msb>
%    \end{macrocode}
% Euler Fraktur font (\pkg{eufrak}).
%
%\begin{verbatim}
%\DeclareMathAlphabet{\mathfrak}{U}{euf}{m}{n}
%\SetMathAlphabet{\mathfrak}{bold}{U}{euf}{b}{n}
%\end{verbatim}
%    \begin{macrocode}
%<*euf>
\SetProtrusion
   [ name     = mathfrak ]
   { encoding = U,
     family   = euf  }
   {
       A  =  {   , 50},
       B  =  {   , 50},
       C  =  { 50, 50},
       D  =  {   , 80},
       E  =  { 50,   },
       G  =  {   , 50},
       L  =  {   , 80},
       O  =  {   , 50},
       T  =  {   , 80},
       X  =  { 80, 50},
       Z  =  { 80, 50},
       b  =  {   , 50},
       c  =  {   , 50},
       k  =  {   , 50},
       p  =  {   , 50},
       q  =  { 50,   },
       v  =  {   , 50},
       w  =  {   , 50},
       x  =  {   , 50},
       1  =  {100,100},
       2  =  { 80, 80},
       3  =  { 80, 50},
       4  =  { 80, 50},
       7  =  { 50, 50},
   }

%</euf>
%    \end{macrocode}
% Euler script font (\pkg{eucal}).
%
%\begin{verbatim}
%\DeclareMathAlphabet\EuScript{U}{eus}{m}{n}
%\SetMathAlphabet\EuScript{bold}{U}{eus}{b}{n}
%\end{verbatim}
%    \begin{macrocode}
%<*eus>
\SetProtrusion
   [ name     = euscript ]
   { encoding = U,
     family   = eus  }
   {
       A  =  {100,100},
       B  =  { 50,100},
       C  =  { 50, 50},
       D  =  { 50,100},
       E  =  { 50,100},
       F  =  { 50,   },
       G  =  { 50,   },
       H  =  {   ,100},
       K  =  {   , 50},
       L  =  {   ,150},
       M  =  {   , 50},
       N  =  {   , 50},
       O  =  { 50, 50},
       P  =  { 50, 50},
       T  =  {   ,100},
       U  =  {   , 50},
       V  =  { 50, 50},
       W  =  { 50, 50},
       X  =  { 50, 50},
       Z  =  { 50,100},
   }

%</eus>
%</cfg-u>
%</config>
%    \end{macrocode}
%
%\section{Auxiliary File for Micro Fine Tuning}
%
% This file can be used to test protrusion and expansion settings.
%    \begin{macrocode}
%<*test>
\documentclass{article}

%% Here you can set the font you want to test, using
%% the commands \fontfamily, \fontseries, and \fontshape.
%% Make sure to end all lines with a comment character!
\newcommand*{\TestFont}{%
   \fontfamily{ppl}%
%%   \fontseries{b}%
%%   \fontshape{it}% sc, sl
}

\usepackage{ifthen}
\usepackage[T1]{fontenc}
%%\usepackage[latin1]{inputenc}
\usepackage[verbose,expansion=alltext,stretch=50]{microtype}

\pagestyle{empty}
\setlength{\parindent}{0pt}
\newcommand*{\crulefill}{\cleaders\hbox{$\mkern-2mu\smash-\mkern-2mu$}\hfill}
\newcommand*{\testprotrusion}[2][]{%
  \ifthenelse{\equal{#1}{r}}{}{#2}%
   lorem ipsum dolor sit amet,
     \ifthenelse{\equal{#1}{r}}{\crulefill}{\leftarrowfill} #2
     \ifthenelse{\equal{#1}{l}}{\crulefill}{\rightarrowfill}
   you know the rest%
  \ifthenelse{\equal{#1}{l}}{}{#2}%
   \linebreak
  {\fontencoding{\encodingdefault}%
   \fontseries{\seriesdefault}%
   \fontshape{\shapedefault}%
   \selectfont
   Here is the beginning of a line, \dotfill and here is its end}\linebreak
}
\newcommand*{\showTestFont}{\expandafter\stripprefix\meaning\TestFont}
\def\stripprefix#1>{}
\newcount\charcount
\begin{document}
\microtypesetup{expansion=false}

{\centering The font in this document is called by:\\
 \texttt{\showTestFont}\par}\bigskip

\TestFont\selectfont
 This line intentionally left empty\linebreak
%% A -- Z
\charcount=65
\loop
   \testprotrusion{\char\charcount}
   \advance\charcount 1
   \ifnum\charcount < 91 \repeat
%% a -- z
\charcount=97
\loop
   \testprotrusion{\char\charcount}
   \advance\charcount 1
   \ifnum\charcount < 123 \repeat
%% 0 -- 9
\charcount=48
\loop
   \testprotrusion{\char\charcount}
   \advance\charcount 1
   \ifnum\charcount < 58 \repeat
%%
 \testprotrusion[r]{,}
 \testprotrusion[r]{.}
 \testprotrusion[r]{;}
 \testprotrusion[r]{:}
 \testprotrusion[r]{?}
 \testprotrusion[r]{!}
 \testprotrusion[l]{\textexclamdown}
 \testprotrusion[l]{\textquestiondown}
 \testprotrusion[r]{)}
 \testprotrusion[l]{(}
 \testprotrusion{/}
 \testprotrusion{\char`\\}
 \testprotrusion{-}
 \testprotrusion{\textendash}
 \testprotrusion{\textemdash}
 \testprotrusion{\textquoteleft}
 \testprotrusion{\textquoteright}
 \testprotrusion{\textquotedblleft}
 \testprotrusion{\textquotedblright}
 \testprotrusion{\quotesinglbase}
 \testprotrusion{\quotedblbase}
 \testprotrusion{\guilsinglleft}
 \testprotrusion{\guilsinglright}
 \testprotrusion{\guillemotleft}
 \testprotrusion{\guillemotright}

\bigskip
The following displays the current font stretched by 5\%,
normal, and shrunk by 5\%:

\microtypesetup{expansion=true}

\bigskip
\newlength{\MTln}
\newcommand*{\teststring}
   {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789}
\settowidth{\MTln}{\teststring}

\parbox{1.05\MTln}{\teststring\linebreak\\
                   \teststring}\par\bigskip
\parbox{0.95\MTln}{\teststring}
\end{document}
%</test>
%    \end{macrocode}
%
% ^^A -------------------------------------------------------------------------
% Needless to say that things may always be improved. For suggestions, mail to
% \mailtoRS.
%
% ^^A -------------------------------------------------------------------------
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<
%   Equals        \=     Greater than  \>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
% \CheckSum{5836}
%
% \Finale
%
\endinput
%
